<!DOCTYPE html>
<html lang="zh-cn">
  <head>
    <title>go todo | brettkk</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="etcdæ¶æ„åˆ†ä¸º4éƒ¨åˆ† http server store raft wal etcdä½¿ç”¨åœºæ™¯ APIï¼šEt">
<meta name="generator" content="Hugo 0.72.0" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="stylesheet" href="/css/style.css">
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/styles/googlecode.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/highlight.js/10.0.1/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>







  </head>
  
  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">go todo</h1>

    <div class="tip">
        <span>
          May 3, 2021 18:34
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          
            3431 words
          
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          7 minute read
        </span>
    </div>

    <div class="content" >
      <article class="content">
        <ul>
<li>
<p>æ·±å…¥è§£ægo</p>
<ul>
<li>
<p>ä»è¯æ³•è¯­æ³•è§£æã€ç±»å‹æ£€æŸ¥ã€ä¸­é—´ä»£ç ç”Ÿæˆä»¥åŠæœºå™¨ç ç”Ÿæˆçš„ç¼–è¯‘ç›¸å…³å…¨é“¾è·¯ï¼›</p>
<ul>
<li>cmd/compile/internal ç”Ÿæˆä¸åŒcpuä¸‹çš„mr</li>
<li>src/cmd/compile/internal/gc</li>
</ul>
</li>
<li>
<p>æ•°ç»„ã€å“ˆå¸Œè¡¨å’Œå­—ç¬¦ä¸²ç­‰æ•°æ®ç»“æ„çš„è¡¨ç¤ºä»¥åŠåŸºæœ¬æ“ä½œçš„å®ç°åŸç†ï¼›</p>
</li>
<li>
<p>ç†è§£ Go è¯­è¨€ä¸­çš„å‡½æ•°ã€æ–¹æ³•ã€é—­åŒ…å’Œä¸Šä¸‹æ–‡ç­‰è¯­è¨€ç‰¹æ€§ï¼›</p>
</li>
<li>
<p>å¸¸è§å¹¶å‘ç¼–ç¨‹ä½¿ç”¨çš„ WaitGroupã€Once ä»¥åŠäº’æ–¥é”ç­‰ç»“æ„çš„å®ç°ï¼›</p>
</li>
<li>
<p>è¯­è¨€ä¸­çš„ä¸‡èƒ½ç±»å‹ interface çš„å®ç°åŸç†ï¼›</p>
</li>
<li>
<p>å„ç§å…³é”®å­— makeã€newã€deferã€select ä»¥åŠ for å¾ªç¯çš„å¤„ç†è¿‡ç¨‹ï¼›</p>
</li>
<li>
<p>Goroutine å’Œ Channel ç›¸å…³çš„ç»“æ„ã€è°ƒåº¦ç­–ç•¥ä»¥åŠåŸç†</p>
</li>
<li>
<p>æºç ç›®å½•æ–‡ä»¶å¤¹(src, test,</p>
</li>
<li>
<p>æºç ä¸­çš„æ±‡ç¼–ï¼ˆcrypto, mathåŒ…ï¼Œä¸ºäº†æ€§èƒ½å’Œç‰¹æ®Šçš„cpuæ“ä½œï¼‰</p>
</li>
<li>
<p>åŸºæœ¬æ•°æ®ç»“æ„ï¼Œsliceï¼Œ mapï¼Œ channel</p>
<ul>
<li>åˆ›å»ºæ•°ç»„ï¼ˆåˆ›å»ºæ—¶ç±»å‹å’Œé•¿åº¦å›ºå®šï¼Œ æ•°ç»„æ˜¯å¦åœ¨heapä¸Š ç¼–è¯‘æ—¶å·²ç»ç¡®å®šï¼‰</li>
<li>slice=åŠ¨æ€æ•°ç»„</li>
<li>map</li>
<li>channel</li>
</ul>
</li>
<li>
<p>gdb è·Ÿè¸ªæºç </p>
<ul>
<li>goå¦‚ä½•åšå…·ä½“ç±»å‹è½¬ä¸ºinterfaceç±»å‹çš„ï¼ˆruntime.convT2Eï¼‰</li>
</ul>
</li>
<li>
<p>delve è·Ÿè¸ª</p>
</li>
<li>
<p>æ‰“å°è°ƒç”¨æ ˆä¿¡æ¯ import &quot;runtime/debug&quot;   debug.Stack()</p>
</li>
</ul>
</li>
<li>
<p>ä¼˜ç‚¹</p>
<ul>
<li>æ²¡æœ‰å¼‚å¸¸ï¼Œæ²¡æœ‰ç»§æ‰¿ï¼ˆä¹Ÿå°±æ²¡æœ‰å¤šæ€ï¼‰</li>
<li>å…è®¸å¤šè¿”å›å€¼, æœ‰é—­åŒ…</li>
<li>è‡ªå¸¦GC(...)</li>
<li>å¹¶å‘ç¼–ç¨‹ç®€å•ï¼Œjust go, channel(è‡ªå¸¦çº¿ç¨‹å®‰å…¨), WaitGroup, RWLock</li>
</ul>
</li>
<li>
<p>ç¼ºç‚¹</p>
<ul>
<li>error æ²¡æœ‰ç±»å‹
<ul>
<li>2008.9.10 errorno int64 ç³»ç»Ÿè°ƒç”¨è¿”å›çš„é”™è¯¯ç±»å‹ï¼› 2:19pm type Error struct {s string}</li>
<li>2009.4.17 type Error interface { String() string}</li>
<li>github.com/pkg/errors</li>
<li>gopkg.in/errgo.v2</li>
<li>github.com/hashicorp/errwrap</li>
<li>upspin.io/errors</li>
<li>github.com/spacemonkeygo/errors</li>
</ul>
</li>
<li>init() å‡½æ•°æ»¥ç”¨</li>
<li>åŒ…ç‰ˆæœ¬ç®¡ç†å™¨ vendorï¼Œgovendorï¼Œgodepä¸æˆç†Ÿ</li>
<li>sliceæº¢å‡ºæ—¶è‡ªåŠ¨æ‹·è´</li>
</ul>
</li>
<li>
<p>ç±»å‹æ–­è¨€ ç©ºæ¥å£ç±»å‹ è¿è¡Œæ—¶ è½¬ä¸º æ™®é€šç±»å‹</p>
</li>
<li>
<p>golangä¸­å‚æ•°ä¼ é€’æ—¶ åªæœ‰ å‚æ•°å€¼æ‹·è´ ç„¶å ä¼ å…¥å‡½æ•°ä½“ï¼Œå‚æ•°ç±»å‹åˆ†ä¸ºå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹</p>
</li>
<li>
<p>ginæœåŠ¡å™¨</p>
<ul>
<li>sync.Pool å¤ç”¨contextå¯¹è±¡</li>
<li>context.go gin.go routergroup.go tree.go</li>
<li>ç»´æŠ¤urlè·¯å¾„çš„å‰ç¼€æ ‘</li>
</ul>
</li>
</ul>
<hr>
<h3 id="an-overview-of-gos-tooling">an overview of go's tooling <a href="#an-overview-of-gos-tooling" class="anchor">ğŸ”—</a></h3><ul>
<li>
<p>table of content</p>
</li>
<li>
<p>installing tooling</p>
<ul>
<li>$ GO111MODULE=on go get golang.org/x/tools/cmd/stresss</li>
<li>go get -u, å¼ºåˆ¶ä½¿ç”¨ç½‘ç»œå»æ›´æ–°åŒ…å’Œå®ƒçš„ä¾èµ–åŒ…, è‡ªåŠ¨å®Œæˆç¼–è¯‘å’Œå®‰è£… (git clone + go install)</li>
</ul>
</li>
<li>
<p>viewing environment information</p>
<ul>
<li>go env</li>
<li>go env GOPATH GOOS GOARCH</li>
<li>go help environment (go help get)</li>
</ul>
</li>
<li>
<p>development</p>
<ul>
<li>GOOS=windows go build
<ul>
<li>go build -gcflags=&quot;-m -l&quot; // çœ‹å˜é‡åˆ†é…åœ¨stack or heap</li>
</ul>
</li>
<li>go run ./cmd/foo</li>
<li>go run, go test, go build å¯ä»¥é™é»˜æ·»åŠ å¤–é¢ä¾èµ–</li>
<li>go get <a href="mailto:github.com/foo/bar@v1.2.3">github.com/foo/bar@v1.2.3</a> ä¹Ÿå¯ä»¥æŒ‡å®šç‰¹åˆ«çš„ç‰ˆæœ¬å·
<ul>
<li>go get -v æ˜¾ç¤ºæ“ä½œæµç¨‹çš„æ—¥å¿—åŠä¿¡æ¯ï¼Œæ–¹ä¾¿æ£€æŸ¥é”™è¯¯</li>
<li>go get -u é‡æ–°ä¸‹è½½ä¾èµ–åŒ…</li>
<li>go get -d åªä¸‹è½½ï¼Œä¸å®‰è£…</li>
<li>go get -insecure  å…è®¸ä½¿ç”¨ä¸å®‰å…¨çš„ HTTP æ–¹å¼è¿›è¡Œä¸‹è½½æ“ä½œ</li>
</ul>
</li>
<li>go list -m all</li>
<li>go mod why -m golang.org/x/sys</li>
<li>go mod graph</li>
<li>go clean -modcache (cache: GOPATH/pkg/mod)</li>
<li>gofmt -d -w -r 'Add -&gt; ADD' .</li>
<li>go doc -src strings.Replace (view go documentation) , go doc fmt Printf</li>
</ul>
</li>
<li>
<p>testing</p>
<ul>
<li>go test ./foo/bar</li>
<li>go clean -testcache</li>
<li>go test -v -run=^TestFooBar$ .</li>
<li>go test -cover ./...</li>
<li>go test -run=^TestFooBar$ -count=500 . (stress testing)</li>
<li>go test -covermode=count -coverprofile=/tmp/profile.out ./...</li>
<li>go tool cover -html=/tmp/profile.out</li>
</ul>
</li>
<li>
<p>pre_commit checks</p>
<ul>
<li>gofmt -w -s -d .</li>
<li>go vet foo.go</li>
<li>golint foo.go</li>
<li>go mod tidy, go mod verify</li>
</ul>
</li>
<li>
<p>build and deployment</p>
<ul>
<li>go clean -cache</li>
<li>go install -&gt; $GOPATH/bin/demo</li>
<li>go list -f '{{ .Name}}'</li>
<li>go tool dist list (os/architecture)</li>
<li>GOOS=linux GOARCH=amd64 go build -o=/tmp/linux_amd64/foo .</li>
<li><a href="https://github.com/golang/go/wiki/WebAssembly">https://github.com/golang/go/wiki/WebAssembly</a></li>
</ul>
</li>
<li>
<p>diagnosing problems and making optimizations</p>
<ul>
<li>go tool pprof --nodefraction=0.1  -http=:9999 /tmp/cpuprofile.out</li>
<li>go tool trace
<ul>
<li>goroutineçš„æ—¶é—´é˜¶æ®µï¼š Execution Timeï¼Œ Network Wait Timeï¼Œ Sync Block Timeï¼Œ Blocking Syscall Timeï¼Œ Scheduler Wait Timeï¼Œ GC Sweepingï¼Œ GC Pauseã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p>managing dependencies</p>
<ul>
<li>go list -m -u all</li>
</ul>
</li>
<li>
<p>upgrading to a new go release</p>
<ul>
<li>go fix</li>
</ul>
</li>
<li>
<p>reporting bugs</p>
<ul>
<li>go bug</li>
</ul>
</li>
<li>
<p>chetsheet</p>
</li>
<li>
<p>goimports</p>
</li>
<li>
<p>godef</p>
</li>
<li>
<p>gopls</p>
<ul>
<li>golang.org/wiki/gopls</li>
<li>go get golang.org/x/tools/gopls@latest</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>åå°„ Reflection (interfaceå¯¹è±¡=ï¼ˆType, Valueï¼‰åå°„ç±»å‹ reflect.Type, reflect.Value)  ä¸‰ç‚¹
<ul>
<li>åå°„å¯ä»¥å°†interfaceç±»å‹çš„å˜é‡ è½¬æ¢ä¸º åå°„å¯¹è±¡ï¼ˆreflect.Type reflect.Valueï¼‰</li>
<li>åå°„å¯ä»¥å°†åå°„å¯¹è±¡ è¿˜åŸä¸ºinterfaceå¯¹è±¡</li>
<li>åå°„å¯¹è±¡å¯ä»¥ä¿®æ”¹ï¼Œæå‰æ˜¯valueå€¼æ˜¯å˜é‡çš„æŒ‡é’ˆ  var x float= 3.1 ; v:= reflect.ValueOf(&amp;x); v.Elem().SetFloat(3.4);</li>
</ul>
</li>
<li>åŠ¨æ€è°ƒç”¨æ–¹æ³•ï¼Œ reflect.Value(interface) -&gt; reflect.Value-&gt;value.MethodByName-&gt;Call</li>
</ul>
<hr>
<ul>
<li>
<p>å‡½æ•°æ¥å—è€…ä¸ºæŒ‡é’ˆç±»å‹</p>
<ul>
<li>å‡½æ•°å¯ä»¥ä¿®æ”¹æ¥å—è€…çš„å†…å®¹</li>
<li>é¿å…æ–¹æ³•è°ƒç”¨æ—¶å˜é‡çš„æ‹·è´ï¼Œè€Œæ˜¯æŒ‡é’ˆçš„æ‹·è´</li>
</ul>
</li>
<li>
<p>goä¸¥æ ¼ä¸Šåªæœ‰å¤åˆ¶æ‹·è´ä¼ é€’</p>
<ul>
<li>æ€»æ˜¯åˆ›å»ºå‰¯æœ¬æŒ‰å€¼ä¼ é€’ï¼Œåªä¸è¿‡è¿™ä¸ªå‰¯æœ¬å¯ä»¥æ˜¯å˜é‡çš„å‰¯æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡é’ˆçš„å‰¯æœ¬</li>
</ul>
</li>
<li>
<p>ioæ“ä½œ</p>
<ul>
<li>ioåŸºæœ¬æ¥å£ï¼Œio/ioutil å°è£…å®ç”¨å‡½æ•°</li>
<li>fmt æ ¼å¼åŒ–io</li>
<li>bufio å¸¦ç¼“å†²io</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">type Reader interface {
    Read(p []byte) (n int, err error)
}
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>Readers</p>
<ul>
<li>os.File</li>
<li>bufio.Reader</li>
<li>net.Conn</li>
<li>compress/gzip, crypto/tls,...</li>
<li>bytes.Buffer</li>
</ul>
</li>
<li>
<p>Goroutines</p>
</li>
<li>
<p>Channels (buffer, un buffer)</p>
</li>
<li>
<p>Range and Close</p>
</li>
<li>
<p>Select</p>
</li>
<li>
<p>golang å¹¶å‘æ§åˆ¶</p>
<ul>
<li>channel</li>
<li>waitgroup</li>
<li>context</li>
<li>sync
<ul>
<li>sync.Mutex</li>
<li>sync.Once</li>
<li>sync.RWMutex</li>
<li>sync.WaitGroup</li>
<li>sync.Cond</li>
</ul>
</li>
</ul>
</li>
<li>
<p>golang å†…å­˜ç®¡ç†</p>
<ul>
<li>å†…å­˜åˆ†é…åŸç†
<ul>
<li>src/runtime/mheap.go:mspan</li>
</ul>
</li>
<li>å†…å­˜å›æ”¶åŸç†
<ul>
<li>ä¸‰è‰²æ ‡è®°æ³• ï¼ˆæœªä½¿ç”¨ï¼Œå·²ä½¿ç”¨ï¼Œå¸¦å¤„ç†ï¼‰</li>
</ul>
</li>
<li>é€ƒé€¸åˆ†æï¼ˆå¯¹è±¡æ˜¯å¦è¢«å‡½æ•°å¤–é¢å¼•ç”¨ ä¾‹å¦‚é—­åŒ…ï¼› å¯¹è±¡è¿‡å¤§ä¹Ÿå¯èƒ½åœ¨å †ä¸­ï¼‰
<ul>
<li>é€ƒé€¸åˆ†æçš„ç›®çš„æ˜¯å†³å®šå˜é‡çš„å†…å­˜åˆ†é…åœ°å€æ˜¯åœ¨æ ˆè¿˜æ˜¯å †</li>
<li>é€ƒé€¸åˆ†æåœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆçš„</li>
<li>ä¼ é€’æŒ‡é’ˆçœŸçš„æ¯”ä¼ å€¼é«˜æ•ˆå—ï¼Ÿä¸ä¸€å®š ç”±äºæŒ‡é’ˆä¼ é€’ä¼šäº§ç”Ÿé€ƒé€¸ï¼Œå¯èƒ½ä¼šä½¿ç”¨å †ï¼Œå¢åŠ GCè´Ÿæ‹…ã€‚</li>
<li>go build -gcflags=-m // escapes to heap</li>
</ul>
</li>
</ul>
</li>
<li>
<p>interface{} åº•å±‚å®ç°åŸç†</p>
<ul>
<li>
<p>æ¥å£çš„ä½œç”¨æ˜¯ é€šè¿‡ä¸€ç»„æ–¹æ³• å®šä¹‰ ä¸€ä¸ªå¯¹è±¡ çš„è¡Œä¸ºï¼›æœ¬è´¨æ˜¯</p>
</li>
<li>
<p>æ€ç»´å±‚æ¬¡</p>
<ul>
<li>åŸºæœ¬åŸç†(åº•å±‚æ•°æ®ç»“æ„)</li>
<li>ç±»å‹æ–­è¨€çš„è¿‡ç¨‹</li>
<li>åŠ¨æ€æ´¾å‘æœºåˆ¶</li>
</ul>
</li>
<li>
<p>eface(ä¸å«methodçš„interfaceç»“æ„), runtime.convT2Eï¼ˆx := 1; var iInter interface{} = x, æ±‡ç¼–é‡Œè°ƒç”¨è¯¥æ–¹æ³•ï¼‰</p>
<ul>
<li>ç±»å‹å’ŒæŒ‡å‘æ•°æ®çš„2ä¸ªæŒ‡é’ˆï¼Œ æ‰€ä»¥ä»»æ„ç±»å‹çš„å¯¹è±¡ å‡å¯ä»¥è½¬æ¢ä¸º interface{}ç±»å‹çš„å¯¹è±¡</li>
</ul>
</li>
<li>
<p>iface, runtime.convT2I</p>
<ul>
<li>itab</li>
<li>todo</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">type eface struct { //16 bytes
    _type   *_type
    data    unsafe.Pointer
}

type iface struct { //16 bytes
    tab     *itab 
    data    unsafe.Pointer
}

type itab struct { //32 bytes
    inter *interfacetype //å¯¹ _type ç±»å‹çš„ç®€å•å°è£…
    _type *_type    //_type å­—æ®µæ˜¯ Go è¯­è¨€ç±»å‹åœ¨è¿è¡Œæ—¶çš„å†…éƒ¨ç»“æ„ï¼Œæ¯ä¸€ä¸ª _type ç»“æ„ä½“ä¸­éƒ½åŒ…å«äº†ç±»å‹çš„å¤§å°ã€å¯¹é½ä»¥åŠå“ˆå¸Œç­‰ä¿¡æ¯
    hash uint32     // copy of _type.hash ä» interface åˆ°å…·ä½“ç±»å‹çš„åˆ‡æ¢æ—¶ç”¨äºå¿«é€Ÿåˆ¤æ–­ç›®æ ‡ç±»å‹å’Œæ¥å£ä¸­ç±»å‹æ˜¯å¦ä¸€è‡´
    _ [4]byte
    fun [1]uintptr //å½“å‰æ•°ç»„ä¸­å†…å®¹ä¸ºç©ºå°±è¡¨ç¤º _type æ²¡æœ‰å®ç° inter æ¥å£
}

type _type struct {
    size       uintptr
    ptrdata    uintptr // size of memory prefix holding all pointers
    hash       uint32
    tflag      tflag
    align      uint8
    fieldalign uint8
    kind       uint8
    alg        *typeAlg
    // gcdata stores the GC type data for the garbage collector.
    // If the KindGCProg bit is set in kind, gcdata is a GC program.
    // Otherwise it is a ptrmask bitmap. See mbitmap.go for details.
    gcdata    *byte
    str       nameOff
    ptrToThis typeOff
}

</code></pre></td></tr></table>
</div>
</div><hr>
<ul>
<li>channel, goroutine make concurrent programming in go more convenient</li>
<li>channel ç»“æ„ (src/runtime/chan.goä¸­å®ç°)
<ul>
<li>å¸¦ç¼“å­˜çš„ï¼Œä¸å¸¦ç¼“å­˜çš„</li>
<li>å‘é€æ•°æ® 3ç§æƒ…å†µ
<ul>
<li>hchan.bufä¸ºç©ºæ—¶ï¼Œç›´æ¥å°†æ•°æ®å‘é€ç»™goroutine</li>
<li>hchan.bufä¸ä¸ºç©ºæ—¶ï¼Œå°†æ•°æ®æ”¾å…¥bufferé‡Œ</li>
<li>hchan.bufæ»¡æ—¶ï¼Œé˜»å¡å½“å‰goroutine</li>
</ul>
</li>
<li>closechan å…³é—­channelçš„å‡½æ•°
<ul>
<li>closedç½®ä¸º1</li>
<li>å”¤é†’recvqé˜Ÿåˆ—é‡Œçš„é˜»å¡goroutine</li>
<li>å”¤é†’sendqé˜Ÿåˆ—é‡Œçš„é˜»å¡goroutine</li>
</ul>
</li>
<li>gracefully close channels</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">ch := make(chan int, 3)
å†…å­˜channelçš„åˆå§‹çŠ¶æ€
qcount = 0
dataqsiz = 3
buf = [3]int{0,0,0}
sendx = 0
recvx = 0

</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">// channel åº•å±‚ç»“æ„
type hchan struct {
    qcount uint,            // é˜Ÿåˆ—ä¸­æ•°æ®ä¸ªæ•°
    dataqsiz uint;          // channel å¤§å°
    buf unsafe.Pointer      // å­˜æ”¾æ•°æ®çš„ç¯å‹æ•°ç»„
    elemsize uint16;        // channelä¸­æ•°æ®ç±»å‹çš„å¤§å°
    closed uint32;          // è¡¨ç¤ºchannelæ˜¯å¦å…³é—­
    elemtype *_type;        // å…ƒæ•°æ®çš„ç±»å‹
    uintgo sendx;           // send index
    uintgo recvx;            // rece index
    WaitQ recvq;             //ç”± recv è¡Œä¸ºï¼ˆä¹Ÿå°±æ˜¯ &lt;-chï¼‰é˜»å¡åœ¨ channel ä¸Šçš„ goroutine é˜Ÿåˆ—
    WaitQ sendq;             // ç”± send è¡Œä¸º (ä¹Ÿå°±æ˜¯ ch&lt;-) é˜»å¡åœ¨ channel ä¸Šçš„ goroutine é˜Ÿåˆ—
    mutex Lock;              // protect field
}

stuct WaitQ {
    first *sudog;
    last *sudog;
}

type sudog struct {

}

</code></pre></td></tr></table>
</div>
</div><hr>
<ul>
<li>GPMç»“æ„  schedè°ƒåº¦å™¨ç›¸å…³çš„æ•°æ®ç»“æ„
<ul>
<li>M-osçº¿ç¨‹ï¼ŒP-goä»£ç æ‰§è¡Œæ—¶éœ€è¦çš„èµ„æºï¼Œ åœ¨Pä¸Šå®ç°å·¥ä½œæµçªƒå–çš„è°ƒåº¦å™¨</li>
<li>goå…³é”®å­— -&gt; å‡æœ‰runtime.newprocï¼ˆsize, f, argsï¼‰åˆ›å»ºgroutinue</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">
struct G
{
    uintptr stackguard; //åˆ†æ®µæ ˆçš„å¯ç”¨ç©ºé—´ä¸‹ç•Œ é˜²æ­¢æ ˆæº¢å‡º base+64k çš„ä¸ºæ­¢
    uintptr stackbase;  //åˆ†æ®µæ ˆçš„æ ˆåŸºå€
    Gobuf sched;        //åˆ‡æ¢æ—¶ï¼Œschedå­˜ä¸Šä¸‹æ–‡ä¿¡æ¯
    uintptr stack0;     //
    FuncVal* fnstart;   //goroutineè¿è¡Œæ—¶çš„å‡½æ•°
    void* param;        //ç”¨äºä¼ é€’å‚æ•°
    int16 status;       //goroutineçŠ¶æ€ï¼Œå¦‚Gidle, Grunnable, Grunning, Gsyscall, Gwaiting, Gdeadç­‰
    int64 goid;         //goroutine idå·
    G* schedlink;       //
    M* m;               // for debug
    M* lockedm;         //Gè¢«é”å®šåªèƒ½åœ¨mä¸Šè¿è¡Œ
    uintptr gopc;       //åˆ›å»ºè¿™ä¸ªgoroutineçš„goè¡¨è¾¾å¼çš„pc
    ...
}

struct GoBuf
{
    unintptr sp;    // å½“å‰æ ˆæŒ‡é’ˆ   
    byte* pc;       // ç¨‹åºè®¡æ•°å™¨    
    G* g;           // goroutineæœ¬èº«
    ...
}

// Machine å¯¹ç‰©ç†çº¿ç¨‹çš„æŠ½è±¡
struct M
{
    G* g0;                      // å¸¦æœ‰è°ƒåº¦æ ˆçš„goroutine, Må¯¹åº”çš„çº¿ç¨‹çš„æ ˆ
    G* gsignal;                 // å¤„ç†ä¿¡å·çš„goroutine
    void (*mstartfn)(void);     // 
    G* curg;                    // Mä¸­å½“å‰è¿è¡Œçš„goroutine
    P* p;                       // å…³è”på»æ‰§è¡Œgoä»£ç ï¼Œï¼ˆæ²¡æœ‰æ‰§è¡Œgoä»£ç æ—¶ï¼Œpä¸ºnilï¼‰
    P* nextp;
}

struct P
{
    Lock;
    uint32 status;  //Pidle, Prunning, Psyscall, Pgcstop, Pdead
    P* link;
    M* m // é“¾æ¥åˆ°å…³è”çš„M
    G* runq[256]
    int32 runqhead;
    int32 runqtail;
}

// å¤šæ•°ä¿¡æ¯å·²åœ¨M G P ä¸­å®šä¹‰ï¼Œ Schedæ˜¯ä¸€ä¸ªç©ºå®¢çš„å°è£…
struct Sched 
{
    Lock;
    uint64 goidgen;

    M* midle;
}

</code></pre></td></tr></table>
</div>
</div><hr>
<ul>
<li>
<p>nil</p>
<ul>
<li>what is nil
<ul>
<li>nil is a kind of zero</li>
</ul>
</li>
<li>what is nil in go
<ul>
<li>å„ç§ç±»å‹çš„é›¶å€¼</li>
<li>zero value of all type value
<ul>
<li>bool false, number 0, string &quot;&quot;</li>
<li>pointer, slice, map, channel, function, interface{} ==&gt; nil</li>
<li>structure{}</li>
</ul>
</li>
<li>kind of nil
<ul>
<li>interface{} = (type, value) ==&gt; (nil, nil) == nil</li>
</ul>
</li>
</ul>
</li>
<li>what does nil mean</li>
<li>is nil useful ? yes</li>
</ul>
</li>
<li>
<p>æ™®é€šç±»å‹å¦‚ä½•è½¬ä¸ºinterfaceç±»å‹ï¼Œ convT2E</p>
</li>
<li>
<p>unsafe</p>
</li>
<li>
<p>unsafe.Pointer()</p>
<ul>
<li>T1æŒ‡é’ˆä¸ T2æŒ‡é’ˆç±»å‹ä¹‹é—´çš„è½¬æ¢</li>
<li>ä¿®æ”¹å†…å­˜æ•°æ® uintptr å¸¸ç”¨äºä¸ unsafe.Pointeré…åˆï¼Œç”¨äºåšæŒ‡é’ˆè¿ç®—</li>
</ul>
</li>
<li>
<p>go ast,llvm</p>
</li>
<li>
<p>gdbå•æ­¥è°ƒè¯•goç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹    Delve æ›´å¥½</p>
</li>
<li>
<p>å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨</p>
</li>
<li>
<p>vscode å¸¸è§åŠŸèƒ½é”® good tools</p>
<ul>
<li>Macä¸‹ vs codeè®¾ç½®æ–‡ä»¶ï¼š$HOME/Library/Application Support/Code/User/settings.json
<ul>
<li>æœ€å¼€å§‹ä½¿ç”¨run testæ—¶æ— è¾“å‡ºï¼Œ åœ¨settings.jsoné‡Œæ·»åŠ &quot;go.testFlags&quot;:[&quot;-V&quot;],</li>
</ul>
</li>
<li>é¢„è§ˆmdæ ¼å¼ï¼ˆâ‡§âŒ˜Vï¼‰</li>
</ul>
</li>
<li>
<p>vim go: <a href="https://octetz.com/docs/2019/2019-04-24-vim-as-a-go-ide/">https://octetz.com/docs/2019/2019-04-24-vim-as-a-go-ide/</a></p>
</li>
<li>
<p>Guru å¯¼èˆªgo ä»£ç çš„ç¼–è¾‘å™¨é›†æˆå·¥å…·</p>
<ul>
<li>å˜é‡ï¼Œå‡½æ•°çš„å£°æ˜åœ°ç‚¹</li>
<li>å˜é‡ï¼Œå‡½æ•°çš„æ‰€æœ‰å¼•ç”¨åœ°ç‚¹</li>
<li>å®ç°æ­¤æ¥å£çš„æ‰€æœ‰å…·ä½“ç±»å‹</li>
<li></li>
<li>golang.org/x/tools/cmd/guru</li>
<li><a href="http://golang.org/s/using-guru">http://golang.org/s/using-guru</a></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>golang fuzz testing</li>
</ul>
<hr>
<ul>
<li>avo
<ul>
<li>github.com/mmcloughlin/avo</li>
</ul>
</li>
<li>go assembly
<ul>
<li>ä¼˜åŠ¿ï¼š é¿å…ç¼–è¯‘å™¨çš„é”™è¯¯ä¼˜åŒ–ï¼Œä½¿ç”¨ç‰¹æ®Šçš„ç¡¬ä»¶æŒ‡ä»¤ï¼Œåœ¨æ•°å­¦è®¡ç®—ï¼Œå¯†ç ï¼Œç³»ç»Ÿè°ƒç”¨ï¼Œåº•å±‚è¿è¡Œç»†èŠ‚</li>
</ul>
</li>
<li>plan 9
<ul>
<li>show known better</li>
<li><a href="https://lrita.github.io/2017/12/12/golang-asm/#go%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8">https://lrita.github.io/2017/12/12/golang-asm/#go%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8</a></li>
<li><a href="https://lrita.github.io/images/posts/go/GoFunctionsInAssembly.pdf">https://lrita.github.io/images/posts/go/GoFunctionsInAssembly.pdf</a></li>
<li><a href="https://github.com/buptbill220/gotls/tree/master/interesting">https://github.com/buptbill220/gotls/tree/master/interesting</a></li>
<li>æŸ¥çœ‹å½“å‰cpuæ¶æ„çš„æŒ‡ä»¤é›†åˆ cat /proc/cpuinfo | grep flags | head -1</li>
<li>æŒ‡ä»¤æŸ¥è¯¢ï¼š <a href="http://68k.hax.com/">http://68k.hax.com/</a></li>
<li>å‘½ä»¤æŸ¥è¯¢ï¼šhttps://9p.io/magic/man2html/1/8a</li>
<li>plan9 æ–‡æ¡£ï¼š <a href="https://9p.io/sys/doc/">https://9p.io/sys/doc/</a></li>
</ul>
</li>
<li><a href="https://defuse.ca/online-x86-assembler.htm#disassembly2">https://defuse.ca/online-x86-assembler.htm#disassembly2</a>
<ul>
<li>x86 or x64 assembly instructions encoding&lt;==&gt; decoding binary code</li>
<li>It uses GCC and objdump behind the scenes</li>
</ul>
</li>
</ul>

      </article>
    </div>

    <div class="article-nav" id="article-nav-id">
        <nav class="hide-on-mobile section-nav">
          <h3 class="ml-1">Table of contents</h3>
            <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#an-overview-of-gos-tooling">an overview of go's tooling</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </nav>
    </div>

    
        <div class="tags">
            
                <a href="http://brettkk.github.io/tags/golang">golang</a>
            
        </div>
    

    <div class="post-comment">
      
             
      
      
      


<div class="post bg-white">
    <script src="https://utteranc.es/client.js"
          repo="brettkk/brettkk.github.io"
          issue-term="pathname"
          theme="github-light"
          crossorigin="anonymous"
          async>
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>
</div>
    </div>
    

</section>

<script>
	window.addEventListener('DOMContentLoaded', () => {
		const observerForTableOfContentActiveState = new IntersectionObserver(entries => {
			entries.forEach(entry => {
				const id = entry.target.getAttribute('id');

				if (entry.intersectionRatio > 0) {					
					clearActiveStatesInTableOfContents();				
					document.querySelector(`nav li a[href="#${id}"]`).parentElement.classList.add('active');
				}
			});
		});		
		document.querySelectorAll('h1[id],h2[id],h3[id],h4[id]').forEach((section) => {
			observerForTableOfContentActiveState.observe(section);
		});

	});

	function clearActiveStatesInTableOfContents() {
		document.querySelectorAll('nav li').forEach((section) => {
			section.classList.remove('active');
		});
	}
</script>


    </main>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_SVG"></script>
<footer id="footer">
    

    <p class="copyright">
    
       Â© Copyright 
       2021 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       
    
    </p>
    <p class="powerby">
        Powered by <a href="http://www.gohugo.io/">Hugo</a> Theme By <a href="https://github.com/nodejh/hugo-theme-cactus-plus">nodejh</a>
    </p>
</footer>

  </body>
</html>
