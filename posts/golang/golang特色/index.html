<!DOCTYPE html>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css">
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<html lang="zh-cn">
  <head>
    <title>golang | brettkk</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="èµ„æ–™ ğŸ”— ç›®å‰ golang çš„ä¸»è¦ maintainer ä¹‹ä¸€: Russ Coxã€‚ä¸ªäººä¸»é¡µï¼šswtch.c">
<meta name="generator" content="Hugo 0.103.1" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link href="https://cdn.bootcss.com/highlight.js/9.15.10/styles/zenburn.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<link rel="stylesheet" href="http://brettkk.github.io/css/syntax.css" />


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />




  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>




  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">golang</h1>

    <div class="tip">
        <time datetime="2022-05-07 18:54:41 &#43;0800 CST">May 7, 2022</time>
        <span class="split">
          Â·
        </span>
        <span>
          4833 words
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          10 minute read
        </span>
    </div>

    
    
        
  
    <aside class="toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#èµ„æ–™">èµ„æ–™</a>
      <ul>
        <li><a href="#å®˜æ–¹åœ°å€æ”¹åŠ¨">å®˜æ–¹åœ°å€æ”¹åŠ¨</a></li>
        <li><a href="#æ„å»º-golang-å¼€å‘ç¯å¢ƒ">æ„å»º golang å¼€å‘ç¯å¢ƒ</a></li>
        <li><a href="#ç¼–è¯‘-golang-çš„æºç é¡¹ç›®">ç¼–è¯‘ golang çš„æºç é¡¹ç›®</a></li>
      </ul>
    </li>
    <li><a href="#å˜é‡çš„å†…å­˜å¤§å°">å˜é‡çš„å†…å­˜å¤§å°</a></li>
    <li><a href="#å¤šæ€ç»§æ‰¿-èŒƒå‹">å¤šæ€ï¼Œç»§æ‰¿ï¼Œ èŒƒå‹</a>
      <ul>
        <li><a href="#ç»§æ‰¿">ç»§æ‰¿</a></li>
        <li><a href="#why-ä¸ºä»€ä¹ˆéœ€è¦åœ¨-golang-ä½¿ç”¨-embedding">why ä¸ºä»€ä¹ˆéœ€è¦åœ¨ golang ä½¿ç”¨ embedding</a></li>
        <li><a href="#what-ä»€ä¹ˆæ˜¯åµŒå…¥">what ä»€ä¹ˆæ˜¯åµŒå…¥</a></li>
        <li><a href="#åœ¨-struct-ä¸­åµŒå…¥-struct">åœ¨ struct ä¸­åµŒå…¥ struct</a></li>
        <li><a href="#åœ¨-interface-ä¸­åµŒå…¥-interface">åœ¨ interface ä¸­åµŒå…¥ interface</a></li>
        <li><a href="#åœ¨-struct-ä¸­åµŒå…¥-interface">åœ¨ struct ä¸­åµŒå…¥ interface</a></li>
        <li><a href="#how">how</a>
          <ul>
            <li><a href="#å¤šæ€">å¤šæ€</a></li>
            <li><a href="#èŒƒå‹">èŒƒå‹</a></li>
            <li><a href="#æ¥å£çš„ä½¿ç”¨å®è·µ">æ¥å£çš„ä½¿ç”¨å®è·µ</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#æ˜“æ¨¡ç³Šçš„ç‚¹">æ˜“æ¨¡ç³Šçš„ç‚¹</a>
      <ul>
        <li><a href="#å­—ç¬¦ç¼–ç ">å­—ç¬¦ç¼–ç </a></li>
        <li><a href="#æµ®ç‚¹æ•°çš„å­˜å‚¨ä¸å¤„ç†">æµ®ç‚¹æ•°çš„å­˜å‚¨ä¸å¤„ç†</a></li>
        <li><a href="#rune-ç±»å‹">rune ç±»å‹</a></li>
        <li><a href="#æ•°ç»„ä¸åˆ‡ç‰‡">æ•°ç»„ä¸åˆ‡ç‰‡</a></li>
        <li><a href="#for-range-çš„æ³¨æ„ç‚¹">for range çš„æ³¨æ„ç‚¹</a></li>
        <li><a href="#å‡½æ•°çš„æ¥å—è€…">å‡½æ•°çš„æ¥å—è€…</a></li>
        <li><a href="#golang-å€¼æ‹·è´">golang å€¼æ‹·è´</a></li>
        <li><a href="#é—­åŒ…">é—­åŒ…</a></li>
        <li><a href="#unsafe-åŒ…">unsafe åŒ…</a></li>
        <li><a href="#åå°„">åå°„</a></li>
      </ul>
    </li>
    <li><a href="#å†…å­˜ç®¡ç†">å†…å­˜ç®¡ç†</a></li>
    <li><a href="#golang-ä¸­çš„ç‰¹è‰²è¯­æ³•">golang ä¸­çš„ç‰¹è‰²è¯­æ³•</a>
      <ul>
        <li><a href="#defer-recover">defer, recover</a></li>
        <li><a href="#nil">nil</a></li>
        <li><a href="#å‡½æ•°è°ƒç”¨çš„ç±»å‹">å‡½æ•°è°ƒç”¨çš„ç±»å‹</a></li>
        <li><a href="#goroutine"><code>goroutine</code></a></li>
        <li><a href="#interfaceä¸interface"><code>interface</code>ä¸<code>interface{}</code></a></li>
      </ul>
    </li>
    <li><a href="#go-è®¾è®¡æ¨¡å¼">go è®¾è®¡æ¨¡å¼</a>
      <ul>
        <li><a href="#åˆ›å»ºå‹">åˆ›å»ºå‹</a></li>
        <li><a href="#è£…é¥°å™¨æ¨¡å¼-decorator-pattern">è£…é¥°å™¨æ¨¡å¼ decorator pattern</a></li>
        <li><a href="#ä»£ç†æ¨¡å¼-proxy-pattern">ä»£ç†æ¨¡å¼ proxy pattern</a></li>
        <li><a href="#è§‚å¯Ÿè€…æ¨¡å¼-observer-pattern">è§‚å¯Ÿè€…æ¨¡å¼ observer pattern</a></li>
        <li><a href="#ç­–ç•¥æ¨¡å¼-strategy-pattern">ç­–ç•¥æ¨¡å¼ strategy pattern</a></li>
        <li><a href="#è´£ä»»é“¾">è´£ä»»é“¾</a></li>
      </ul>
    </li>
    <li><a href="#reference">reference</a></li>
  </ul>
</nav>
          </div>
      </details>
    </aside>
  


    


    <div class="content">
      <h1 id="èµ„æ–™">èµ„æ–™ <a href="#%e8%b5%84%e6%96%99" class="anchor">ğŸ”—</a></h1><ol>
<li>ç›®å‰ golang çš„ä¸»è¦ maintainer ä¹‹ä¸€: Russ Coxã€‚ä¸ªäººä¸»é¡µï¼šswtch.com/~rsc/</li>
<li>awesome-go ç³»åˆ—</li>
</ol>
<p>ç»ƒä¹ æ“åœº playground: go.dev/playã€‚ rust åæ¥ä¹Ÿæœ‰ playgroundã€‚</p>
<h2 id="å®˜æ–¹åœ°å€æ”¹åŠ¨">å®˜æ–¹åœ°å€æ”¹åŠ¨ <a href="#%e5%ae%98%e6%96%b9%e5%9c%b0%e5%9d%80%e6%94%b9%e5%8a%a8" class="anchor">ğŸ”—</a></h2><p>æ—©æœŸéƒ½æ˜¯ golang.org =&gt; ç°åœ¨ go.devï¼Œ play.golang.org =&gt; go.dev/play</p>
<h2 id="æ„å»º-golang-å¼€å‘ç¯å¢ƒ">æ„å»º golang å¼€å‘ç¯å¢ƒ <a href="#%e6%9e%84%e5%bb%ba-golang-%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83" class="anchor">ğŸ”—</a></h2><ol>
<li>ä¸‹è½½å®‰è£…åŒ… wget <a href="https://golang.google.cn/dl/go1.19.2.src.tar.gz" target="_blank" rel="noopener">https://golang.google.cn/dl/go1.19.2.src.tar.gz</a> <br>
google åŸŸåä¸‹çš„åœ°å€å¯èƒ½è¢«å¢™ä¸èƒ½è®¿é—®ã€‚ <br>
æˆ–è€… <a href="https://go.dev/dl/" target="_blank" rel="noopener">https://go.dev/dl/</a> åœ°å€ã€‚</li>
<li>è§£å‹å¹¶å®‰è£…åˆ°æŒ‡å®šç›®å½• tar -zxvf xx.tar.gz -C /usr/local</li>
<li>é…ç½®ç¯å¢ƒå˜é‡</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>vim .bash_profile
</span></span><span style="display:flex;"><span>export GOROOT=~/..
</span></span><span style="display:flex;"><span>export PATH=$PATH:$GOROOT/bin
</span></span><span style="display:flex;"><span>export GOPATH=~/..
</span></span><span style="display:flex;"><span>source .bash_profile
</span></span></code></pre></div><ol start="4">
<li>æœ€åï¼ŒéªŒè¯ä¸€ä¸‹ go versionã€‚go envã€‚</li>
</ol>
<h2 id="ç¼–è¯‘-golang-çš„æºç é¡¹ç›®">ç¼–è¯‘ golang çš„æºç é¡¹ç›® <a href="#%e7%bc%96%e8%af%91-golang-%e7%9a%84%e6%ba%90%e7%a0%81%e9%a1%b9%e7%9b%ae" class="anchor">ğŸ”—</a></h2><p>ä»æºç å»ç¼–è¯‘ golang é¡¹ç›®ã€‚<br></p>
<ul>
<li>git clone <a href="https://github.com/golang/go.git" target="_blank" rel="noopener">https://github.com/golang/go.git</a></li>
<li>è®¾ç½® golang è‡ªä¸¾ç¼–è¯‘å™¨çš„åœ°å€ã€‚ export GOROOT_BOOTSTRAP=$GOROOT(æˆ–è€…å…¶ä»–)</li>
<li>è¿›å»æºç ç›®å½•ä¸­çš„ all.bash è„šæœ¬ã€‚ ./go/src/all.bashã€‚ æˆ–è€…./go/src/make.bash è„šæœ¬ä¼šåˆ©ç”¨è‡ªå±…ç¼–è¯‘å™¨ GOROOT_BOOTSTRAP å»ç¼–è¯‘ golang æºç é¡¹ç›®ã€‚</li>
<li>æœ€åçš„ç¼–è¯‘äº§ç”Ÿäº†ï½/go/src/github.com/golang/goï¼Œ ~/go/src/github.com/golang/go/bin, pkg åº“æ–‡ä»¶ç­‰ã€‚</li>
<li>éªŒè¯æ”¹åŠ¨åçš„æ‰§è¡Œå‘½ä»¤ åˆ©ç”¨æ–°ç¼–è¯‘å™¨çš„ç»å¯¹è·¯å¾„ã€‚ ~/go/src/github.com/golang/go run test_print.goã€‚</li>
</ul>
<p>go build -n main.go ä¸ç¼–è¯‘å¹¶æ‰“å°ç¼–è¯‘çš„è¿‡ç¨‹ã€‚ -n å‚æ•°å’Œ make çš„-n å‚æ•°æ˜¯ä¸€è‡´çš„ã€‚</p>
<h1 id="å˜é‡çš„å†…å­˜å¤§å°">å˜é‡çš„å†…å­˜å¤§å° <a href="#%e5%8f%98%e9%87%8f%e7%9a%84%e5%86%85%e5%ad%98%e5%a4%a7%e5%b0%8f" class="anchor">ğŸ”—</a></h1><p>æ²¡æœ‰<code>char</code>ç±»å‹ï¼Œç‰¹æ·»åŠ <code>type rune = int32</code>ç±»å‹å¤„ç†<code>utf-8</code>çš„å˜é•¿å­—ç¬¦ç¼–ç é—®é¢˜ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;runtime&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;unsafe&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;arch=%s, os=%s\n&#34;</span>, <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GOARCH</span>, <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GOOS</span>) <span style="color:#75715e">//arch=amd64, os=linux
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#66d9ef">int</span> = <span style="color:#ae81ff">190</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type=%T, size=%d\n&#34;</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">a</span>)) <span style="color:#75715e">//type=int, size=8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">int32</span> = <span style="color:#ae81ff">190</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type=%T, size=%d\n&#34;</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">b</span>)) <span style="color:#75715e">//type=int32, size=4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">c</span> <span style="color:#66d9ef">uint8</span> = <span style="color:#e6db74">&#39;a&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type=%T, size=%d\n&#34;</span>, <span style="color:#a6e22e">c</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">c</span>)) <span style="color:#75715e">//type=uint8, size=1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">d</span> <span style="color:#66d9ef">rune</span> = <span style="color:#e6db74">&#39;ä¸­&#39;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type=%T, size=%d\n&#34;</span>, <span style="color:#a6e22e">d</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">d</span>)) <span style="color:#75715e">//type=int32, size=4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">e</span> <span style="color:#66d9ef">string</span> = <span style="color:#e6db74">&#34;a&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type=%T, size=%d\n&#34;</span>, <span style="color:#a6e22e">e</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">e</span>)) <span style="color:#75715e">//type=string, size=16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">f</span> <span style="color:#66d9ef">string</span> = <span style="color:#e6db74">&#34;ä¸­&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type=%T, size=%d\n&#34;</span>, <span style="color:#a6e22e">f</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">f</span>)) <span style="color:#75715e">//type=string, size=16
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h1 id="å¤šæ€ç»§æ‰¿-èŒƒå‹">å¤šæ€ï¼Œç»§æ‰¿ï¼Œ èŒƒå‹ <a href="#%e5%a4%9a%e6%80%81%e7%bb%a7%e6%89%bf-%e8%8c%83%e5%9e%8b" class="anchor">ğŸ”—</a></h1><p>golang ä¸­å®ç°çš„é¢å‘å¯¹è±¡çš„æ–¹å¼</p>
<h2 id="ç»§æ‰¿">ç»§æ‰¿ <a href="#%e7%bb%a7%e6%89%bf" class="anchor">ğŸ”—</a></h2><p>golang ä¸­æ²¡æœ‰ç»§æ‰¿ï¼Œåˆ©ç”¨ç»„åˆç»“æ„ä½“å®ç°ç±»ä¼¼ç»§æ‰¿çš„åŠŸèƒ½ã€‚<br>
ä¸€ä¸ªç»“æ„ä½“åµŒå…¥å¦ä¸€ä¸ªç»“æ„ä½“ï¼Œèƒ½å¤Ÿå®ç°å¯¹åµŒå…¥ç»“æ„ä½“çš„å­—æ®µä»¥åŠå…¶å®ç°çš„æ–¹æ³•çš„ç»§æ‰¿ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">person</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">age</span>  <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">student</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">person</span> <span style="color:#75715e">//   åŒ¿åå­—æ®µï¼Œé€šè¿‡ç»„åˆçš„æ–¹å¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">school</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">person</span>) <span style="color:#a6e22e">talk</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">student</span>) <span style="color:#a6e22e">getSchool</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">school</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">student</span>{<span style="color:#a6e22e">person</span>{<span style="color:#e6db74">&#34;brettkk&#34;</span>, <span style="color:#ae81ff">18</span>}, <span style="color:#e6db74">&#34;yidu&#34;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">name</span>) <span style="color:#75715e">// ç»§æ‰¿personçš„nameå­—æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">talk</span>() <span style="color:#75715e">// ç»§æ‰¿personå®ç°çš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="why-ä¸ºä»€ä¹ˆéœ€è¦åœ¨-golang-ä½¿ç”¨-embedding">why ä¸ºä»€ä¹ˆéœ€è¦åœ¨ golang ä½¿ç”¨ embedding <a href="#why-%e4%b8%ba%e4%bb%80%e4%b9%88%e9%9c%80%e8%a6%81%e5%9c%a8-golang-%e4%bd%bf%e7%94%a8-embedding" class="anchor">ğŸ”—</a></h2><p>golang ä¸­æ²¡æœ‰ extendsï¼Œ implement ç­‰ç»§æ‰¿æ¦‚å¿µã€‚<br>
golang ä¸­é€šè¿‡ç»„åˆæ¥å®ç°ç±»ä¼¼ç»§æ‰¿çš„åŠŸèƒ½ã€‚<br>
embedding æ¯”è¾ƒæ–¹ä¾¿ç»„åˆ golang ä¸­çš„ structï¼Œinterface æ¥å®ç°ç±»ä¼¼å…¶ä»–è¯­è¨€ä¸­çš„ç»§æ‰¿å’Œå®ç°çš„æ¦‚å¿µã€‚<br></p>
<h2 id="what-ä»€ä¹ˆæ˜¯åµŒå…¥">what ä»€ä¹ˆæ˜¯åµŒå…¥ <a href="#what-%e4%bb%80%e4%b9%88%e6%98%af%e5%b5%8c%e5%85%a5" class="anchor">ğŸ”—</a></h2><p>æœ‰ä¸‰ç§åµŒå…¥çš„æƒ…å†µï¼š</p>
<ol>
<li>embedding struct in struct</li>
<li>embedding interface in interface</li>
<li>embedding interface in struct</li>
</ol>
<h2 id="åœ¨-struct-ä¸­åµŒå…¥-struct">åœ¨ struct ä¸­åµŒå…¥ struct <a href="#%e5%9c%a8-struct-%e4%b8%ad%e5%b5%8c%e5%85%a5-struct" class="anchor">ğŸ”—</a></h2><ol>
<li>å¯ä»¥ç›´æ¥è®¿é—®åµŒå…¥çš„ç»“æ„ä½“</li>
<li>å¯ä»¥ç›´æ¥è°ƒç”¨åµŒå…¥çš„ç»“æ„ä½“ä¸Šçš„æ–¹æ³•</li>
<li>ä¸Šä¸€æ¡æ»¡è¶³ï¼Œè‡ªç„¶åœ°è¢«åµŒå…¥çš„ç»“æ„ä½“å®ç°äº†æ¥å£ï¼Œå¤–å±‚ç»“æ„ä½“ä¹Ÿå°±å®ç°äº†æ¥å£</li>
</ol>
<p>ä¾‹å¦‚ï¼š åœ¨ go ä¸­ç›®æ ‡ç»“æ„ä½“ A ä¸­åµŒå…¥ sync.Mutexã€‚æ–¹ä¾¿ä½¿ç”¨ A.lock()å¯ä»¥åŠ é”ã€‚å¦‚æœ lock åªåœ¨å†…éƒ¨ä½¿ç”¨ï¼Œè¿˜æ˜¯æ­£å¸¸ä½¿ç”¨<code>mu sync.Mutex</code></p>
<h2 id="åœ¨-interface-ä¸­åµŒå…¥-interface">åœ¨ interface ä¸­åµŒå…¥ interface <a href="#%e5%9c%a8-interface-%e4%b8%ad%e5%b5%8c%e5%85%a5-interface" class="anchor">ğŸ”—</a></h2><p>interface å¯ä»¥è¢«åµŒå…¥åˆ°å¦ä¸€ä¸ª interface ä¸­ï¼Œä¹Ÿå¯ä»¥åµŒå…¥åˆ° struct ä¸­ã€‚<br>
interface è¢«åµŒå…¥åˆ° interface ä¸­ï¼Œé€šè¿‡ç»„åˆçš„æ–¹å¼æ‰©å±•äº†æ¥å£ä¸­çš„å‡½æ•°é›†åˆã€‚
golang æ ‡å‡†åº“ä¸­ Reader å’Œ Writer æ¥å£è¢«åµŒå…¥ï¼ˆç»„åˆï¼‰åˆ° ReadWriter æ¥å£ã€‚<br>
golang çš„ container åŒ…ä¸­å­åŒ… heap ä¸­ï¼Œé€šè¿‡ embedding interface çš„æ–¹å¼è¡¨æ˜è‹¥è¦å®ç° heap.Interface æ¥å£å¿…é¡»è¦å…ˆå®ç° sort.Interface æ¥å£ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// heap.Interface
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Interface</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sort</span>.<span style="color:#a6e22e">Interface</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Push</span>(<span style="color:#a6e22e">x</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#75715e">// add x as element Len()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">Pop</span>() <span style="color:#66d9ef">interface</span>{}   <span style="color:#75715e">// remove and return element Len() - 1.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// sort.Interface
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Interface</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Len</span>() <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Less</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Swap</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span> <span style="color:#66d9ef">int</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">Push</span>(<span style="color:#a6e22e">x</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#75715e">// add x as element Len()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#a6e22e">Pop</span>() <span style="color:#66d9ef">interface</span>{}   <span style="color:#75715e">// remove and return element Len() - 1.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="åœ¨-struct-ä¸­åµŒå…¥-interface">åœ¨ struct ä¸­åµŒå…¥ interface <a href="#%e5%9c%a8-struct-%e4%b8%ad%e5%b5%8c%e5%85%a5-interface" class="anchor">ğŸ”—</a></h2><p>è¿™ä¸ªæ˜¯ä¸‰ç§ embedding ä¸­è®©äººç–‘æƒ‘çš„ä¸€ç§ã€‚<br></p>
<ul>
<li>struct ç±»å‹çš„å¯¹è±¡å¯ä»¥è®¿é—®å†…åµŒæ¥å£ä¸­çš„æ–¹æ³•ï¼ˆ<strong>æå‡åˆ°å¤–å±‚ç»“æ„ä½“ä¸­</strong>ï¼‰</li>
<li>ä¸Šä¸€æ¡æ»¡è¶³ï¼Œè‡ªç„¶åœ° struct ç±»å‹çš„å¯¹è±¡ä¹Ÿå®ç°äº†å†…åµŒæ¥å£ã€‚</li>
</ul>
<p>å¦‚æœåˆå§‹åŒ– struct ç±»å‹å¯¹è±¡æ—¶ï¼Œæ²¡æœ‰åˆå§‹åŒ– embedding interface åˆ™ embedding interface è¢«åˆå§‹åŒ–ä¸º nilï¼Œ åˆ™è®¿é—® embedding interface ä¸­çš„æ–¹æ³•æ—¶ panicã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">StatsConn</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">net</span>.<span style="color:#a6e22e">Conn</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">BytesRead</span> <span style="color:#66d9ef">uint64</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// æ‹¦æˆªnet.Conn.Readæ–¹æ³•ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">sc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">StatsConn</span>) <span style="color:#a6e22e">Read</span>(<span style="color:#a6e22e">p</span> []<span style="color:#66d9ef">byte</span>) (<span style="color:#66d9ef">int</span>, <span style="color:#66d9ef">error</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">n</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">sc</span>.<span style="color:#a6e22e">Conn</span>.<span style="color:#a6e22e">Read</span>(<span style="color:#a6e22e">p</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sc</span>.<span style="color:#a6e22e">BytesRead</span> <span style="color:#f92672">+=</span> uint64(<span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">n</span>, <span style="color:#a6e22e">err</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">resp</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ioutil</span>.<span style="color:#a6e22e">ReadAll</span>(<span style="color:#a6e22e">sconn</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fatal</span>(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">sconn</span>.<span style="color:#a6e22e">BytesRead</span>)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">reverse</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sort</span>.<span style="color:#a6e22e">Interface</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">r</span> <span style="color:#a6e22e">reverse</span>) <span style="color:#a6e22e">Less</span>(<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">j</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Interface</span>.<span style="color:#a6e22e">Less</span>(<span style="color:#a6e22e">j</span>, <span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Reverse</span>(<span style="color:#a6e22e">data</span> <span style="color:#a6e22e">sort</span>.<span style="color:#a6e22e">Interface</span>) <span style="color:#a6e22e">sort</span>.<span style="color:#a6e22e">Interface</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">reverse</span>{<span style="color:#a6e22e">data</span>}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">sort</span>.<span style="color:#a6e22e">Sort</span>(<span style="color:#a6e22e">sort</span>.<span style="color:#a6e22e">Reverse</span>(<span style="color:#a6e22e">sort</span>.<span style="color:#a6e22e">IntSlice</span>(<span style="color:#a6e22e">lst</span>)))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">lst</span>)
</span></span></code></pre></div><p>Example: context.WithValue.</p>
<h2 id="how">how <a href="#how" class="anchor">ğŸ”—</a></h2><p>è¯­æ³•ç³–ï¼Œä¾èµ–ç¼–è¯‘é˜¶æ®µçš„è¯­æ³•è§£æçš„å¤„ç†ã€‚</p>
<h3 id="å¤šæ€">å¤šæ€ <a href="#%e5%a4%9a%e6%80%81" class="anchor">ğŸ”—</a></h3><p>go æ²¡æœ‰ implements, extends å…³é”®å­—ï¼Œ golang æ˜¯å»é¸­å­ç±»å‹ï¼šçœ‹èµ·æ¥åƒé¸­å­ï¼Œ é‚£ä¹ˆå®ƒå°±æ˜¯é¸­å­ã€‚<br>
å¤šæ€ï¼š çˆ¶ç±»æŒ‡é’ˆæˆ–å¼•ç”¨å»è°ƒç”¨æ–¹æ³•ï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ ¹æ®å­ç±»çš„ç±»å‹å»æ‰§è¡Œå­ç±»å½“ä¸­çš„æ–¹æ³•ã€‚<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">gender</span>() <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Men</span> <span style="color:#66d9ef">struct</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Gender</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Woman</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Gender</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span> <span style="color:#a6e22e">strings</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#a6e22e">Men</span>) <span style="color:#a6e22e">gender</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Gender</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">Woman</span>) <span style="color:#a6e22e">gender</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Gender</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">JudgeFunc</span>() <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// may has many code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// can&#39;t not get boolean result until running this JudgeFunc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// so compiler can&#39;t not known clearly about the type info of a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">a</span> = <span style="color:#a6e22e">JudgeFunc</span>() <span style="color:#960050;background-color:#1e0010">?</span> <span style="color:#a6e22e">Men</span>{} : <span style="color:#a6e22e">Woman</span>{}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// compiler can judge the type info of a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">b</span> = <span style="color:#a6e22e">Men</span>{} <span style="color:#75715e">// or b = Woman{}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="èŒƒå‹">èŒƒå‹ <a href="#%e8%8c%83%e5%9e%8b" class="anchor">ğŸ”—</a></h3><p>ç©º interface{} ç±»å‹ï¼Œæ²¡æœ‰æ–¹æ³•é›†çš„æ¥å£ï¼Œåªéœ€è¦å­˜ç±»å‹å’Œç±»å‹å¯¹åº”çš„å€¼å³å¯ã€‚<br>
ç©º<code>interface{} = (type, value)</code> ==&gt; <code>(nil, nil) == nil</code> <br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// ä¸å«æ–¹æ³•çš„ç©ºæ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">eface</span> <span style="color:#66d9ef">struct</span> {       <span style="color:#75715e">// 16 byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">_type</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">_type</span>          <span style="color:#75715e">// æŒ‡å‘ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">data</span>  <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>  <span style="color:#75715e">// æŒ‡å‘æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å«æœ‰æ–¹æ³•çš„æ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">iface</span> <span style="color:#66d9ef">struct</span> {       <span style="color:#75715e">// 16 byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">tab</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">itab</span>             <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>   <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">_type</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">size</span> <span style="color:#66d9ef">uintptr</span> <span style="color:#75715e">// ç±»å‹å ç”¨çš„å†…å­˜å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">ptrdata</span> <span style="color:#66d9ef">uintptr</span> <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">hash</span> <span style="color:#66d9ef">int32</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">align</span> <span style="color:#66d9ef">uint8</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">itab</span> <span style="color:#66d9ef">struct</span> {        <span style="color:#75715e">// 32 byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">inter</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">interfacetype</span>  <span style="color:#75715e">// ç±»å‹ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">_type</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">_type</span>          <span style="color:#75715e">// ç±»å‹ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">hash</span> <span style="color:#66d9ef">uint32</span>           <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">_</span> [<span style="color:#ae81ff">4</span>]<span style="color:#66d9ef">byte</span>             <span style="color:#75715e">// padding align size = 8 byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fun</span> [<span style="color:#ae81ff">1</span>]<span style="color:#66d9ef">uintptr</span>        <span style="color:#75715e">// ç”¨æˆ·è¿è¡Œæ—¶åŠ¨æ€æ´¾å‘çš„è™šå‡½æ•°è¡¨ï¼Œå­˜å‚¨å‡½æ•°æŒ‡é’ˆã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="æ¥å£çš„ä½¿ç”¨å®è·µ">æ¥å£çš„ä½¿ç”¨å®è·µ <a href="#%e6%8e%a5%e5%8f%a3%e7%9a%84%e4%bd%bf%e7%94%a8%e5%ae%9e%e8%b7%b5" class="anchor">ğŸ”—</a></h3><p>golang æºç é‡Œçš„è¾ƒå¥½å®ç°æ–¹å¼æ˜¯ï¼š ä½¿ç”¨å°çš„æ¥å£ï¼Œå°¤å…¶æ˜¯åªåŒ…å«ä¸€ä¸ªæ–¹æ³•çš„æ¥å£ï¼›é€šè¿‡å°æ¥å£çš„ç»„åˆæ¥å®šä¹‰å¤§æ¥å£ã€‚<br>
å¥½å¤„æ˜¯ï¼šä½¿ç”¨è€…å¯ä»¥åªä¾èµ–äºå¿…è¦åŠŸèƒ½çš„æœ€å°æ¥å£ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Reader</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Read</span>(<span style="color:#a6e22e">p</span> []<span style="color:#66d9ef">byte</span>) (<span style="color:#a6e22e">n</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Writer</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Write</span>(<span style="color:#a6e22e">p</span> []<span style="color:#66d9ef">byte</span>) (<span style="color:#a6e22e">n</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ReadWriter</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Reader</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Writer</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">store</span>(<span style="color:#a6e22e">reader</span> <span style="color:#a6e22e">Reader</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å…¥å‚å¯ä»¥åªä¾èµ–äºå¿…è¦åŠŸèƒ½çš„æœ€å°æ¥å£ï¼Œ è®©å‡½æ•°çš„è¿”å›æ›´å¹¿
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">store</span>(<span style="color:#a6e22e">readWriter</span> <span style="color:#a6e22e">ReadWriter</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å…¥å‚ä¾èµ–äº†ä¸å¿…è¦åŠŸèƒ½çš„æ¥å£ï¼Œè®©é™åˆ¶äº†å‡½æ•°çš„ä½¿ç”¨èŒƒå›´ä¸ºæ›´å°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h1 id="æ˜“æ¨¡ç³Šçš„ç‚¹">æ˜“æ¨¡ç³Šçš„ç‚¹ <a href="#%e6%98%93%e6%a8%a1%e7%b3%8a%e7%9a%84%e7%82%b9" class="anchor">ğŸ”—</a></h1><h2 id="å­—ç¬¦ç¼–ç ">å­—ç¬¦ç¼–ç  <a href="#%e5%ad%97%e7%ac%a6%e7%bc%96%e7%a0%81" class="anchor">ğŸ”—</a></h2><p>ascii ç ï¼Œå ä¸€ä¸ªå­—èŠ‚ï¼Œå®é™…ä½¿ç”¨äº† 7 bit,128 ä¸ªå­—ç¬¦ï¼Œè¡¨ç¤ºè‹±è¯­å¤Ÿäº†ã€‚<br>
åœ¨ ascii ç çš„ç¬¬ 8 ä½ç½®ä¸º 0ï¼Œè¿™ä¸ªç‰¹ç‚¹æ·±æ·±å½±å“äº†å…¶ä»–å›½å®¶å’Œåæ¥çš„å­—ç¬¦ç¼–ç æ–¹å¼ã€‚<br>
æ¬§æ´²æ³•è¯­ Ã© ç­‰å­—ç¬¦ï¼Œé‡‡ç”¨ Latin1, åˆ©ç”¨ acsii ç çš„æœ€é«˜ä½ï¼Œ å¯ä»¥è¡¨ç¤ºäº†ã€‚<br>
äºšæ´²å›½å®¶çš„æ–‡å­—ç¬¦å·æ›´å¤šï¼Œæ±‰å­— 10 ä¸‡åŠ ï¼Œå¿…é¡»å¤šä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªç¬¦å·ã€‚ ä¾‹å¦‚ GB2312<br>
unicode ä¸‡å›½ç ã€‚åªæ˜¯å®šä¹‰äº†ç¬¦å·çš„äºŒè¿›åˆ¶ä»£ç ï¼Œå¦‚ä½•åŒºåˆ†ä¸åŒçš„ç¼–ç ï¼Ÿæ²¡æœ‰è§„å®šäºŒè¿›åˆ¶å¦‚ä½•å­˜æ”¾ã€‚ <br>
<strong>utf-8 å†å²</strong>ï¼Œ å¼€å‘ plan 9 æ“ä½œç³»ç»Ÿçš„äº§ç‰©ï¼Œå‘æ˜äº†åæ¥å¹¿æ³›ä½¿ç”¨çš„å­—ç¬¦ç¼–ç ã€‚<br>
utf-8 æ˜¯ä¸€ç§é’ˆå¯¹ unicode çš„å˜é•¿å­—ç¬¦ç¼–ç çš„å®ç°æ–¹å¼ã€‚ä½¿ç”¨ 1-4 ä¸ªå­—èŠ‚è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ã€‚<br>
äºŒè¿›åˆ¶ä»£ç ç¬¬ä¸€ä½æ˜¯ 0ï¼Œ åˆ™è¿™ä¸ªå­—ç¬¦åªå ä¸€ä¸ªå­—èŠ‚ã€‚
å¦‚æœç¬¬ä¸€ä½æ˜¯ 1ï¼Œè¿ç»­æœ‰å¤šå°‘ä¸ª 1ï¼Œè¡¨ç¤ºå½“å‰å­—ç¬¦å ç”¨å¤šå°‘ä¸ªå­—èŠ‚, åé¢å­—èŠ‚çš„å‰ä¸¤ä½å‡ä»¥ 10 å¼€å¤´ã€‚</p>
<pre tabindex="0"><code>ä¾‹å¦‚ ä¸¥ã€‚ unicode = 100111000100101 = 4E25,
utf-8=11100100 10111000 10100101 = E4B8A5.
</code></pre><h2 id="æµ®ç‚¹æ•°çš„å­˜å‚¨ä¸å¤„ç†">æµ®ç‚¹æ•°çš„å­˜å‚¨ä¸å¤„ç† <a href="#%e6%b5%ae%e7%82%b9%e6%95%b0%e7%9a%84%e5%ad%98%e5%82%a8%e4%b8%8e%e5%a4%84%e7%90%86" class="anchor">ğŸ”—</a></h2><p>å¤æ‚ todo</p>
<h2 id="rune-ç±»å‹">rune ç±»å‹ <a href="#rune-%e7%b1%bb%e5%9e%8b" class="anchor">ğŸ”—</a></h2><p>golang ä¸ºåº”å¯¹ utf-8 å­—ç¬¦å¤„ç†è®¾è®¡å‡ºæ¥çš„ä¸€ç§ç±»å‹<code>type rune = int32</code><br>
å­—ç¬¦ä¸²æœ‰å­—ç¬¦ç»„æˆï¼Œ å­—ç¬¦åˆ† 2 ç§ï¼Œ ä¸€ç§æ˜¯å  1byte çš„å­—ç¬¦ï¼Œå¦‚è‹±æ–‡å­—ç¬¦ï¼›ä¸€ç§æ˜¯å  1-4 byte çš„å­—ç¬¦ç”¨ rune è¡¨ç¤ºï¼Œå¦‚ä¸­æ–‡ã€‚<br>
ascii ç ï¼š <code>48-0, 65-A, 97-a</code>...<br>
åœ¨ builtin/builtin.go ä¸­å®šä¹‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">rune</span> = <span style="color:#66d9ef">int32</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(len(<span style="color:#e6db74">&#34;halloä¸­æ–‡&#34;</span>))<span style="color:#75715e">// 5 + 3 + 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(len([]rune(<span style="color:#e6db74">&#34;halloä¸­æ–‡&#34;</span>))) <span style="color:#75715e">//5 + 1 + 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">item</span>) <span style="color:#66d9ef">range</span> <span style="color:#e6db74">&#34;ABCä½ å¥½&#34;</span> {}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//ç­‰ä»·äº
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> (<span style="color:#a6e22e">index</span>, <span style="color:#a6e22e">item</span>) <span style="color:#66d9ef">range</span> []rune(<span style="color:#e6db74">&#34;ABCä½ å¥½&#34;</span>){}
</span></span></code></pre></div><h2 id="æ•°ç»„ä¸åˆ‡ç‰‡">æ•°ç»„ä¸åˆ‡ç‰‡ <a href="#%e6%95%b0%e7%bb%84%e4%b8%8e%e5%88%87%e7%89%87" class="anchor">ğŸ”—</a></h2><p>æ•°ç»„çš„åˆå§‹åŒ– ï¼ˆå…ƒç´ ç±»å‹ï¼Œ æ•°ç»„å¤§å°ï¼‰ã€‚ æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œ åˆ‡ç‰‡æ˜¯å¼•ç”¨ç±»å‹ã€‚ åˆ‡ç‰‡ä½œä¸ºå‡½æ•°çš„å‚æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// cmd/compile/internal/types.NewArray
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewArray</span>(<span style="color:#a6e22e">elem</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span>, <span style="color:#a6e22e">bound</span> <span style="color:#66d9ef">int64</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span> {<span style="color:#f92672">...</span>}
</span></span></code></pre></div><p>2 ç§åˆå§‹åŒ–æ–¹å¼ï¼Œæ˜¾å¼çš„æŒ‡å®šæ•°ç»„çš„å¤§å° <br/></p>
<ol>
<li>arr := [3]int{1, 2, 3}</li>
<li>[...]T å£°æ˜æ•°ç»„ // arr := [...]int{1, 2, 3}</li>
</ol>
<p>æ•°ç»„çš„è®¿é—®è¶Šç•Œæ£€æŸ¥ã€‚ ç¼–è¯‘æ—¶ cmd/compile/internal/gc.typecheck1 å‡½æ•° op=OINDEX æ—¶å¤„ç†ã€‚ssa é˜¶æ®µä¹Ÿä¼šæ’å…¥æ£€æŸ¥å‡½æ•° runtime.panicIndexã€‚</p>
<p>åˆ‡ç‰‡ï¼ŒåŠ¨æ€æ•°ç»„ã€‚</p>
<ul>
<li>å£°æ˜åˆ‡ç‰‡ []int, []interface{}</li>
<li>åˆå§‹åŒ–åˆ‡ç‰‡ []int{1,2,3}, slice := make([]int, 3)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// cmd/compile/internal/types.NewSlice
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewSlice</span>(<span style="color:#a6e22e">elem</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">SliceHeader</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Data</span> <span style="color:#66d9ef">uintptr</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Len</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Cap</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">StringHeader</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Data</span> <span style="color:#66d9ef">uintptr</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Len</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="for-range-çš„æ³¨æ„ç‚¹">for range çš„æ³¨æ„ç‚¹ <a href="#for-range-%e7%9a%84%e6%b3%a8%e6%84%8f%e7%82%b9" class="anchor">ğŸ”—</a></h2><p><code>for range x</code> x æ˜¯åŸå¯¹è±¡çš„æ‹·è´ã€‚</p>
<h2 id="å‡½æ•°çš„æ¥å—è€…">å‡½æ•°çš„æ¥å—è€… <a href="#%e5%87%bd%e6%95%b0%e7%9a%84%e6%8e%a5%e5%8f%97%e8%80%85" class="anchor">ğŸ”—</a></h2><p>å‡½æ•°æ¥å—è€…ä¸ºæŒ‡é’ˆç±»å‹:</p>
<ol>
<li>å‡½æ•°å¯ä»¥ä¿®æ”¹æ¥å—è€…çš„å†…å®¹</li>
<li>é¿å…æ–¹æ³•è°ƒç”¨æ—¶å˜é‡çš„æ‹·è´ï¼Œè€Œæ˜¯æŒ‡é’ˆçš„æ‹·è´</li>
</ol>
<p>å®ç°æ¥å—è€…ä¸ºå€¼ç±»å‹çš„æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨å®ç°æ¥å—è€…ä¸ºæŒ‡é’ˆç±»å‹çš„æ–¹æ³•ã€‚</p>
<h2 id="golang-å€¼æ‹·è´">golang å€¼æ‹·è´ <a href="#golang-%e5%80%bc%e6%8b%b7%e8%b4%9d" class="anchor">ğŸ”—</a></h2><p>go ä¸¥æ ¼ä¸Šåªæœ‰å¤åˆ¶æ‹·è´ä¼ é€’ï¼Œ æ€»æ˜¯åˆ›å»ºå‰¯æœ¬æŒ‰å€¼ä¼ é€’ï¼Œåªä¸è¿‡è¿™ä¸ªå‰¯æœ¬å¯ä»¥æ˜¯å˜é‡çš„å‰¯æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡é’ˆçš„å‰¯æœ¬</p>
<h2 id="é—­åŒ…">é—­åŒ… <a href="#%e9%97%ad%e5%8c%85" class="anchor">ğŸ”—</a></h2><p>é—­åŒ…=å‡½æ•°+å¼•ç”¨ç¯å¢ƒã€‚</p>
<h2 id="unsafe-åŒ…">unsafe åŒ… <a href="#unsafe-%e5%8c%85" class="anchor">ğŸ”—</a></h2><p><code>*T &lt;==&gt; unsafe.Pointer &lt;==&gt; uintptr</code>, uintptr ä¸ unsafe.Pointerï¼ˆç±»ä¼¼ void*ï¼‰</p>
<ol>
<li>T1 æŒ‡é’ˆä¸ T2 æŒ‡é’ˆç±»å‹ä¹‹é—´çš„è½¬æ¢</li>
<li>ä¿®æ”¹å†…å­˜æ•°æ®ï¼Œ uintptr å¸¸ç”¨äºä¸ unsafe.Pointer é…åˆï¼Œç”¨äºåšæŒ‡é’ˆè¿ç®—</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">//ç»“æ„ä½“çš„æˆå‘˜å˜é‡åœ¨å†…å­˜å­˜å‚¨ä¸Šæ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Num</span> <span style="color:#66d9ef">struct</span>{
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">j</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">n</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Num</span>{<span style="color:#a6e22e">i</span>: <span style="color:#e6db74">&#34;EDDYCJY&#34;</span>, <span style="color:#a6e22e">j</span>: <span style="color:#ae81ff">1</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">nPointer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ç»“æ„ä½“çš„åˆå§‹åœ°å€å°±æ˜¯ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡çš„å†…å­˜åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">niPointer</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#66d9ef">string</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">nPointer</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">niPointer</span> = <span style="color:#e6db74">&#34;wuhan&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// åŸºäºç»“æ„ä½“çš„æˆå‘˜åœ°å€å»è®¡ç®—åç§»é‡ã€‚å°±èƒ½å¤Ÿå¾—å‡ºå…¶ä»–æˆå‘˜å˜é‡çš„å†…å­˜åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">//uintptr æ˜¯ Go çš„å†…ç½®ç±»å‹ã€‚è¿”å›æ— ç¬¦å·æ•´æ•°ï¼Œå¯å­˜å‚¨ä¸€ä¸ªå®Œæ•´çš„åœ°å€ã€‚åç»­å¸¸ç”¨äºæŒ‡é’ˆè¿ç®—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">//unsafe.Offsetofï¼šè¿”å›æˆå‘˜å˜é‡ x åœ¨ç»“æ„ä½“å½“ä¸­çš„åç§»é‡ã€‚æ›´å…·ä½“çš„è®²ï¼Œå°±æ˜¯è¿”å›ç»“æ„ä½“åˆå§‹ä½ç½®åˆ° x ä¹‹é—´çš„å­—èŠ‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">//uintptr ç±»å‹æ˜¯ä¸èƒ½å­˜å‚¨åœ¨ä¸´æ—¶å˜é‡ä¸­çš„ ä¸´æ—¶å˜é‡æ˜¯å¯èƒ½è¢«åƒåœ¾å›æ”¶æ‰çš„ ä¹‹åçš„å†…å­˜æ“ä½œæœ‰è¿·èŒ«äº†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">njPointer</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#66d9ef">int64</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(uintptr(<span style="color:#a6e22e">nPointer</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Offsetof</span>(<span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">j</span>)))
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">njPointer</span> = <span style="color:#ae81ff">91</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;n.i: %s, n.j: %d&#34;</span>, <span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">j</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æŒ‡é’ˆæ˜¯å¯¹å†…å­˜åŒºåŸŸçš„åœ°å€ï¼Œ ä¸æŒ‡é’ˆç›¸é…åˆçš„ç±»å‹
è¯´æ˜åŒºåŸŸæœ‰å“ªäº›å±æ€§ï¼Œå¦‚ä½•å»è§£æã€‚</p>
<h2 id="åå°„">åå°„ <a href="#%e5%8f%8d%e5%b0%84" class="anchor">ğŸ”—</a></h2><p>åå°„ Reflection ï¼Œinterface å¯¹è±¡=ï¼ˆType, Valueï¼‰</p>
<p>åå°„ç±»å‹ reflect.Type, reflect.Value)</p>
<p>ä¸‰ç§åå°„çš„åŸºæœ¬æ“ä½œï¼š</p>
<ol>
<li>åå°„å¯ä»¥å°† interface ç±»å‹çš„å˜é‡ è½¬æ¢ä¸º åå°„å¯¹è±¡ï¼ˆreflect.Type reflect.Valueï¼‰</li>
<li>åå°„å¯ä»¥å°†åå°„å¯¹è±¡ è¿˜åŸä¸º interface å¯¹è±¡</li>
<li>åå°„å¯¹è±¡å¯ä»¥ä¿®æ”¹ï¼Œæå‰æ˜¯ value å€¼æ˜¯å˜é‡çš„æŒ‡é’ˆ</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#66d9ef">float</span>= <span style="color:#ae81ff">3.1</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">v</span><span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x</span>) <span style="color:#75715e">//éœ€è¦ä¼ å…¥xçš„æŒ‡é’ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Elem</span>().<span style="color:#a6e22e">SetFloat</span>(<span style="color:#ae81ff">3.4</span>);
</span></span></code></pre></div><p>ä½œç”¨ï¼š</p>
<ol>
<li>è¿è¡Œæ—¶åŠ¨æ€è°ƒç”¨æ–¹æ³•</li>
<li>è¿è¡Œæ—¶æ„é€ å‡½æ•°è¿›è¡Œ mock æ’æ¡©</li>
</ol>
<h1 id="å†…å­˜ç®¡ç†">å†…å­˜ç®¡ç† <a href="#%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86" class="anchor">ğŸ”—</a></h1><ol>
<li>åŸºæœ¬æƒ³æ³•ï¼šå±€éƒ¨ P ä¸Šï¼ˆper cpuï¼‰å’Œå…¨å±€é˜Ÿåˆ—æƒ³ç»“åˆçš„å‡è¡¡æ€æƒ³ã€‚å±€éƒ¨åˆ†é…æ— éœ€åŠ é”ï¼Œå±€éƒ¨åˆ†é…æ— æ³•æ»¡è¶³æ—¶åŠ é”å…¨å±€åˆ†é…</li>
</ol>
<ul>
<li>src/runtime/mheap.go:mspan</li>
<li>å†…å­˜å›æ”¶åŸç†
<ul>
<li>ä¸‰è‰²æ ‡è®°æ³• ï¼ˆæœªä½¿ç”¨ï¼Œå·²ä½¿ç”¨ï¼Œå¸¦å¤„ç†ï¼‰</li>
<li>root å¯¹è±¡å¼€å§‹ï¼ŒBFS éå†æ ‡è®°ï¼Œ</li>
</ul>
</li>
<li>é€ƒé€¸åˆ†æï¼ˆå¯¹è±¡æ˜¯å¦è¢«å‡½æ•°å¤–é¢å¼•ç”¨ ä¾‹å¦‚é—­åŒ…ï¼› å¯¹è±¡è¿‡å¤§ä¹Ÿå¯èƒ½åœ¨å †ä¸­ï¼‰
<ul>
<li>é€ƒé€¸åˆ†æçš„ç›®çš„æ˜¯å†³å®šå˜é‡çš„å†…å­˜åˆ†é…åœ°å€æ˜¯åœ¨æ ˆè¿˜æ˜¯å †</li>
<li>é€ƒé€¸åˆ†æåœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆçš„</li>
<li>ä¼ é€’æŒ‡é’ˆçœŸçš„æ¯”ä¼ å€¼é«˜æ•ˆå—ï¼Ÿä¸ä¸€å®š ç”±äºæŒ‡é’ˆä¼ é€’ä¼šäº§ç”Ÿé€ƒé€¸ï¼Œå¯èƒ½ä¼šä½¿ç”¨å †ï¼Œå¢åŠ  GC è´Ÿæ‹…ã€‚</li>
<li>go build -gcflags=-m // escapes to heap</li>
</ul>
</li>
</ul>
<h1 id="golang-ä¸­çš„ç‰¹è‰²è¯­æ³•">golang ä¸­çš„ç‰¹è‰²è¯­æ³• <a href="#golang-%e4%b8%ad%e7%9a%84%e7%89%b9%e8%89%b2%e8%af%ad%e6%b3%95" class="anchor">ğŸ”—</a></h1><h2 id="defer-recover">defer, recover <a href="#defer-recover" class="anchor">ğŸ”—</a></h2><p>defer è°ƒç”¨çš„å‡½æ•°æ˜¯ä¸€ä¸ª<code>function literal</code>ï¼Œä¹Ÿå°±æ˜¯é—­åŒ…æˆ–è€…åŒ¿åå‡½æ•°<br>
å¤šä¸ª defer çš„æ‰§è¡Œé¡ºåºä¸ºåè¿›å…ˆå‡º stackã€‚<br>
defer å£°æ˜æ—¶ä¼šå…ˆè®¡ç®—ç¡®å®šå‚æ•°çš„å€¼<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">f</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// print 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">i</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>defer ä¿®æ”¹æœ‰åè¿”å›å€¼å‡½æ•°çš„è¿”å›å€¼<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// f return 6
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">f</span>() (<span style="color:#a6e22e">result</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">result</span> <span style="color:#f92672">*=</span> <span style="color:#ae81ff">3</span>;
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åªèƒ½ä¿®æ”¹æœ‰åè¿”å›å€¼(named result parameters)å‡½æ•°ï¼ŒåŒ¿åè¿”å›å€¼å‡½æ•°æ˜¯æ— æ³•ä¿®æ”¹çš„<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">// f return 10
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>func f() int {
</span></span><span style="display:flex;"><span>    i :<span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span>    defer func() {
</span></span><span style="display:flex;"><span>        i<span style="color:#f92672">++</span>
</span></span><span style="display:flex;"><span>    }()
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//åŒ¿åè¿”å›å€¼å‡½æ•°æ˜¯åœ¨returnæ‰§è¡Œæ—¶è¢«å£°æ˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> i
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>recover</code>åªèƒ½åœ¨ defer ä¸­æ‰èƒ½ç”Ÿæ•ˆã€‚</p>
<h2 id="nil">nil <a href="#nil" class="anchor">ğŸ”—</a></h2><ul>
<li>what is nil
<ul>
<li>nil is a kind of zero</li>
</ul>
</li>
<li>what is nil in go
<ul>
<li>å„ç§ç±»å‹çš„é›¶å€¼</li>
<li>åŸºæœ¬ç±»å‹çš„é›¶å€¼ä¸ä¸º nil
<ul>
<li>bool ä¸º false</li>
<li>number ä¸º 0</li>
<li>string ä¸º&quot;&quot;</li>
</ul>
</li>
<li>éåŸºæœ¬ç±»å‹çš„é›¶å€¼ä¸º nil
<ul>
<li>pointer, slice, map, channel, function, interface{} ==&gt; nil</li>
<li>interface{}ç±»å‹ éœ€è¦ type å’Œ value å‡ä¸º nil æ—¶ï¼Œæ‰ä¼šä¸º nil</li>
<li>structure{}ï¼Œå› ä¸ºæœ‰ç»“æ„ type å­˜åœ¨ï¼Œtype ä¸ä¸º nilï¼Œæ‰€ä»¥ç»“æ„ä½“å˜é‡ä¸ä¼šæ˜¯ nil</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="å‡½æ•°è°ƒç”¨çš„ç±»å‹">å‡½æ•°è°ƒç”¨çš„ç±»å‹ <a href="#%e5%87%bd%e6%95%b0%e8%b0%83%e7%94%a8%e7%9a%84%e7%b1%bb%e5%9e%8b" class="anchor">ğŸ”—</a></h2><ul>
<li>é¡¶å±‚å‡½æ•° func f()</li>
<li>å‡½æ•° with å€¼è°ƒç”¨è€…</li>
<li>å‡½æ•° with æŒ‡é’ˆè°ƒç”¨è€…</li>
<li>func literal åŒ¿åå‡½æ•° or é—­åŒ…ï¼ˆA function literal represents an anonymous functionï¼‰</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Aer</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">a</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">b</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">AStruct</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">a_</span> <span style="color:#66d9ef">int32</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">b_</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">a</span> <span style="color:#a6e22e">AStruct</span>) <span style="color:#a6e22e">a</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;call a(), a=%d\n&#34;</span>, <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">a_</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">a</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">AStruct</span>) <span style="color:#a6e22e">b</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;call b(), b=%s\n&#34;</span>, <span style="color:#a6e22e">a</span>.<span style="color:#a6e22e">b_</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">aStruct</span> = <span style="color:#a6e22e">AStruct</span>{<span style="color:#a6e22e">a_</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">b_</span>: <span style="color:#e6db74">&#34;c&#34;</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">aStruct</span>.<span style="color:#a6e22e">a</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">aStruct</span>.<span style="color:#a6e22e">b</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">aStructPtr</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">AStruct</span>{<span style="color:#a6e22e">a_</span>: <span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">b_</span>: <span style="color:#e6db74">&#34;cc&#34;</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">aStructPtr</span>.<span style="color:#a6e22e">a</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">aStructPtr</span>.<span style="color:#a6e22e">b</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">aInterfz</span> <span style="color:#a6e22e">Aer</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">AStruct</span>{<span style="color:#a6e22e">a_</span>: <span style="color:#ae81ff">3</span>, <span style="color:#a6e22e">b_</span>: <span style="color:#e6db74">&#34;ccc&#34;</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">aInterfz</span>.<span style="color:#a6e22e">a</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">aInterfz</span>.<span style="color:#a6e22e">b</span>()
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// AStruct does not implement Aer (method b has pointer receiver)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">// var aInterfz Aer = AStruct{}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="goroutine"><code>goroutine</code> <a href="#goroutine" class="anchor">ğŸ”—</a></h2><p><code>GMP</code> è¿è¡Œæ—¶ã€‚ Gï¼šä»£è¡¨ä¸€ä¸ª Goroutineï¼Œæ¯ä¸ª Goroutine éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆã€‚Mï¼šè¡¨ç¤ºå†…æ ¸çº¿ç¨‹ã€‚<br>
Pï¼šä»£è¡¨ä¸€ä¸ªè™šæ‹Ÿçš„ Processor å¤„ç†å™¨ï¼Œå®ƒç»´æŠ¤ä¸€ä¸ª local Goroutine Queueï¼Œå·¥ä½œçº¿ç¨‹ä¼˜å…ˆä½¿ç”¨è‡ªå·±çš„å±€éƒ¨è¿è¡Œé˜Ÿåˆ—ï¼Œåªæœ‰å¿…è¦æ—¶æ‰ä¼šå»è®¿é—® Global Queueã€‚<br></p>
<h2 id="interfaceä¸interface"><code>interface</code>ä¸<code>interface{}</code> <a href="#interface%e4%b8%8einterface" class="anchor">ğŸ”—</a></h2><p><code>æ¥å£çš„ç±»å‹è½¬æ¢</code>ã€<code>ç±»å‹æ–­è¨€</code>ä»¥åŠ<code>åŠ¨æ€æ´¾å‘æœºåˆ¶</code></p>
<p>æ¥å£æ˜¯ä¸€ç»„æ–¹æ³•ç­¾åã€‚<br>
å½“ä¸€ä¸ªç±»å‹ï¼ˆç»“æ„ä½“ï¼‰ä¸ºæ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•æä¾›å®šä¹‰æ—¶,è¢«ç§°ä¸ºå®ç°äº†è¯¥æ¥å£ï¼Œ ä¹Ÿç§°ä¸º<code>duck typing</code>ã€‚<br></p>
<p>ç©ºæ¥å£<code>interface{}</code>, ï¼ˆç±»å‹+æ•°æ®ï¼‰ã€‚æ‰€æœ‰ç±»å‹éƒ½å®ç°äº†ç©ºæ¥å£ï¼Œ ç©ºæ¥å£å¯ä»¥ç”¨æ¥åšæ³›å‹ã€‚<br></p>
<p>ä¸€ä¸ªæ¥å£å€¼ç”±ä¸¤ä¸ªæŒ‡é’ˆï¼š ä¸€ä¸ªæŒ‡å‘è¯¥å€¼åº•å±‚ç±»å‹çš„æ–¹æ³•è¡¨ï¼Œå¦ä¸€ä¸ªæŒ‡å‘å®é™…æ•°æ®ã€‚<br>
<p class="markdown-image">
  <img src="/golang/golang_interface.png" alt="image"  />
</p></p>
<h1 id="go-è®¾è®¡æ¨¡å¼">go è®¾è®¡æ¨¡å¼ <a href="#go-%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f" class="anchor">ğŸ”—</a></h1><p>search keyword <code>go patterns</code> <br>
åˆ›å»ºå‹ï¼Œ ç»“æ„å‹ï¼Œ è¡Œä¸ºå‹<br></p>
<h2 id="åˆ›å»ºå‹">åˆ›å»ºå‹ <a href="#%e5%88%9b%e5%bb%ba%e5%9e%8b" class="anchor">ğŸ”—</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Builder</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">SetA</span>() <span style="color:#a6e22e">Builder</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">SetB</span>() <span style="color:#a6e22e">Builder</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Build</span>() <span style="color:#a6e22e">AInterfz</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">AInterfz</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">A</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">B</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">assembly</span>.<span style="color:#a6e22e">SetA</span>().<span style="color:#a6e22e">SetB</span>().<span style="color:#a6e22e">Build</span>().<span style="color:#a6e22e">A</span>()
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">singleton</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">var</span> (
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">once</span> <span style="color:#a6e22e">sync</span>.<span style="color:#a6e22e">Once</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">instance</span> <span style="color:#a6e22e">singleton</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> new() <span style="color:#a6e22e">singleton</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">once</span>.<span style="color:#a6e22e">Do</span>(<span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">instance</span> = make(<span style="color:#a6e22e">singleton</span>)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">instance</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="è£…é¥°å™¨æ¨¡å¼-decorator-pattern">è£…é¥°å™¨æ¨¡å¼ decorator pattern <a href="#%e8%a3%85%e9%a5%b0%e5%99%a8%e6%a8%a1%e5%bc%8f-decorator-pattern" class="anchor">ğŸ”—</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Object</span> <span style="color:#66d9ef">func</span>(<span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">log_decorator</span>(<span style="color:#a6e22e">fn</span> <span style="color:#a6e22e">Object</span>) <span style="color:#a6e22e">Object</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">n</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;before&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fn</span>(<span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;after&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">result</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">double</span>(<span style="color:#a6e22e">n</span> <span style="color:#66d9ef">int</span>) <span style="color:#66d9ef">int</span> { <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">n</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>}
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">log_decorator</span>(<span style="color:#a6e22e">double</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">f</span>(<span style="color:#ae81ff">3</span>)
</span></span></code></pre></div><h2 id="ä»£ç†æ¨¡å¼-proxy-pattern">ä»£ç†æ¨¡å¼ proxy pattern <a href="#%e4%bb%a3%e7%90%86%e6%a8%a1%e5%bc%8f-proxy-pattern" class="anchor">ğŸ”—</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">IObject</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">objDo</span>(<span style="color:#a6e22e">action</span> <span style="color:#66d9ef">string</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Object</span> <span style="color:#66d9ef">struct</span> { <span style="color:#a6e22e">action</span> <span style="color:#66d9ef">string</span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">obj</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Object</span>) <span style="color:#a6e22e">objDo</span>(<span style="color:#a6e22e">action</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;%s.&#34;</span>, <span style="color:#a6e22e">action</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ProxyObject</span> <span style="color:#66d9ef">struct</span> {<span style="color:#a6e22e">object</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Object</span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ProxyObject</span>) <span style="color:#a6e22e">objDo</span>(<span style="color:#a6e22e">action</span> <span style="color:#66d9ef">string</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">object</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">object</span> = new(<span style="color:#a6e22e">Object</span>)}
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">action</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;sing&#34;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">object</span>.<span style="color:#a6e22e">objDo</span>(<span style="color:#a6e22e">action</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="è§‚å¯Ÿè€…æ¨¡å¼-observer-pattern">è§‚å¯Ÿè€…æ¨¡å¼ observer pattern <a href="#%e8%a7%82%e5%af%9f%e8%80%85%e6%a8%a1%e5%bc%8f-observer-pattern" class="anchor">ğŸ”—</a></h2><h2 id="ç­–ç•¥æ¨¡å¼-strategy-pattern">ç­–ç•¥æ¨¡å¼ strategy pattern <a href="#%e7%ad%96%e7%95%a5%e6%a8%a1%e5%bc%8f-strategy-pattern" class="anchor">ğŸ”—</a></h2><h2 id="è´£ä»»é“¾">è´£ä»»é“¾ <a href="#%e8%b4%a3%e4%bb%bb%e9%93%be" class="anchor">ğŸ”—</a></h2><p>é€šè¿‡é—­åŒ…å®ç°çš„ http ä¸­é—´ä»¶ï¼Œåœ¨åŸæœ‰å‡½æ•°çš„åŸºç¡€ä¸ŠåŒ…è£¹ä¸­é—´åŠŸèƒ½ï¼Œè€Œä¸ç ´ååŸæœ‰å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/hello&#34;</span>, <span style="color:#a6e22e">timewrapper</span>(<span style="color:#a6e22e">hello</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;:8888&#34;</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">timewrapper</span>(<span style="color:#a6e22e">f</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>)) <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">start</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">f</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">end</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;take time: &#34;</span>, <span style="color:#a6e22e">end</span>.<span style="color:#a6e22e">Sub</span>(<span style="color:#a6e22e">start</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="reference">reference <a href="#reference" class="anchor">ğŸ”—</a></h1><p>[1]<a href="https://eli.thegreenplace.net/2020/embedding-in-go-part-1-structs-in-structs/" target="_blank" rel="noopener"> Embedding structs in structs</a><br>
[2]<a href="https://gobyexample.com/struct-embedding" target="_blank" rel="noopener"> Go by Example: Struct Embedding</a><br>
[3]<a href="https://golangbyexample.com/embedding-interfaces-go/" target="_blank" rel="noopener"> Embedding Interfaces in Go (Golang)</a><br>
[4]<a href="https://eli.thegreenplace.net/2020/embedding-in-go-part-1-structs-in-structs/" target="_blank" rel="noopener"> Embedding in Go: Part 1 - structs in structs</a><br>
[5]<a href="https://eli.thegreenplace.net/2020/embedding-in-go-part-3-interfaces-in-structs/" target="_blank" rel="noopener"> Embedding in Go: Part 3 - interfaces in structs</a><br>
[6]<a href="https://golang.design/go-questions/slice/vs-array/" target="_blank" rel="noopener">Go ç¨‹åºå‘˜é¢è¯•ç¬”è¯•å®å…¸</a><br></p>

    </div>

    
        <div class="tags">
            
                <a href="http://brettkk.github.io/tags/golang-%E7%89%B9%E8%89%B2">golang ç‰¹è‰²</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <script src="https://utteranc.es/client.js"
repo="brettKK/brettkk.github.io"
issue-term="title"
theme="github-light"
crossorigin="anonymous"
async>
</script>  

    <div class="copyright">
    
       Â© Copyright 
       2025 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://github.com/nodejh/hugo-theme-cactus-plus'>nodejh</a>
      </div>
    
</footer>




  </body>
</html>
