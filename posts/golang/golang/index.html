<!DOCTYPE html>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css">
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<html lang="zh-cn">
  <head>
    <title>golang | brettkk</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="èµ„æ–™ ğŸ”— ç›®å‰golangçš„ä¸»è¦maintainerä¹‹ä¸€: Russ Cox ä¸ª">
<meta name="generator" content="Hugo 0.103.1" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link href="https://cdn.bootcss.com/highlight.js/9.15.10/styles/zenburn.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<link rel="stylesheet" href="http://brettkk.github.io/css/syntax.css" />


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />




  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>




  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">golang</h1>

    <div class="tip">
        <time datetime="2022-05-07 18:54:41 &#43;0800 CST">May 7, 2022</time>
        <span class="split">
          Â·
        </span>
        <span>
          8282 words
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          17 minute read
        </span>
    </div>

    
    
        
  
    <aside class="toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#èµ„æ–™">èµ„æ–™</a></li>
        <li><a href="#å®˜æ–¹åœ°å€æ”¹åŠ¨">å®˜æ–¹åœ°å€æ”¹åŠ¨</a></li>
        <li><a href="#æ„å»ºgolangå¼€å‘ç¯å¢ƒ">æ„å»ºgolangå¼€å‘ç¯å¢ƒ</a></li>
        <li><a href="#ç¼–è¯‘æºç é¡¹ç›®">ç¼–è¯‘æºç é¡¹ç›®</a></li>
        <li><a href="#å˜é‡çš„å†…å­˜å¤§å°">å˜é‡çš„å†…å­˜å¤§å°</a></li>
        <li><a href="#å¤šæ€ç»§æ‰¿-èŒƒå‹">å¤šæ€ï¼Œç»§æ‰¿ï¼Œ èŒƒå‹</a>
          <ul>
            <li><a href="#ç»§æ‰¿">ç»§æ‰¿</a></li>
            <li><a href="#å¤šæ€">å¤šæ€</a></li>
            <li><a href="#èŒƒå‹">èŒƒå‹</a></li>
            <li><a href="#æ¥å£çš„ä½¿ç”¨å®è·µ">æ¥å£çš„ä½¿ç”¨å®è·µ</a></li>
          </ul>
        </li>
        <li><a href="#æ¨¡ç³Šç‚¹">æ¨¡ç³Šç‚¹</a>
          <ul>
            <li><a href="#runeç±»å‹">runeç±»å‹</a></li>
            <li><a href="#æ•°ç»„ä¸åˆ‡ç‰‡">æ•°ç»„ä¸åˆ‡ç‰‡</a></li>
            <li><a href="#å‡½æ•°çš„æ¥å—è€…">å‡½æ•°çš„æ¥å—è€…</a></li>
            <li><a href="#golangå€¼æ‹·è´">golangå€¼æ‹·è´</a></li>
            <li><a href="#é—­åŒ…">é—­åŒ…</a></li>
            <li><a href="#unsafeåŒ…">unsafeåŒ…</a></li>
            <li><a href="#nil">nil</a></li>
            <li><a href="#åå°„">åå°„</a></li>
            <li><a href="#å†…å­˜ç®¡ç†">å†…å­˜ç®¡ç†</a></li>
          </ul>
        </li>
        <li><a href="#å®é™…ç¼–è¯‘å™¨">å®é™…ç¼–è¯‘å™¨</a></li>
        <li><a href="#è¯æ³•åˆ†æ-å’Œ-è¯­æ³•åˆ†æ">è¯æ³•åˆ†æ å’Œ è¯­æ³•åˆ†æ</a></li>
        <li><a href="#go-æŠ½è±¡è¯­æ³•æ ‘ast">go æŠ½è±¡è¯­æ³•æ ‘AST</a>
          <ul>
            <li><a href="#goçš„è¯æ³•åˆ†æ-filesetç»“æ„">Goçš„è¯æ³•åˆ†æï¼Œ FileSetç»“æ„</a></li>
            <li><a href="#åŸºç¡€å­—é¢å€¼çš„è¯­æ³•æ ‘ç»“æ„">åŸºç¡€å­—é¢å€¼çš„è¯­æ³•æ ‘ç»“æ„</a></li>
            <li><a href="#åŸºç¡€è¡¨è¾¾å¼çš„é€’å½’ç»“æ„">åŸºç¡€è¡¨è¾¾å¼çš„é€’å½’ç»“æ„</a></li>
            <li><a href="#goé¡¹ç›®çš„ä»£ç ç»“æ„">goé¡¹ç›®çš„ä»£ç ç»“æ„</a>
              <ul>
                <li><a href="#é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</a></li>
                <li><a href="#æ–‡ä»¶è¯­æ³•ç»“æ„">æ–‡ä»¶è¯­æ³•ç»“æ„</a></li>
              </ul>
            </li>
            <li><a href="#goä¸­çš„import-type-const--var-çš„å£°æ˜ç»“æ„">goä¸­çš„import, type, const , var çš„å£°æ˜ç»“æ„</a></li>
            <li><a href="#goå‡½æ•°çš„è¯­æ³•æ ‘ç»“æ„">goå‡½æ•°çš„è¯­æ³•æ ‘ç»“æ„</a></li>
            <li><a href="#æ•°æ®å’Œç»“æ„ä½“ç­‰å¤åˆç±»å‹">æ•°æ®å’Œç»“æ„ä½“ç­‰å¤åˆç±»å‹</a></li>
            <li><a href="#å¤æ‚çš„å­—é¢å€¼">å¤æ‚çš„å­—é¢å€¼</a></li>
            <li><a href="#å¤åˆè¡¨è¾¾å¼">å¤åˆè¡¨è¾¾å¼</a></li>
            <li><a href="#å¯¹astè¿›è¡Œç±»å‹æ£€æŸ¥">å¯¹ASTè¿›è¡Œç±»å‹æ£€æŸ¥</a></li>
            <li><a href="#å¯¹astçš„è¯­ä¹‰ä¿¡æ¯">å¯¹ASTçš„è¯­ä¹‰ä¿¡æ¯</a></li>
            <li><a href="#astè½¬æ¢æˆssa">ASTè½¬æ¢æˆSSA</a>
              <ul>
                <li><a href="#åˆå§‹åŒ–ssaé…ç½®initssaconfig">åˆå§‹åŒ–SSAé…ç½®initssaconfig</a></li>
                <li><a href="#éå†å’Œæ›¿æ¢">éå†å’Œæ›¿æ¢</a></li>
                <li><a href="#ssaçš„ç”Ÿæˆ">SSAçš„ç”Ÿæˆ</a></li>
              </ul>
            </li>
            <li><a href="#æœºå™¨ä»£ç çš„ç”Ÿæˆ">æœºå™¨ä»£ç çš„ç”Ÿæˆ</a></li>
            <li><a href="#llvmçš„åŸºç¡€çŸ¥è¯†">LLVMçš„åŸºç¡€çŸ¥è¯†</a></li>
          </ul>
        </li>
        <li><a href="#go-æ±‡ç¼–">go æ±‡ç¼–</a>
          <ul>
            <li><a href="#go-è®¾è®¡æ¨¡å¼">go è®¾è®¡æ¨¡å¼</a>
              <ul>
                <li><a href="#è´£ä»»é“¾">è´£ä»»é“¾</a></li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
          </div>
      </details>
    </aside>
  


    


    <div class="content">
      <h2 id="èµ„æ–™">èµ„æ–™ <a href="#%e8%b5%84%e6%96%99" class="anchor">ğŸ”—</a></h2><ol>
<li>
<p>ç›®å‰golangçš„ä¸»è¦maintainerä¹‹ä¸€: Russ Cox</p>
</li>
<li>
<p>ä¸ªäººä¸»é¡µï¼šswtch.com/~rsc/</p>
</li>
<li>
<p>awesome-goç³»åˆ—ï¼Œhttps://github.com/gocn/knowledge</p>
</li>
</ol>
<p>ç»ƒä¹ æ“åœºplayground: go.dev/playã€‚  åæœ‰rust playgroundã€‚</p>
<h2 id="å®˜æ–¹åœ°å€æ”¹åŠ¨">å®˜æ–¹åœ°å€æ”¹åŠ¨ <a href="#%e5%ae%98%e6%96%b9%e5%9c%b0%e5%9d%80%e6%94%b9%e5%8a%a8" class="anchor">ğŸ”—</a></h2><p>golang.org =&gt; go.dev
play.golang.org =&gt; go.dev/play</p>
<h2 id="æ„å»ºgolangå¼€å‘ç¯å¢ƒ">æ„å»ºgolangå¼€å‘ç¯å¢ƒ <a href="#%e6%9e%84%e5%bb%bagolang%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83" class="anchor">ğŸ”—</a></h2><p>ä¸‹è½½å®‰è£…åŒ… wget <a href="https://golang.google.cn/dl/go1.19.2.src.tar.gz" target="_blank" rel="noopener">https://golang.google.cn/dl/go1.19.2.src.tar.gz</a> <br>
googleåŸŸåä¸‹çš„åœ°å€å¯èƒ½è¢«å¢™ä¸èƒ½è®¿é—®ã€‚ <br>
æˆ–è€… <a href="https://go.dev/dl/" target="_blank" rel="noopener">https://go.dev/dl/</a> åœ°å€ã€‚ <br></p>
<p>è§£å‹å¹¶å®‰è£…åˆ°æŒ‡å®šç›®å½• tar -zxvf xx.tar.gz -C /usr/local</p>
<p>é…ç½®ç¯å¢ƒå˜é‡
vim .bash_profile
export GOROOT=~/..
export PATH=$PATH:$GOROOT/bin
export GOPATH=~/..
source .bash_profile</p>
<p>éªŒè¯ä¸€ä¸‹ go versionã€‚go envã€‚</p>
<h2 id="ç¼–è¯‘æºç é¡¹ç›®">ç¼–è¯‘æºç é¡¹ç›® <a href="#%e7%bc%96%e8%af%91%e6%ba%90%e7%a0%81%e9%a1%b9%e7%9b%ae" class="anchor">ğŸ”—</a></h2><p>ä»æºç å»ç¼–è¯‘golangé¡¹ç›®ã€‚<br></p>
<ul>
<li>git clone <a href="https://github.com/golang/go.git" target="_blank" rel="noopener">https://github.com/golang/go.git</a></li>
<li>è®¾ç½®golangè‡ªä¸¾ç¼–è¯‘å™¨çš„åœ°å€ã€‚ export GOROOT_BOOTSTRAP=$GOROOT(æˆ–è€…å…¶ä»–)</li>
<li>è¿›å»æºç ç›®å½•ä¸­çš„all.bashè„šæœ¬ã€‚ ./go/src/all.bashã€‚ æˆ–è€…./go/src/make.bashè„šæœ¬ä¼šåˆ©ç”¨è‡ªå±…ç¼–è¯‘å™¨GOROOT_BOOTSTRAPå»ç¼–è¯‘golangæºç é¡¹ç›®ã€‚</li>
<li>æœ€åçš„ç¼–è¯‘äº§ç”Ÿäº†ï½/go/src/github.com/golang/goï¼Œ ~/go/src/github.com/golang/go/bin, pkgåº“æ–‡ä»¶ç­‰ã€‚</li>
<li>éªŒè¯æ”¹åŠ¨åçš„æ‰§è¡Œå‘½ä»¤ åˆ©ç”¨æ–°ç¼–è¯‘å™¨çš„ç»å¯¹è·¯å¾„ã€‚ ~/go/src/github.com/golang/go run test_print.goã€‚</li>
</ul>
<p>go build -n main.go ä¸ç¼–è¯‘å¹¶æ‰“å°ç¼–è¯‘çš„è¿‡ç¨‹ã€‚ -n å‚æ•°å’Œmakeçš„-nå‚æ•°æ˜¯ä¸€è‡´çš„ã€‚</p>
<hr>
<h2 id="å˜é‡çš„å†…å­˜å¤§å°">å˜é‡çš„å†…å­˜å¤§å° <a href="#%e5%8f%98%e9%87%8f%e7%9a%84%e5%86%85%e5%ad%98%e5%a4%a7%e5%b0%8f" class="anchor">ğŸ”—</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;runtime&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;unsafe&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;arch=%s, os=%s\n&#34;</span>, <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GOARCH</span>, <span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GOOS</span>) <span style="color:#75715e">//arch=amd64, os=linux
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#66d9ef">int</span> = <span style="color:#ae81ff">190</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type=%T, size=%d\n&#34;</span>, <span style="color:#a6e22e">a</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">a</span>)) <span style="color:#75715e">//type=int, size=8
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#66d9ef">int32</span> = <span style="color:#ae81ff">190</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;type=%T, size=%d\n&#34;</span>, <span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Sizeof</span>(<span style="color:#a6e22e">b</span>)) <span style="color:#75715e">//type=int32, size=4
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><hr>
<h2 id="å¤šæ€ç»§æ‰¿-èŒƒå‹">å¤šæ€ï¼Œç»§æ‰¿ï¼Œ èŒƒå‹ <a href="#%e5%a4%9a%e6%80%81%e7%bb%a7%e6%89%bf-%e8%8c%83%e5%9e%8b" class="anchor">ğŸ”—</a></h2><p>golangä¸­é¢å‘å¯¹è±¡çš„å®ç°æ–¹å¼</p>
<h3 id="ç»§æ‰¿">ç»§æ‰¿ <a href="#%e7%bb%a7%e6%89%bf" class="anchor">ğŸ”—</a></h3><p>ç»„åˆç»“æ„ä½“ï¼Œä¸€ä¸ªç»“æ„ä½“åµŒå…¥å¦ä¸€ä¸ªç»“æ„ä½“ï¼Œèƒ½å¤Ÿå®ç°å¯¹åµŒå…¥ç»“æ„ä½“çš„å­—æ®µä»¥åŠå…¶å®ç°çš„æ–¹æ³•çš„ç»§æ‰¿ã€‚</p>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="background-color:#3c3d38"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span></span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="background-color:#3c3d38"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span></span><span style="background-color:#3c3d38"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span></span><span style="background-color:#3c3d38"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;display:grid;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">person</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">age</span>  <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">student</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">person</span> <span style="color:#75715e">//   åŒ¿åå­—æ®µï¼Œé€šè¿‡ç»„åˆçš„æ–¹å¼
</span></span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">school</span> <span style="color:#66d9ef">string</span> 
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">person</span>) <span style="color:#a6e22e">talk</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">name</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">age</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex; background-color:#3c3d38"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">student</span>) <span style="color:#a6e22e">getSchool</span>() {
</span></span><span style="display:flex; background-color:#3c3d38"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">school</span>
</span></span><span style="display:flex; background-color:#3c3d38"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">s</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">student</span>{<span style="color:#a6e22e">person</span>{<span style="color:#e6db74">&#34;brettkk&#34;</span>, <span style="color:#ae81ff">18</span>}, <span style="color:#e6db74">&#34;yidu&#34;</span>}
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">name</span>) <span style="color:#75715e">// ç»§æ‰¿personçš„nameå­—æ®µ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">talk</span>() <span style="color:#75715e">// ç»§æ‰¿personå®ç°çš„æ–¹æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}</span></span></code></pre></td></tr></table>
</div>
</div>
<h3 id="å¤šæ€">å¤šæ€ <a href="#%e5%a4%9a%e6%80%81" class="anchor">ğŸ”—</a></h3><p>goæ²¡æœ‰ implements, extends å…³é”®å­—ï¼Œ golangæ˜¯å»é¸­å­ç±»å‹ï¼šçœ‹èµ·æ¥åƒé¸­å­ï¼Œ é‚£ä¹ˆå®ƒå°±æ˜¯é¸­å­ã€‚</p>
<p>å¤šæ€ï¼š çˆ¶ç±»æŒ‡é’ˆæˆ–å¼•ç”¨å»è°ƒç”¨æ–¹æ³•ï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œèƒ½å¤Ÿæ ¹æ®å­ç±»çš„ç±»å‹å»æ‰§è¡Œå­ç±»å½“ä¸­çš„æ–¹æ³•ã€‚</p>
<p>ä¸ºä»€ä¹ˆæ˜¯åœ¨æ‰§è¡Œçš„æ—¶å€™æ‰èƒ½æ ¹æ®å­ç±»çš„ç±»å‹æ‰§è¡Œå­ç±»çš„æ–¹æ³•ï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Person</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">gender</span>() <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Men</span> <span style="color:#66d9ef">struct</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Gender</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Woman</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Gender</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Age</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span> <span style="color:#a6e22e">strings</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">m</span> <span style="color:#a6e22e">Men</span>) <span style="color:#a6e22e">gender</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Gender</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">Woman</span>) <span style="color:#a6e22e">gender</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">w</span>.<span style="color:#a6e22e">Gender</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">JudgeFunc</span>() <span style="color:#66d9ef">bool</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// may has many code
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// can&#39;t not get boolean result until running this JudgeFunc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// so compiler can&#39;t not known clearly about the type info of a
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">a</span> = <span style="color:#a6e22e">JudgeFunc</span>() <span style="color:#960050;background-color:#1e0010">?</span> <span style="color:#a6e22e">Men</span>{} : <span style="color:#a6e22e">Woman</span>{}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">b</span> <span style="color:#a6e22e">Person</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// compiler can judge the type info of a 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">b</span> = <span style="color:#a6e22e">Men</span>{} <span style="color:#75715e">// or b = Woman{}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="èŒƒå‹">èŒƒå‹ <a href="#%e8%8c%83%e5%9e%8b" class="anchor">ğŸ”—</a></h3><p>ç©ºinterface{} ç±»å‹ï¼Œæ²¡æœ‰æ–¹æ³•é›†çš„æ¥å£ï¼Œåªéœ€è¦å­˜ç±»å‹å’Œç±»å‹å¯¹åº”çš„å€¼å³å¯ã€‚</p>
<p>ç©ºinterface{} = (type, value) ==&gt; (nil, nil) == nil</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">// ä¸å«æ–¹æ³•çš„ç©ºæ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">eface</span> <span style="color:#66d9ef">struct</span> {       <span style="color:#75715e">// 16 byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">_type</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">_type</span>          <span style="color:#75715e">// æŒ‡å‘ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">data</span>  <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>  <span style="color:#75715e">// æŒ‡å‘æ•°æ®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å«æœ‰æ–¹æ³•çš„æ¥å£
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">iface</span> <span style="color:#66d9ef">struct</span> {       <span style="color:#75715e">// 16 byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">tab</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">itab</span>             <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">data</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>   <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">_type</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">size</span> <span style="color:#66d9ef">uintptr</span> <span style="color:#75715e">// ç±»å‹å ç”¨çš„å†…å­˜å¤§å°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">ptrdata</span> <span style="color:#66d9ef">uintptr</span> <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">hash</span> <span style="color:#66d9ef">int32</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">align</span> <span style="color:#66d9ef">uint8</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">itab</span> <span style="color:#66d9ef">struct</span> {        <span style="color:#75715e">// 32 byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">inter</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">interfacetype</span>  <span style="color:#75715e">// ç±»å‹ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">_type</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">_type</span>          <span style="color:#75715e">// ç±»å‹ä¿¡æ¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">hash</span> <span style="color:#66d9ef">uint32</span>           <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">_</span> [<span style="color:#ae81ff">4</span>]<span style="color:#66d9ef">byte</span>             <span style="color:#75715e">// padding align size = 8 byte
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fun</span> [<span style="color:#ae81ff">1</span>]<span style="color:#66d9ef">uintptr</span>        <span style="color:#75715e">// ç”¨æˆ·è¿è¡Œæ—¶åŠ¨æ€æ´¾å‘çš„è™šå‡½æ•°è¡¨ï¼Œå­˜å‚¨å‡½æ•°æŒ‡é’ˆã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="æ¥å£çš„ä½¿ç”¨å®è·µ">æ¥å£çš„ä½¿ç”¨å®è·µ <a href="#%e6%8e%a5%e5%8f%a3%e7%9a%84%e4%bd%bf%e7%94%a8%e5%ae%9e%e8%b7%b5" class="anchor">ğŸ”—</a></h3><p>golangæºç é‡Œçš„è¾ƒå¥½å®ç°æ–¹å¼æ˜¯ï¼š ä½¿ç”¨å°çš„æ¥å£ï¼Œå°¤å…¶æ˜¯åªåŒ…å«ä¸€ä¸ªæ–¹æ³•çš„æ¥å£ï¼›é€šè¿‡å°æ¥å£çš„ç»„åˆæ¥å®šä¹‰å¤§æ¥å£ã€‚</p>
<p>å¥½å¤„æ˜¯ï¼šä½¿ç”¨è€…å¯ä»¥åªä¾èµ–äºå¿…è¦åŠŸèƒ½çš„æœ€å°æ¥å£ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Reader</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Read</span>(<span style="color:#a6e22e">p</span> []<span style="color:#66d9ef">byte</span>) (<span style="color:#a6e22e">n</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Writer</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Write</span>(<span style="color:#a6e22e">p</span> []<span style="color:#66d9ef">byte</span>) (<span style="color:#a6e22e">n</span> <span style="color:#66d9ef">int</span>, <span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ReadWriter</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Reader</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Writer</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">store</span>(<span style="color:#a6e22e">reader</span> <span style="color:#a6e22e">Reader</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å…¥å‚å¯ä»¥åªä¾èµ–äºå¿…è¦åŠŸèƒ½çš„æœ€å°æ¥å£ï¼Œ è®©å‡½æ•°çš„è¿”å›æ›´å¹¿
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">store</span>(<span style="color:#a6e22e">readWriter</span> <span style="color:#a6e22e">ReadWriter</span>) <span style="color:#66d9ef">error</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å…¥å‚ä¾èµ–äº†ä¸å¿…è¦åŠŸèƒ½çš„æ¥å£ï¼Œè®©é™åˆ¶äº†å‡½æ•°çš„ä½¿ç”¨èŒƒå›´ä¸ºæ›´å°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="æ¨¡ç³Šç‚¹">æ¨¡ç³Šç‚¹ <a href="#%e6%a8%a1%e7%b3%8a%e7%82%b9" class="anchor">ğŸ”—</a></h2><h3 id="runeç±»å‹">runeç±»å‹ <a href="#rune%e7%b1%bb%e5%9e%8b" class="anchor">ğŸ”—</a></h3><p>å­—ç¬¦ä¸²æœ‰å­—ç¬¦ç»„æˆï¼Œ å­—ç¬¦åˆ†2ç§ï¼Œ ä¸€ç§æ˜¯å 1byteçš„å­—ç¬¦ï¼Œå¦‚è‹±æ–‡å­—ç¬¦ï¼›ä¸€ç§æ˜¯å 1-4 byteçš„å­—ç¬¦ç”¨runeè¡¨ç¤ºï¼Œå¦‚ä¸­æ–‡ã€‚</p>
<p>åœ¨builtin/builtin.goä¸­å®šä¹‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">rune</span> = <span style="color:#66d9ef">int32</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(len(<span style="color:#e6db74">&#34;halloä¸­æ–‡&#34;</span>))<span style="color:#75715e">// 5 + 3 + 3
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(len([]rune(<span style="color:#e6db74">&#34;halloä¸­æ–‡&#34;</span>))) <span style="color:#75715e">//5 + 1 + 1
</span></span></span></code></pre></div><h3 id="æ•°ç»„ä¸åˆ‡ç‰‡">æ•°ç»„ä¸åˆ‡ç‰‡ <a href="#%e6%95%b0%e7%bb%84%e4%b8%8e%e5%88%87%e7%89%87" class="anchor">ğŸ”—</a></h3><p>æ•°ç»„çš„åˆå§‹åŒ– ï¼ˆå…ƒç´ ç±»å‹ï¼Œ æ•°ç»„å¤§å°ï¼‰</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// cmd/compile/internal/types.NewArray
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewArray</span>(<span style="color:#a6e22e">elem</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span>, <span style="color:#a6e22e">bound</span> <span style="color:#66d9ef">int64</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>2ç§åˆå§‹åŒ–æ–¹å¼ï¼Œæ˜¾å¼çš„æŒ‡å®šæ•°ç»„çš„å¤§å° <br/></p>
<ol>
<li>arr := [3]int{1, 2, 3}</li>
<li>[...]T å£°æ˜æ•°ç»„ // arr := [...]int{1, 2, 3}</li>
</ol>
<p>æ•°ç»„çš„è®¿é—®è¶Šç•Œæ£€æŸ¥ã€‚ ç¼–è¯‘æ—¶cmd/compile/internal/gc.typecheck1å‡½æ•°op=OINDEXæ—¶å¤„ç†ã€‚ssaé˜¶æ®µä¹Ÿä¼šæ’å…¥æ£€æŸ¥å‡½æ•°runtime.panicIndexã€‚</p>
<p>åˆ‡ç‰‡ï¼ŒåŠ¨æ€æ•°ç»„ã€‚</p>
<ul>
<li>å£°æ˜åˆ‡ç‰‡ []int, []interface{}</li>
<li>åˆå§‹åŒ–åˆ‡ç‰‡ []int{1,2,3}, slice := make([]int, 3)</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// cmd/compile/internal/types.NewSlice
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewSlice</span>(<span style="color:#a6e22e">elem</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">Type</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">SliceHeader</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Data</span> <span style="color:#66d9ef">uintptr</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Len</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Cap</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">StringHeader</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Data</span> <span style="color:#66d9ef">uintptr</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Len</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="å‡½æ•°çš„æ¥å—è€…">å‡½æ•°çš„æ¥å—è€… <a href="#%e5%87%bd%e6%95%b0%e7%9a%84%e6%8e%a5%e5%8f%97%e8%80%85" class="anchor">ğŸ”—</a></h3><p>å‡½æ•°æ¥å—è€…ä¸ºæŒ‡é’ˆç±»å‹:</p>
<ol>
<li>å‡½æ•°å¯ä»¥ä¿®æ”¹æ¥å—è€…çš„å†…å®¹</li>
<li>é¿å…æ–¹æ³•è°ƒç”¨æ—¶å˜é‡çš„æ‹·è´ï¼Œè€Œæ˜¯æŒ‡é’ˆçš„æ‹·è´</li>
</ol>
<br/>
<h3 id="golangå€¼æ‹·è´">golangå€¼æ‹·è´ <a href="#golang%e5%80%bc%e6%8b%b7%e8%b4%9d" class="anchor">ğŸ”—</a></h3><p>goä¸¥æ ¼ä¸Šåªæœ‰å¤åˆ¶æ‹·è´ä¼ é€’</p>
<p>æ€»æ˜¯åˆ›å»ºå‰¯æœ¬æŒ‰å€¼ä¼ é€’ï¼Œåªä¸è¿‡è¿™ä¸ªå‰¯æœ¬å¯ä»¥æ˜¯å˜é‡çš„å‰¯æœ¬ï¼Œä¹Ÿå¯ä»¥æ˜¯æŒ‡é’ˆçš„å‰¯æœ¬</p>
<br/>
<h3 id="é—­åŒ…">é—­åŒ… <a href="#%e9%97%ad%e5%8c%85" class="anchor">ğŸ”—</a></h3><p>é—­åŒ…=å‡½æ•°+å¼•ç”¨ç¯å¢ƒã€‚</p>
<p>é—­åŒ…é‡Œå¼•ç”¨å±€éƒ¨å˜é‡æ—¶ï¼Œåœ¨å †ä¸Šåˆ›å»ºè¯¥å˜é‡çš„ä¸€ä¸ªæ‹·è´ï¼Œå¹¶æŠŠè¯¥å˜é‡åœ°å€å’Œå‡½æ•°é—­åŒ…ç»„æˆä¸€ä¸ªç»“æ„ä½“ï¼Œå¹¶æŠŠè¯¥ç»“æ„ä½“ä¼ å‡ºæ¥ä½œä¸ºè¿”å›å€¼</p>
<br/>
<h3 id="unsafeåŒ…">unsafeåŒ… <a href="#unsafe%e5%8c%85" class="anchor">ğŸ”—</a></h3><p>*T &lt;==&gt; unsafe.Pointer &lt;==&gt; uintptr</p>
<p>uintpträ¸unsafe.Pointerï¼ˆç±»ä¼¼void*ï¼‰</p>
<ol>
<li>T1æŒ‡é’ˆä¸ T2æŒ‡é’ˆç±»å‹ä¹‹é—´çš„è½¬æ¢</li>
<li>ä¿®æ”¹å†…å­˜æ•°æ®ï¼Œ uintptr å¸¸ç”¨äºä¸ unsafe.Pointeré…åˆï¼Œç”¨äºåšæŒ‡é’ˆè¿ç®—</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#75715e">//ç»“æ„ä½“çš„æˆå‘˜å˜é‡åœ¨å†…å­˜å­˜å‚¨ä¸Šæ˜¯ä¸€æ®µè¿ç»­çš„å†…å­˜
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Num</span> <span style="color:#66d9ef">struct</span>{
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">j</span> <span style="color:#66d9ef">int64</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>(){
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">n</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Num</span>{<span style="color:#a6e22e">i</span>: <span style="color:#e6db74">&#34;EDDYCJY&#34;</span>, <span style="color:#a6e22e">j</span>: <span style="color:#ae81ff">1</span>}
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">nPointer</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">n</span>)
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// ç»“æ„ä½“çš„åˆå§‹åœ°å€å°±æ˜¯ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡çš„å†…å­˜åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">niPointer</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#66d9ef">string</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">nPointer</span>))
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">niPointer</span> = <span style="color:#e6db74">&#34;wuhan&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// åŸºäºç»“æ„ä½“çš„æˆå‘˜åœ°å€å»è®¡ç®—åç§»é‡ã€‚å°±èƒ½å¤Ÿå¾—å‡ºå…¶ä»–æˆå‘˜å˜é‡çš„å†…å­˜åœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">//uintptr æ˜¯ Go çš„å†…ç½®ç±»å‹ã€‚è¿”å›æ— ç¬¦å·æ•´æ•°ï¼Œå¯å­˜å‚¨ä¸€ä¸ªå®Œæ•´çš„åœ°å€ã€‚åç»­å¸¸ç”¨äºæŒ‡é’ˆè¿ç®—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">//unsafe.Offsetofï¼šè¿”å›æˆå‘˜å˜é‡ x åœ¨ç»“æ„ä½“å½“ä¸­çš„åç§»é‡ã€‚æ›´å…·ä½“çš„è®²ï¼Œå°±æ˜¯è¿”å›ç»“æ„ä½“åˆå§‹ä½ç½®åˆ° x ä¹‹é—´çš„å­—èŠ‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#75715e">//uintptr ç±»å‹æ˜¯ä¸èƒ½å­˜å‚¨åœ¨ä¸´æ—¶å˜é‡ä¸­çš„ ä¸´æ—¶å˜é‡æ˜¯å¯èƒ½è¢«åƒåœ¾å›æ”¶æ‰çš„ ä¹‹åçš„å†…å­˜æ“ä½œæœ‰è¿·èŒ«äº†
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">njPointer</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#66d9ef">int64</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(uintptr(<span style="color:#a6e22e">nPointer</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Offsetof</span>(<span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">j</span>)))
</span></span><span style="display:flex;"><span>	<span style="color:#f92672">*</span><span style="color:#a6e22e">njPointer</span> = <span style="color:#ae81ff">91</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;n.i: %s, n.j: %d&#34;</span>, <span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">i</span>, <span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">j</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æŒ‡é’ˆæ˜¯å¯¹å†…å­˜åŒºåŸŸçš„åœ°å€ï¼Œ ä¸æŒ‡é’ˆç›¸é…åˆçš„ç±»å‹
è¯´æ˜åŒºåŸŸæœ‰å“ªäº›å±æ€§ï¼Œå¦‚ä½•å»è§£æã€‚</p>
<br/>
<h3 id="nil">nil <a href="#nil" class="anchor">ğŸ”—</a></h3><ul>
<li>what is nil
<ul>
<li>nil is a kind of zero</li>
</ul>
</li>
<li>what is nil in go
<ul>
<li>å„ç§ç±»å‹çš„é›¶å€¼</li>
<li>åŸºæœ¬ç±»å‹çš„é›¶å€¼ä¸ä¸ºnil
<ul>
<li>boolä¸ºfalse</li>
<li>numberä¸º0</li>
<li>stringä¸º&quot;&quot;</li>
</ul>
</li>
<li>éåŸºæœ¬ç±»å‹çš„é›¶å€¼ä¸ºnil
<ul>
<li>pointer, slice, map, channel, function, interface{} ==&gt; nil</li>
<li>interface{}ç±»å‹ éœ€è¦typeå’Œvalueå‡ä¸ºnilæ—¶ï¼Œæ‰ä¼šä¸ºnil</li>
<li>structure{}ï¼Œå› ä¸ºæœ‰ç»“æ„typeå­˜åœ¨ï¼Œtypeä¸ä¸ºnilï¼Œæ‰€ä»¥ç»“æ„ä½“å˜é‡ä¸ä¼šæ˜¯nil</li>
</ul>
</li>
</ul>
</li>
</ul>
<br/>
<h3 id="åå°„">åå°„ <a href="#%e5%8f%8d%e5%b0%84" class="anchor">ğŸ”—</a></h3><p>åå°„ Reflection ï¼Œinterfaceå¯¹è±¡=ï¼ˆType, Valueï¼‰</p>
<p>åå°„ç±»å‹ reflect.Type, reflect.Value)</p>
<p>ä¸‰ç§åå°„çš„åŸºæœ¬æ“ä½œï¼š</p>
<ol>
<li>åå°„å¯ä»¥å°†interfaceç±»å‹çš„å˜é‡ è½¬æ¢ä¸º åå°„å¯¹è±¡ï¼ˆreflect.Type reflect.Valueï¼‰</li>
<li>åå°„å¯ä»¥å°†åå°„å¯¹è±¡ è¿˜åŸä¸ºinterfaceå¯¹è±¡</li>
<li>åå°„å¯¹è±¡å¯ä»¥ä¿®æ”¹ï¼Œæå‰æ˜¯valueå€¼æ˜¯å˜é‡çš„æŒ‡é’ˆ</li>
</ol>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">x</span> <span style="color:#66d9ef">float</span>= <span style="color:#ae81ff">3.1</span> 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">v</span><span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">x</span>) <span style="color:#75715e">//éœ€è¦ä¼ å…¥xçš„æŒ‡é’ˆ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Elem</span>().<span style="color:#a6e22e">SetFloat</span>(<span style="color:#ae81ff">3.4</span>);
</span></span></code></pre></div><p>ä½œç”¨ï¼š</p>
<ol>
<li>è¿è¡Œæ—¶åŠ¨æ€è°ƒç”¨æ–¹æ³•</li>
<li>è¿è¡Œæ—¶æ„é€ å‡½æ•°è¿›è¡Œmockæ’æ¡©</li>
</ol>
<br/>
<h3 id="å†…å­˜ç®¡ç†">å†…å­˜ç®¡ç† <a href="#%e5%86%85%e5%ad%98%e7%ae%a1%e7%90%86" class="anchor">ğŸ”—</a></h3><ol>
<li>åŸºæœ¬æƒ³æ³•ï¼šå±€éƒ¨Pä¸Šï¼ˆper cpuï¼‰å’Œå…¨å±€é˜Ÿåˆ—æƒ³ç»“åˆçš„å‡è¡¡æ€æƒ³ã€‚å±€éƒ¨åˆ†é…æ— éœ€åŠ é”ï¼Œå±€éƒ¨åˆ†é…æ— æ³•æ»¡è¶³æ—¶åŠ é”å…¨å±€åˆ†é…</li>
</ol>
<ul>
<li>src/runtime/mheap.go:mspan</li>
<li>å†…å­˜å›æ”¶åŸç†
<ul>
<li>ä¸‰è‰²æ ‡è®°æ³• ï¼ˆæœªä½¿ç”¨ï¼Œå·²ä½¿ç”¨ï¼Œå¸¦å¤„ç†ï¼‰</li>
<li>rootå¯¹è±¡å¼€å§‹ï¼ŒBFSéå†æ ‡è®°ï¼Œ</li>
</ul>
</li>
<li>é€ƒé€¸åˆ†æï¼ˆå¯¹è±¡æ˜¯å¦è¢«å‡½æ•°å¤–é¢å¼•ç”¨ ä¾‹å¦‚é—­åŒ…ï¼› å¯¹è±¡è¿‡å¤§ä¹Ÿå¯èƒ½åœ¨å †ä¸­ï¼‰
<ul>
<li>é€ƒé€¸åˆ†æçš„ç›®çš„æ˜¯å†³å®šå˜é‡çš„å†…å­˜åˆ†é…åœ°å€æ˜¯åœ¨æ ˆè¿˜æ˜¯å †</li>
<li>é€ƒé€¸åˆ†æåœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆçš„</li>
<li>ä¼ é€’æŒ‡é’ˆçœŸçš„æ¯”ä¼ å€¼é«˜æ•ˆå—ï¼Ÿä¸ä¸€å®š ç”±äºæŒ‡é’ˆä¼ é€’ä¼šäº§ç”Ÿé€ƒé€¸ï¼Œå¯èƒ½ä¼šä½¿ç”¨å †ï¼Œå¢åŠ GCè´Ÿæ‹…ã€‚</li>
<li>go build -gcflags=-m // escapes to heap</li>
</ul>
</li>
</ul>
<br/>
<hr>
<h2 id="å®é™…ç¼–è¯‘å™¨">å®é™…ç¼–è¯‘å™¨ <a href="#%e5%ae%9e%e9%99%85%e7%bc%96%e8%af%91%e5%99%a8" class="anchor">ğŸ”—</a></h2><p>ç¼–è¯‘å™¨å…¥å£ï¼š src/cmd/compile/internal/gc/main.go#Mainã€‚</p>
<p>cmd/compile/internal/syntax è¯æ³•å’Œè¯­æ³•åˆ†æ
<a href="https://golang.org/ref/spec" target="_blank" rel="noopener">è¯æ³•åˆ†æ</a></p>
<p>cmd/compile/internal/gc ç±»å‹æ£€æŸ¥ï¼Œ å¤„ç†è¯­æ³•ç³–ï¼Œæ”¹å†™å…³é”®å­—ã€‚</p>
<p>åç«¯</p>
<p>è½¬ä¸ºä¸ºSSAã€‚ ç”Ÿæˆä¸­é—´ä»£ç cmd/compile/internal/gc.compileFunctions</p>
<p>cmd/compile/internal/gc, cmd/compile/internal/ssa å°†å‡½æ•°æ”¾å…¥é˜Ÿåˆ—ï¼Œåç¨‹å¹¶å‘ç”Ÿæˆä¸­é—´ä»£ç ã€‚</p>
<p>ç”Ÿæˆæœºå™¨ä»£ç ã€‚ cmd/compile/internal/ssa , cmd/internal/obj
scr/cmd/compile/internal é“¾æ¥ä¸åŒçš„æŒ‡ä»¤é›†ç”Ÿæˆå¹³å°çš„æœºå™¨ç ã€‚</p>
<h2 id="è¯æ³•åˆ†æ-å’Œ-è¯­æ³•åˆ†æ">è¯æ³•åˆ†æ å’Œ è¯­æ³•åˆ†æ <a href="#%e8%af%8d%e6%b3%95%e5%88%86%e6%9e%90-%e5%92%8c-%e8%af%ad%e6%b3%95%e5%88%86%e6%9e%90" class="anchor">ğŸ”—</a></h2><p>è¯æ³•åˆ†æå™¨çš„ä¸»è¦ç»“æ„src/cmd/compile/internal/syntax/scanner.go#scanner structã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">scanner</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">source</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">mode</span> <span style="color:#66d9ef">uint</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">nlsemi</span> <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">line</span>, <span style="color:#a6e22e">col</span> <span style="color:#66d9ef">uint</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">blank</span> <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">tok</span> <span style="color:#a6e22e">token</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">lit</span> <span style="color:#66d9ef">string</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bad</span> <span style="color:#66d9ef">bool</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">kind</span> <span style="color:#a6e22e">LitKind</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">op</span> <span style="color:#a6e22e">Operator</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">prec</span> <span style="color:#66d9ef">int</span> 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>è¯æ³•åˆ†æå™¨çš„ä¸»è¦æ–¹æ³•src/cmd/compile/internal/syntax/scanner.go#next functionã€‚</p>
<p>ã€ŠLexical Scanning in Goã€‹ Rob Pike</p>
<p>todo read friendly codeã€‚</p>
<p>è¯­æ³•åˆ†æ src/cmd/compile/internal/syntax/parser.goã€‚
<a href="https://go.dev/ref/spec" target="_blank" rel="noopener">golangè¯­æ³•è§„åˆ™language specification</a></p>
<p>å›åˆ°ç¼–è¯‘åŸç†çš„è¯¾ç¨‹ä¸Š... è¯­æ³•åˆ†ææœ‰ä¸¤ç§åˆ†ææ–¹æ³•ã€‚</p>
<ul>
<li>Lookaheadã€‚è‡ªç„¶çš„æƒ³æ³•ï¼Œé¢„è¯»åç»­çš„tokenç¡®å®šæœ‰ä»€ä¹ˆæ–‡æ³•è¿›è¡Œå‘ä¸‹æ¨å¯¼ï¼Œæˆ–è€…è¿›è¡Œå‘ä¸Šå½’çº¦ã€‚</li>
<li>è‡ªé¡¶å‘ä¸‹ é€‰æ‹©ä¸€æ¡æ–‡æ³•è§„åˆ™ï¼ŒåŒ¹é…è§„åˆ™äº§ç”Ÿå¼çš„å·¦è¾¹æ—¶ ç”¨å³è¾¹çš„å­—ç¬¦ä¸²æ›¿æ¢å·¦è¾¹çš„éç»ˆç»“ç¬¦
<ul>
<li>ä»æŠ½è±¡åˆ°å…·ä½“</li>
<li>LLæ–‡æ³•</li>
</ul>
</li>
<li>è‡ªåº•å‘ä¸Š ä»ç»ˆç»“ç¬¦å¼€å§‹æ¨å¯¼ï¼Œè§„çº¦åˆ°æŸä¸€æ¡æ–‡æ³•è§„åˆ™ä¸Š
<ul>
<li>ä»å…·ä½“åˆ°æŠ½è±¡</li>
<li>LR(0)
<ul>
<li>ç”¨æ ˆå­˜å‚¨æ²¡æœ‰è¢«å½’çº¦çš„å­—ç¬¦ã€‚ å…¥æ ˆshiftã€‚å½’çº¦reduceï¼Œæ–°å­—ç¬¦è¿›æ¥æ—¶æŒ‰ç…§è§„åˆ™è¿›è¡Œåˆå¹¶å…¥æ ˆã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>syntax.Parse() -&gt; syntax.fileOrNil()å¯¹å½“å‰æ–‡ä»¶çš„è¯æ³•å’Œè¯­æ³•è¿›è¡Œè§£æã€‚<br>
fileOrNilè¿”å›ASTçš„æ ¹èŠ‚ç‚¹ï¼Œ ASTçš„å­èŠ‚ç‚¹ç”±parser.importDecl, parser.constDeclç­‰æ–¹æ³•æ„å»ºã€‚<br></p>
<ul>
<li>fileOrNil
<ul>
<li>constDecl</li>
<li>importDecl</li>
<li>typeDecl</li>
<li>varDecl</li>
<li>funcDeclOrNil</li>
</ul>
</li>
</ul>
<p>got, wantã€‚ <br>
appendGroup æ–¹æ³•å¤„ç†æ‰¹é‡å®šä¹‰ã€‚<br></p>
<p>FuncDecl: Name, FuncType, BlockStmtã€‚ å‡½æ•°ä½“æ˜¯BlockStmtï¼ŒStmtæ•°ç»„ç»„æˆã€‚<br>
Stmtæ˜¯ä¸€ä¸ªæ¥å£ã€‚14ç§å£°æ˜ã€‚EmptyStmt, BlockStmt, SendStmt, LabeledStmt, ExprStmt, DeclStmt, AssignStmt, CallStmt, IfStmt, BranchStmt, ReturnStmt, ForStmt, SelectStmtã€‚</p>
<h2 id="go-æŠ½è±¡è¯­æ³•æ ‘ast">go æŠ½è±¡è¯­æ³•æ ‘AST <a href="#go-%e6%8a%bd%e8%b1%a1%e8%af%ad%e6%b3%95%e6%a0%91ast" class="anchor">ğŸ”—</a></h2><p>golangç¨‹åºçš„å¦ä¸€ç§è¯­ä¹‰ç­‰ä»·æ˜¯goçš„æŠ½è±¡è¯­æ³•æ ‘ã€‚<br>
<a href="https://go.dev/ref/spec#Source_file_organization" target="_blank" rel="noopener">æŠ½è±¡è¯­æ³•æ ‘ASTæ˜¯åŸºäºæ¯ä¸ªæ–‡ä»¶ç‹¬ç«‹è¿›è¡Œç”Ÿæˆçš„</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">SourceFile</span> = <span style="color:#a6e22e">PackageClause</span> <span style="color:#e6db74">&#34;;&#34;</span> {<span style="color:#a6e22e">ImportDecl</span> <span style="color:#e6db74">&#34;;&#34;</span>} {<span style="color:#a6e22e">TopLevelDecl</span> <span style="color:#e6db74">&#34;;&#34;</span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#e6db74">&#34;main.go&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> <span style="color:#960050;background-color:#1e0010">SourceFile</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">PackageName:</span> <span style="color:#f92672">&#34;main&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">ImportDecl:</span> <span style="color:#960050;background-color:#1e0010">[]Import{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;fmt&#34;</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#960050;background-color:#1e0010">TopLevelDecl:</span> <span style="color:#960050;background-color:#1e0010">...</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><p><a href="">golangçš„è¯­æ³•è§£é‡Šå™¨ä½¿ç”¨ LALR(1)æ–‡æ³•è¿›è¡Œå®ç°</a><br></p>
<p><a href="">go tool</a>ä¸­çš„go fmt, go vet, go docç­‰å‘½ä»¤éƒ½æ˜¯åŸºäºgoæŠ½è±¡è¯­æ³•æ ‘çš„åˆ†æå·¥å…·ã€‚</p>
<p>go/* åŒ…æ˜¯golangçš„åº“ã€‚</p>
<p>go/token, go/scanner, go/parser, go/ast, go/ssaç­‰æºç åŒ…</p>
<h3 id="goçš„è¯æ³•åˆ†æ-filesetç»“æ„">Goçš„è¯æ³•åˆ†æï¼Œ FileSetç»“æ„ <a href="#go%e7%9a%84%e8%af%8d%e6%b3%95%e5%88%86%e6%9e%90-fileset%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h3><p>è¯æ³•å•å…ƒtokenåŒ…å«äº†ï¼š25ä¸ªå…³é”®è¯ï¼Œç”¨æˆ·è‡ªå®šä¹‰çš„æ ‡è¯†ç¬¦ï¼Œè¿ç®—ç¬¦ï¼Œåˆ†éš”ç¬¦ï¼Œæ³¨é‡Šç­‰ã€‚</p>
<pre tabindex="0"><code>// æ ‡è¯†ç¬¦çš„è¯æ³•è§„åˆ™
identifier := letter {letter | unicode_digit}
letter := unicode_letter | &#34;_&#34;
</code></pre><p>go/tokenåŒ…ï¼Œå°†tokenåˆ†æˆäº†ä»¥ä¸‹å‡ ç±»ï¼š  ç”±äºtokenæ˜¯intç±»å‹çš„ï¼Œæ‰€ä»¥tokenitoaä¸­åˆ†ç±»èŒƒå›´ä»xx_begå¼€å§‹ï¼Œ xx_endç»“æŸã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// Token is the set of lexical tokens of the Go programming language.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Token</span> <span style="color:#66d9ef">int</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// The list of tokens.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Special tokens               ç‰¹æ®Štoken æ³¨é‡Š å’Œ EOF
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Identifiers                  ç”¨æˆ·è‡ªå®šä¹‰çš„æ ‡è¯†ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Operators and delimiters     è¿ç®—ç¬¦ï¼Œæ‹¬å·ç­‰ç•Œé™ç¬¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// Keywords                     è¯­è¨€çš„å…³é”®è¯
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>
</span></span></code></pre></div><p><strong><font color=blue> FileSet, File</font></strong> <br></p>
<p>goé¡¹ç›®ä¸­æœ€ç»ˆçš„äº§ç‰©å¯æ‰§è¡Œç¨‹åº ç”±å¤šä¸ªåŒ…é“¾æ¥è€Œæˆï¼Œä¸€ä¸ªåŒ…ç”±å¤šä¸ªæ–‡ä»¶ç»„æˆã€‚ å•ä¸ªåŒ…å†…çš„å¤šä¸ªæ–‡ä»¶çœ‹ä½œæ˜¯goçš„åŸºæœ¬ç¼–è¯‘å•å…ƒã€‚<br>
æ‰€ä»¥åœ¨go/tokenåŒ…é‡Œç”¨FileSetè¡¨ç¤ºæ–‡ä»¶é›†ï¼Œ Fileè¡¨ç¤ºæ–‡ä»¶ã€‚</p>
<p>è¯æ³•å•å…ƒæ˜¯åç»­åˆ†æçš„åŸºç¡€å•ä½ã€‚<br></p>
<p>ä½†æ˜¯ä¸ºäº†åç»­æ“ä½œä½¿ç”¨ï¼Œè¯æ³•å•å…ƒè‡³å°‘éœ€è¦åŒ…å«tokençš„ç±»å‹ï¼ŒåŸå§‹æ–‡æœ¬ä¿¡æ¯ï¼Œå‡ºç°çš„ä½ç½®ã€‚<br></p>
<p>go/tokenåŒ…ä¸­Position.go#Positionç»“æ„ä½“ä¸­å®šä¹‰äº†ä½ç½®ä¿¡æ¯ï¼ŒåŒæ—¶type pos intä»£è¡¨FileSeté›†åˆä¸­çš„ä½ç½®ï¼Œé€šè¿‡Filesetåœ¨poså…¨å±€ä½ç½®å’Œå…·ä½“Positionä¹‹é—´è½¬æ¢ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> ( <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;go/scanner&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;go/token&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">src</span> = []byte(<span style="color:#e6db74">&#34; println(&#34;</span><span style="color:#a6e22e">hello</span> <span style="color:#a6e22e">world</span><span style="color:#e6db74">&#34;) &#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">fset</span> = <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">NewFileSet</span>()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">file</span> = <span style="color:#a6e22e">fset</span>.<span style="color:#a6e22e">AddFile</span>(<span style="color:#e6db74">&#34;hello.go&#34;</span>, <span style="color:#a6e22e">fset</span>.<span style="color:#a6e22e">Base</span>(), len(<span style="color:#a6e22e">src</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">s</span> <span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">Scanner</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Init</span>(<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">src</span>, <span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">scanner</span>.<span style="color:#a6e22e">ScanComments</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">pos</span>, <span style="color:#a6e22e">tok</span>, <span style="color:#a6e22e">lit</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Scan</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tok</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">EOF</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;pos=%s \t type=%s \t lit=%q \n&#34;</span>, <span style="color:#a6e22e">fset</span>.<span style="color:#a6e22e">Position</span>(<span style="color:#a6e22e">pos</span>), <span style="color:#a6e22e">tok</span>, <span style="color:#a6e22e">lit</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="åŸºç¡€å­—é¢å€¼çš„è¯­æ³•æ ‘ç»“æ„">åŸºç¡€å­—é¢å€¼çš„è¯­æ³•æ ‘ç»“æ„ <a href="#%e5%9f%ba%e7%a1%80%e5%ad%97%e9%9d%a2%e5%80%bc%e7%9a%84%e8%af%ad%e6%b3%95%e6%a0%91%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h3><p>åŸºæœ¬ç±»å‹å­—é¢é‡çš„è¯­æ³•æ ‘ç»“æ„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// go/ast#BasicLit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">BasicLit</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">ValuePos</span>    <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Pos</span>    <span style="color:#75715e">// intç±»å‹ï¼Œ FileSetä¸­çš„å…¨å±€Pos
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Kind</span>        <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Token</span>  <span style="color:#75715e">// tokençš„ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Value</span>       <span style="color:#66d9ef">string</span>       <span style="color:#75715e">// å­—é¢å€¼
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">expr</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parser</span>.<span style="color:#a6e22e">ParseExpr</span>(<span style="color:#e6db74">`&#34;1587&#34;`</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">// print ast.BasicLit
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">ast</span>.print(<span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">expr</span>)
</span></span></code></pre></div><p>æ ‡è¯†ç¬¦å­—é¢é‡çš„è¯­æ³•æ ‘ç»“æ„</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// go/ast#Ident
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Ident</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">NamePost</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Pos</span>    <span style="color:#75715e">// æ ‡è¯†ç¬¦åœ¨FileSetä¸­çš„å…¨å±€int Pos
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Nanme</span>    <span style="color:#66d9ef">string</span>       <span style="color:#75715e">// æ ‡è¯†ç¬¦çš„åå­—
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Obj</span>      <span style="color:#f92672">*</span><span style="color:#a6e22e">Object</span>      <span style="color:#75715e">// æ ‡è¯†ç¬¦çš„ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">NewIdent</span>(<span style="color:#e6db74">`x`</span>))
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">expr</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parser</span>.<span style="color:#a6e22e">ParserExpr</span>(<span style="color:#e6db74">`x`</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">expr</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*ast.Ident{
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    NamePos: 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    name: &#34;x&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    Obj: *ast.Object {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        Kind: bad
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        Name: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">*/</span>
</span></span></code></pre></div><h3 id="åŸºç¡€è¡¨è¾¾å¼çš„é€’å½’ç»“æ„">åŸºç¡€è¡¨è¾¾å¼çš„é€’å½’ç»“æ„ <a href="#%e5%9f%ba%e7%a1%80%e8%a1%a8%e8%be%be%e5%bc%8f%e7%9a%84%e9%80%92%e5%bd%92%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h3><p>goç¨‹åºä¸­è¿ç®—ä¸»è¦æ˜¯ä¸€å…ƒè¿ç®—ï¼ˆUnaryï¼‰å’ŒäºŒå…ƒè¿ç®—ï¼Œ è¿ç®—çš„æ“ä½œæ ‘æ˜¯æ•°å€¼å­—é¢é‡ or æ ‡è¯†ç¬¦ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#75715e">// è¡¨è¾¾å¼æ–‡æ³•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Expression</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">UnaryExpr</span> | <span style="color:#a6e22e">Expression</span> <span style="color:#a6e22e">binary_op</span> <span style="color:#a6e22e">Expression</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">UnaryExpr</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Operand</span> | <span style="color:#a6e22e">Unary_op</span> <span style="color:#a6e22e">UnaryExpr</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Operand</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">Literal</span> | <span style="color:#a6e22e">identifier</span> | <span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#a6e22e">Expression</span> <span style="color:#e6db74">&#34;)&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">binary_op</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;||&#34;</span> | <span style="color:#e6db74">&#34;&amp;&amp;&#34;</span> | <span style="color:#a6e22e">rel_op</span> | <span style="color:#a6e22e">add_op</span> | <span style="color:#a6e22e">mul_op</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">rel_op</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;==&#34;</span> | <span style="color:#e6db74">&#34;!=&#34;</span> | <span style="color:#e6db74">&#34;&lt;&#34;</span> | <span style="color:#e6db74">&#34;&lt;=&#34;</span> | <span style="color:#e6db74">&#34;&gt;&#34;</span> | <span style="color:#e6db74">&#34;&gt;=&#34;</span> 
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">add_op</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;+&#34;</span> | <span style="color:#e6db74">&#34;-&#34;</span> | <span style="color:#e6db74">&#34;|&#34;</span> | <span style="color:#e6db74">&#34;^&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">mul_op</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;*&#34;</span> | <span style="color:#e6db74">&#34;/&#34;</span> | <span style="color:#e6db74">&#34;%&#34;</span> | <span style="color:#e6db74">&#34;&lt;&lt;&#34;</span> | <span style="color:#e6db74">&#34;&gt;&gt;&#34;</span> | <span style="color:#e6db74">&#34;&amp;&#34;</span> | <span style="color:#e6db74">&#34;&amp;^&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">unary_op</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;+&#34;</span> | <span style="color:#e6db74">&#34;-&#34;</span> | <span style="color:#e6db74">&#34;!&#34;</span> | <span style="color:#e6db74">&#34;^&#34;</span> | <span style="color:#e6db74">&#34;*&#34;</span> | <span style="color:#e6db74">&#34;&amp;&#34;</span> | <span style="color:#e6db74">&#34;&lt;-&#34;</span>
</span></span></code></pre></div><p>parser.ParseExprç”¨äºè§£æå•ä¸ªè¡¨è¾¾å¼å¹¶è¿”å›ast.Exprã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Expr</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Node</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Node</span> <span style="color:#66d9ef">interface</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Pos</span>() <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Pos</span>    <span style="color:#75715e">// position of first character belonging to the node
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">End</span>() <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Pos</span>    <span style="color:#75715e">// position of first character immediately after the node
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>ç”±äºast.Expræ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨å¾ˆå¤šå®ç°äº†Expræ¥å£çš„å…·ä½“ç±»å‹å­˜åœ¨ã€‚ <br>
go doc go/ast | grep Expr --color<br>
ä¾‹å¦‚BinaryExpr, UnaryExpr, CallExpr, IndexExpr, KeyValueExprç­‰ç­‰ã€‚</p>
<pre tabindex="0"><code>expr, _ := parser.ParseExpr(`2 + 3 * 5`)
ast.Print(nil, expr)
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">BinaryExpr</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">X</span> <span style="color:#a6e22e">Expr</span>             <span style="color:#75715e">// å·¦æ“ä½œæ•°         å¯ä»¥å®ç°é€’å½’
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">OpPos</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Pos</span>    <span style="color:#75715e">// æ“ä½œç¬¦opçš„ä½ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Op</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Token</span>     <span style="color:#75715e">// æ“ä½œç¬¦tokençš„ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Y</span> <span style="color:#a6e22e">Expr</span>             <span style="color:#75715e">// å³æ“ä½œæ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>è¡¨è¾¾å¼çš„æ±‚å€¼ã€‚ååºéå†è¡¨è¾¾å¼çš„astã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">expr</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parser</span>.<span style="color:#a6e22e">ParseExpr</span>(<span style="color:#e6db74">`2 + 3 * 4`</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">Eval</span>(<span style="color:#a6e22e">expr</span>))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Eval</span>(<span style="color:#a6e22e">expr</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">Expr</span>) <span style="color:#66d9ef">float64</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">exprSpec</span> = <span style="color:#a6e22e">exp</span>.(<span style="color:#66d9ef">type</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">BinaryExpr</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">BinaryExpr</span>(<span style="color:#a6e22e">exprSpec</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">BasicLit</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">f</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">ParseFloat</span>(<span style="color:#a6e22e">exprSpec</span>.<span style="color:#a6e22e">Value</span>, <span style="color:#ae81ff">64</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">f</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">NaN</span>()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">BinaryExpr</span>(<span style="color:#a6e22e">expr</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">BinaryExpr</span>) <span style="color:#66d9ef">float64</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">expr</span>.<span style="color:#a6e22e">Op</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">ADD</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Eval</span>(<span style="color:#a6e22e">expr</span>.<span style="color:#a6e22e">X</span>) <span style="color:#f92672">+</span> <span style="color:#a6e22e">Eval</span>(<span style="color:#a6e22e">expr</span>.<span style="color:#a6e22e">Y</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cae</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">MUL</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Eval</span>(<span style="color:#a6e22e">expr</span>.<span style="color:#a6e22e">X</span>) <span style="color:#f92672">*</span> <span style="color:#a6e22e">Eval</span>(<span style="color:#a6e22e">expr</span>.<span style="color:#a6e22e">Y</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">math</span>.<span style="color:#a6e22e">NaN</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ç»™è¡¨è¾¾å¼å¼•èµ·ç¯å¢ƒå˜é‡ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">expr</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parser</span>.<span style="color:#a6e22e">ParseExpr</span>(<span style="color:#e6db74">`1 + 2 * 3 + x`</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">Eval</span>(<span style="color:#a6e22e">expr</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">float64</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;x&#34;</span>: <span style="color:#ae81ff">11</span>,
</span></span><span style="display:flex;"><span>}))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Eval</span>(<span style="color:#a6e22e">expr</span> <span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">Expr</span>, <span style="color:#a6e22e">vars</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">float64</span>) <span style="color:#66d9ef">float64</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> <span style="color:#a6e22e">exprSpec</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">exp</span>.(<span style="color:#66d9ef">type</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">BinaryExpr</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">EvalBinary</span>(<span style="color:#a6e22e">exprSpec</span>, <span style="color:#a6e22e">vars</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">BasicLit</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">Ident</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">vars</span>[<span style="color:#a6e22e">exprSpec</span>.<span style="color:#a6e22e">Name</span>]
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="goé¡¹ç›®çš„ä»£ç ç»“æ„">goé¡¹ç›®çš„ä»£ç ç»“æ„ <a href="#go%e9%a1%b9%e7%9b%ae%e7%9a%84%e4%bb%a3%e7%a0%81%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h3><h4 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„ <a href="#%e9%a1%b9%e7%9b%ae%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h4><p>é¡¹ç›®æŒ‰ç›®å½•ï¼ˆåŒ…ï¼‰è¿›è¡Œç»„ç»‡ï¼Œä¸€ä¸ªåŒ…ä¸‹åŒ…å«å¤šä¸ªæºæ–‡ä»¶ã€‚<br></p>
<p>go/parser#ParserDirè§£æä¸€ä¸ªç›®å½•ä¸‹çš„å¤šä¸ªåŒ…ï¼Œè¿”å›map[string]<em>ast.Packageã€‚<br>
go/parser#ParserFileè§£æå•ä¸ªæºæ–‡ä»¶ï¼Œè¿”å›</em>ast.Fileã€‚<br>
<em>ast.Packageç”±å¤šä¸ª</em>ast.Fileç»„æˆã€‚</p>
<h4 id="æ–‡ä»¶è¯­æ³•ç»“æ„">æ–‡ä»¶è¯­æ³•ç»“æ„ <a href="#%e6%96%87%e4%bb%b6%e8%af%ad%e6%b3%95%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h4><p>goæºæ–‡ä»¶åªåŒ…å«6ç§è¯­æ³•å£°æ˜å…ƒç´ ï¼š <strong>package, import, type, const, var, func </strong>ã€‚<br>
å¹¶ä¸”ï¼Œé€šè¿‡æ¯è¡Œå¼€å¤´çš„ä¸åŒå…³é”®è¯èƒ½å¤ŸåŒºåˆ†å¼€æ¥ä¸åŒçš„å£°æ˜ç±»å‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">File</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Doc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">CommentGroup</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Package</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Pos</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Name</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Ident</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Decls</span> []<span style="color:#a6e22e">Decl</span>                    <span style="color:#75715e">// top-level declarations;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Scope</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Scope</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Imports</span> []<span style="color:#f92672">*</span><span style="color:#a6e22e">ImportSpec</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Unresolved</span> []<span style="color:#f92672">*</span><span style="color:#a6e22e">Ident</span>            <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Comments</span> []<span style="color:#f92672">*</span><span style="color:#a6e22e">CommentGroup</span>       <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>go/ast#Printå‡½æ•°æ–¹ä¾¿è¾“å‡ºè¯­æ³•æ ‘ã€‚ go doc ast.Printã€‚ ast.Walkä¹Ÿå¯éå†æ ‘ã€‚</p>
<h3 id="goä¸­çš„import-type-const--var-çš„å£°æ˜ç»“æ„">goä¸­çš„import, type, const , var çš„å£°æ˜ç»“æ„ <a href="#go%e4%b8%ad%e7%9a%84import-type-const--var-%e7%9a%84%e5%a3%b0%e6%98%8e%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h3><p>import...</p>
<p>type MyInt int</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">TypeSpec</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Doc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">CommentGroup</span>       <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Name</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Ident</span>             <span style="color:#75715e">// type name, æ–°å£°æ˜ç±»å‹çš„åç§° MyInt
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Assign</span> <span style="color:#a6e22e">token</span>.<span style="color:#a6e22e">Pos</span>        <span style="color:#75715e">// å¯æœ‰å¯æ²¡æœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Type</span> <span style="color:#a6e22e">Expr</span>               <span style="color:#75715e">// any of the *XxxTypesï¼Œ int
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Comment</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">CommentGroup</span>   <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>const Pi = 3.1415926</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">ValueSpec</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Doc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">CommentGroup</span>       <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Names</span> []<span style="color:#f92672">*</span><span style="color:#a6e22e">Ident</span>          <span style="color:#75715e">// value names
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Type</span> <span style="color:#a6e22e">Expr</span>               <span style="color:#75715e">// value type or nil
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Values</span> []<span style="color:#a6e22e">Expr</span>           <span style="color:#75715e">// initial values; or nil
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Comment</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">CommentGroup</span>   <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>var Pi = 3.1415926 ä¸ å¸¸é‡å£°æ˜çš„è¯­æ³•è§„åˆ™ä¸€æ ·ï¼Œå…±ç”¨ValueSpecã€‚</p>
<h3 id="goå‡½æ•°çš„è¯­æ³•æ ‘ç»“æ„">goå‡½æ•°çš„è¯­æ³•æ ‘ç»“æ„ <a href="#go%e5%87%bd%e6%95%b0%e7%9a%84%e8%af%ad%e6%b3%95%e6%a0%91%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h3><p>goä¸­çš„æ¦‚å¿µï¼š æ–¹æ³•å’Œå‡½æ•°ã€‚ ä»è¯­æ³•è§„åˆ™å¯ä»¥çœ‹å‡º åŒºåˆ«æ˜¯æ²¡æœ‰æ¥å—è€…å‚æ•°ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">FunctionDecl</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;func&#34;</span> <span style="color:#a6e22e">MethodName</span> <span style="color:#a6e22e">Signature</span> [<span style="color:#a6e22e">FunctionBody</span>]
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">MethodDecl</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;func&#34;</span> <span style="color:#a6e22e">Recevier</span> <span style="color:#a6e22e">MethodName</span> <span style="color:#a6e22e">Signature</span> [<span style="color:#a6e22e">FunctionBody</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">FuncDecl</span> <span style="color:#66d9ef">struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Doc</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">CommentGroup</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Recv</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">FieldList</span>    <span style="color:#75715e">// receiver or nil
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Name</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Ident</span>        <span style="color:#75715e">// func/method name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Type</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">FuncType</span>     <span style="color:#75715e">// function signature
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Body</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BlockStmt</span>    <span style="color:#75715e">// function body
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="æ•°æ®å’Œç»“æ„ä½“ç­‰å¤åˆç±»å‹">æ•°æ®å’Œç»“æ„ä½“ç­‰å¤åˆç±»å‹ <a href="#%e6%95%b0%e6%8d%ae%e5%92%8c%e7%bb%93%e6%9e%84%e4%bd%93%e7%ad%89%e5%a4%8d%e5%90%88%e7%b1%bb%e5%9e%8b" class="anchor">ğŸ”—</a></h3><p>type Int1 pkg.int
type IntArr [2]int</p>
<p>type InterfaceType struct {...} type StructType struct {}çš„è¯­æ³•èŠ‚ç‚¹ç›¸ä¼¼ã€‚</p>
<h3 id="å¤æ‚çš„å­—é¢å€¼">å¤æ‚çš„å­—é¢å€¼ <a href="#%e5%a4%8d%e6%9d%82%e7%9a%84%e5%ad%97%e9%9d%a2%e5%80%bc" class="anchor">ğŸ”—</a></h3><p>éåŸºç¡€å­—é¢å€¼åŒ…å«äº† å‡½æ•°å­—é¢å€¼ å’Œ å¤åˆå­—é¢å€¼ã€‚</p>
<p>FunctionLit , FUncDeclåŒºåˆ«ï¼Ÿ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">expr</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">parser</span>.<span style="color:#a6e22e">ParseExpr</span>(<span style="color:#e6db74">`func() {}`</span>)
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ast</span>.<span style="color:#a6e22e">Print</span>(<span style="color:#66d9ef">nil</span>, <span style="color:#a6e22e">expr</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">FuncLit</span> <span style="color:#a6e22e">Struct</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">Type</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">FuncType</span>     <span style="color:#75715e">// functino type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Body</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">BlockStmt</span>    <span style="color:#75715e">//function body
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h3 id="å¤åˆè¡¨è¾¾å¼">å¤åˆè¡¨è¾¾å¼ <a href="#%e5%a4%8d%e5%90%88%e8%a1%a8%e8%be%be%e5%bc%8f" class="anchor">ğŸ”—</a></h3><p>è¯­å¥å—å’Œè¯­å¥ã€‚
æ•°æ®ç»“æ„æ˜¯ç¨‹åºçŠ¶æ€çš„è½½ä½“ã€‚
è¯­å¥çš„è¯­æ³•æ ‘æœ€å¤§ç‰¹ç‚¹æ˜¯å¯ä»¥é€’å½’å®šä¹‰ã€‚ç±»å‹çš„è¯­æ³•æ ‘ä¸èƒ½é€’å½’å®šä¹‰è‡ªå·±ã€‚</p>
<h3 id="å¯¹astè¿›è¡Œç±»å‹æ£€æŸ¥">å¯¹ASTè¿›è¡Œç±»å‹æ£€æŸ¥ <a href="#%e5%af%b9ast%e8%bf%9b%e8%a1%8c%e7%b1%bb%e5%9e%8b%e6%a3%80%e6%9f%a5" class="anchor">ğŸ”—</a></h3><p>go/typesåŒ…ã€‚<br></p>
<p>åœ¨go/parseråŒ…ä¸­åªå¤„ç†å½“å‰åŒ…çš„astï¼Œæ²¡æœ‰å¤„ç†å¯¼å…¥åŒ…çš„ç±»å‹ã€‚
è¯­ä¹‰é”™è¯¯ã€‚ goè¯­è¨€æ˜¯é€šè¿‡åŒ…å’Œç›®å½•ç»„ç»‡ä»£ç çš„ï¼Œåœ¨ç”Ÿæˆè¯­æ³•æ ‘æ—¶æ²¡æœ‰å…³æ³¨åŒ…çš„ä¾èµ–å…³ç³»ï¼Œæ‰€ä»¥å¯èƒ½ä¼šè·¨åŒ…çš„è¯­ä¹‰é”™è¯¯ã€‚</p>
<p>ç±»å‹æ£€æŸ¥çš„tasklist</p>
<ul>
<li>æ£€æŸ¥å¸¸é‡ã€ç±»å‹ã€å‡½æ•°çš„ç±»å‹</li>
<li>å˜é‡çš„èµ‹å€¼ï¼Œåˆå§‹åŒ–</li>
<li>å‡½æ•°å’Œé—­åŒ…ï¼Œå¦‚ä½•æ•è·å˜é‡ï¼Œå†…æ•›å‡½æ•°çš„ç±»å‹</li>
<li>å“ˆå¸Œé”®å€¼å¯¹çš„ç±»å‹</li>
<li>å¯¼å…¥å‡½æ•°ä½“</li>
<li>æ£€æŸ¥å¤–éƒ¨ä¾èµ–çš„å£°æ˜</li>
</ul>
<p>ç»“æ„ä½“å¯¹æ¥å£çš„å®ç°ã€‚</p>
<p>åœ¨ç±»å‹æ£€æŸ¥é˜¶æ®µé™¤äº†å¯¹èŠ‚ç‚¹çš„ç±»å‹è¿›è¡Œæ£€æŸ¥å¤–ï¼Œè¿˜ä¼šå¯¹makeã€chanå…³é”®è¯è¿›è¡Œæ”¹å†™ä¸ºruntime.makesliceã€runtime.makechanã€makemapã€‚</p>
<p>å®Œæˆtypecheckä¹‹åï¼Œé€šè¿‡src/cmd/compile/internal/gc.compileFunctionsç¼–è¯‘goé¡¹ç›®ä¸­çš„æ‰€æœ‰å‡½æ•°ã€‚<br>
æ‰€æœ‰å‡½æ•°ä¼šåœ¨ä¸€ä¸ªç¼–è¯‘é˜Ÿåˆ—ä¸Šè¢«<strong>å¹¶å‘ç¼–è¯‘</strong>goroutineè¿›è¡Œæ¶ˆè´¹å¤„ç†ã€‚ Functions -&gt; Queue -&gt; Goroutine consumeã€‚</p>
<p>æœºå™¨ä»£ç çš„ç”Ÿæˆã€‚ src/cmd/compile/internalç›®å½•ä¸‹æœ‰å¾ˆå¤šamd64, arm64, x86, wasmã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">GOARCH</span>=<span style="color:#a6e22e">wasm</span> <span style="color:#a6e22e">GOOS</span>=<span style="color:#a6e22e">js</span> <span style="color:#66d9ef">go</span> <span style="color:#a6e22e">build</span> <span style="color:#f92672">-</span><span style="color:#a6e22e">o</span> <span style="color:#a6e22e">lib</span>.<span style="color:#a6e22e">wasm</span> <span style="color:#a6e22e">main</span>.<span style="color:#66d9ef">go</span>
</span></span></code></pre></div><p>ç±»å‹æ£€æŸ¥çš„ä¸»è¦é€»è¾‘cmd/compile/internal/gc.typecheckï¼Œ ä¸»è¦åœ¨gc.typecheck1ä¸­ã€‚
å¾ˆå¤§çš„switchã€‚å¼±æ°´ä¸‰åƒï¼Œåªå–ä¸€ç“¢é¥®ã€‚ çœ‹å…¶ä¸­çš„OMake, OTARRAY, OTMAPæ—¢å¯ä»¥äº†ã€‚</p>
<h3 id="å¯¹astçš„è¯­ä¹‰ä¿¡æ¯">å¯¹ASTçš„è¯­ä¹‰ä¿¡æ¯ <a href="#%e5%af%b9ast%e7%9a%84%e8%af%ad%e4%b9%89%e4%bf%a1%e6%81%af" class="anchor">ğŸ”—</a></h3><h3 id="astè½¬æ¢æˆssa">ASTè½¬æ¢æˆSSA <a href="#ast%e8%bd%ac%e6%8d%a2%e6%88%90ssa" class="anchor">ğŸ”—</a></h3><p>go/ssaåŒ…ã€‚</p>
<p>astç»è¿‡go/typesåŒ…å®Œæˆè¯­ä¹‰åˆ†æç”Ÿæˆtypes.Packageå¯¹è±¡åï¼Œè¿›è¡Œssaæ ¼å¼çš„è½¬æ¢ã€‚</p>
<p>SSAä¸»è¦ç”¨äºè¡¨ç¤ºå‡½æ•°å†…çš„æŒ‡ä»¤ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Main</span>(<span style="color:#a6e22e">archInit</span> <span style="color:#66d9ef">func</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">Arch</span>)) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">initssaconfig</span>() <span style="color:#75715e">//åˆå§‹åŒ–ç”ŸæˆSSAçš„é…ç½®
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> &lt; len(<span style="color:#a6e22e">xtop</span>); <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">n</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">xtop</span>[<span style="color:#a6e22e">i</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">n</span>.<span style="color:#a6e22e">Op</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">ODCLFUNC</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#a6e22e">funccompile</span>(<span style="color:#a6e22e">n</span>) <span style="color:#75715e">//ç”ŸæˆSSA
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">compileFunctions</span>()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="åˆå§‹åŒ–ssaé…ç½®initssaconfig">åˆå§‹åŒ–SSAé…ç½®initssaconfig <a href="#%e5%88%9d%e5%a7%8b%e5%8c%96ssa%e9%85%8d%e7%bd%aeinitssaconfig" class="anchor">ğŸ”—</a></h4><p>1 ssa.NewTypes()åˆå§‹åŒ–Typesç»“æ„ä½“ã€‚<br>
2 func NewPtr(elem *Type) *Type <br>
3 cmd/compile/internal/ssa.NewConfigæ ¹æ®ä¼ å…¥çš„arch è®¾ç½® ç”Ÿæˆä¸­é—´ä»£ç å’Œæœºå™¨ä»£ç çš„å‡½æ•°ï¼Œå½“å‰ç¼–è¯‘å™¨ä½¿ç”¨çš„æŒ‡é’ˆ
å¯„å­˜å™¨å¤§å°ï¼Œå¯ç”¨å¯„å­˜å™¨åˆ—è¡¨ï¼Œç­‰ç¼–è¯‘é€‰é¡¹ã€‚</p>
<p>å¤„ç†runtime.deferproc, runtime.newproc, runtime.growsliceã€‚åˆå§‹åŒ–ç‰¹å®šçš„ABI</p>
<h4 id="éå†å’Œæ›¿æ¢">éå†å’Œæ›¿æ¢ <a href="#%e9%81%8d%e5%8e%86%e5%92%8c%e6%9b%bf%e6%8d%a2" class="anchor">ğŸ”—</a></h4><p>cmd/compile/internal/gc.walk ç”¨äºéå†ASTå°†ä¸€äº›å…³é”®å­—å’Œå†…å»ºå‡½æ•° è½¬æ¢ä¸º å‡½æ•°è°ƒç”¨ã€‚
ä¾‹å¦‚panic, recover è½¬æ¢ä¸ºruntime.gopanic , runtime.gorecoverã€‚newæ›¿æ¢ä¸ºruntime.newobjectå‡½æ•°ã€‚
åœ¨src/cmd/compile/internal/gc/builtin/runtime.goä¸­æ‰¾åˆ°å‡½æ•°çš„ç­¾åã€‚</p>
<p>ä¾‹å¦‚channelçš„è½¬æ¢è¿‡ç¨‹ã€‚å‘é€å’Œæ¥æ”¶ï¼ŒOSENDï¼Œ ORECVã€‚åœ¨cmd/compile/internal/gc.walkexpræ ¹æ®èŠ‚ç‚¹ç±»å‹è¿›å…¥ä¸åŒåˆ†æ”¯ï¼ŒOSENDæ—¶æ”¹å†™OSENDå­æ ‘ï¼Œcmd/compile/internal/gc.mkcall1åˆ›å»ºOCALLèŠ‚ç‚¹ï¼ˆåŒ…å«äº†runtime.chansend1ï¼‰ã€‚</p>
<p>æ‰€ä»¥channelçš„åº•å±‚å®ç°ï¼Œå‘é€ï¼Œæ¥å—ï¼Œå…³é—­çš„å®ç°åœ¨runtime.chansend1, runtime.chanrecv1, runtime.closechanä¸­ã€‚</p>
<h4 id="ssaçš„ç”Ÿæˆ">SSAçš„ç”Ÿæˆ <a href="#ssa%e7%9a%84%e7%94%9f%e6%88%90" class="anchor">ğŸ”—</a></h4><p>ç»è¿‡walkå‡½æ•°å¤„ç†åï¼Œ astå°±ä¸å†æ”¹å˜äº†ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">compileSSA</span>(<span style="color:#a6e22e">fn</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Node</span>, <span style="color:#a6e22e">worker</span> <span style="color:#66d9ef">int</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// inner: cmd/compile/internal/gc.state.stmtListå°†astè½¬ä¸ºssa
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// cmd/compile/internal/ssa.Compile ç»å†å¤šæ¬¡æ›´æ–°ssaä¸­é—´ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">buildssa</span>(<span style="color:#a6e22e">fn</span>, <span style="color:#a6e22e">worker</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pp</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">newProgs</span>(<span style="color:#a6e22e">fn</span>, <span style="color:#a6e22e">worker</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">genssa</span>(<span style="color:#a6e22e">f</span>, <span style="color:#a6e22e">pp</span>) <span style="color:#75715e">//ç”Ÿæˆcm/compile/internal/gc.Progsç»“æ„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">pp</span>.<span style="color:#a6e22e">Flush</span>() <span style="color:#75715e">// è°ƒç”¨cmd/internal/objåŒ…ä¸­çš„æ±‡ç¼–å™¨å°†ssaè½¬ä¸ºæ±‡ç¼–ä»£ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">s</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">state</span>) <span style="color:#a6e22e">call</span>(<span style="color:#a6e22e">n</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Node</span>, <span style="color:#a6e22e">k</span> <span style="color:#a6e22e">callKind</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">ssa</span>.<span style="color:#a6e22e">Value</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">call</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">ssa</span>.<span style="color:#a6e22e">Value</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">switch</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">k</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">callDefer</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">call</span> = <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">newValue1A</span>(<span style="color:#a6e22e">ssa</span>.<span style="color:#a6e22e">OpStaticCall</span>, <span style="color:#a6e22e">types</span>.<span style="color:#a6e22e">TypeMem</span>, <span style="color:#a6e22e">deferproc</span>, <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">mem</span>())
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">k</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">callgo</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">call</span> = <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">newValue1A</span>(<span style="color:#a6e22e">ssa</span>.<span style="color:#a6e22e">OpStaticCall</span>, <span style="color:#a6e22e">types</span>.<span style="color:#a6e22e">TypeMem</span>, <span style="color:#a6e22e">sym</span>.<span style="color:#a6e22e">Linksym</span>(), <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">mem</span>()) 
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>ä½¿ç”¨deferæ—¶æ’å…¥runtime.deferprocå‡½æ•°ã€‚ ä½¿ç”¨goå…³é”®è¯æ—¶æ’å…¥runtime.newprocå‡½æ•°ã€‚</p>
<p>å¤šæ¬¡è½¬æ¢ã€‚ç¼–è¯‘å™¨éœ€è¦ä¼˜åŒ–ä¸­é—´ä»£ç ã€‚ cmd/compile/internal/ssa.Compileå‡½æ•°æ‰§è¡Œã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Compile</span>(<span style="color:#a6e22e">f</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Func</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">passes</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">pass</span> = <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">p</span>
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">fn</span>(<span style="color:#a6e22e">f</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">passes</span> = [<span style="color:#f92672">...</span>]<span style="color:#a6e22e">pass</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    {<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;loop rotate&#34;</span>, <span style="color:#a6e22e">fn</span>: <span style="color:#a6e22e">loopRotate</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;stackframe&#34;</span>, <span style="color:#a6e22e">fn</span>: <span style="color:#a6e22e">stackFrame</span>, <span style="color:#a6e22e">required</span>: <span style="color:#66d9ef">true</span>},
</span></span><span style="display:flex;"><span>    {<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;trim&#34;</span>, <span style="color:#a6e22e">fn</span>: <span style="color:#a6e22e">trim</span>},
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="æœºå™¨ä»£ç çš„ç”Ÿæˆ">æœºå™¨ä»£ç çš„ç”Ÿæˆ <a href="#%e6%9c%ba%e5%99%a8%e4%bb%a3%e7%a0%81%e7%9a%84%e7%94%9f%e6%88%90" class="anchor">ğŸ”—</a></h3><p>ssaä¸­é—´ä»£ç çš„æœ€åé˜¶æ®µï¼ŒGoå‡½æ•°ä½“çš„ä»£ç è½¬æ¢æˆcmd/compile/internal/obj.Progç»“æ„ã€‚</p>
<ul>
<li>cmd/compile/internal/ssaåŒ…
<ul>
<li>è´Ÿè´£å¯¹ssaä¸­é—´ä»£ç è¿›è¡Œé™çº§ï¼Œæ‰§è¡Œç‰¹å®šæ¶æ„çš„ä¼˜åŒ–ï¼Œç”Ÿæˆcmd/compile/internal/obj.ProgæŒ‡ä»¤ã€‚</li>
</ul>
</li>
<li>cmd/internal/objåŒ…
<ul>
<li>ä½œä¸ºæ±‡ç¼–å™¨å°†ProgæŒ‡ä»¤è½¬æ¢ä¸ºæœºå™¨ç ã€‚</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">passes</span> = [<span style="color:#f92672">...</span>]<span style="color:#a6e22e">pass</span>{
</span></span><span style="display:flex;"><span>    {<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;lower&#34;</span>, <span style="color:#a6e22e">fn</span>: <span style="color:#a6e22e">lower</span>, <span style="color:#a6e22e">required</span>: <span style="color:#66d9ef">true</span>}
</span></span><span style="display:flex;"><span>    {<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;lowered deadcode for cse&#34;</span>, <span style="color:#a6e22e">fn</span>: <span style="color:#a6e22e">deadcode</span>},
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    {<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;trim&#34;</span>, <span style="color:#a6e22e">fn</span>: <span style="color:#a6e22e">trim</span>} 
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>å¦‚æœæ˜¯x86æ¶æ„ï¼Œè°ƒç”¨cmd/compile/internal/ssa.rewriteBlock386()ã€‚</p>
<p>æ±‡ç¼–ä»£ç ç”± cmd/internal/obj.Flushplistå‡½æ•°ç”Ÿæˆã€‚Preprocess, Assembleã€‚</p>
<h3 id="llvmçš„åŸºç¡€çŸ¥è¯†">LLVMçš„åŸºç¡€çŸ¥è¯† <a href="#llvm%e7%9a%84%e5%9f%ba%e7%a1%80%e7%9f%a5%e8%af%86" class="anchor">ğŸ”—</a></h3><hr>
<h2 id="go-æ±‡ç¼–">go æ±‡ç¼– <a href="#go-%e6%b1%87%e7%bc%96" class="anchor">ğŸ”—</a></h2><p>go tool compile -S main.go &gt; main.S</p>
<p>åŸæ–‡: <a href="https://jingwei.link/2018/07/01/runtime-of-goroutine-creation.html" target="_blank" rel="noopener">https://jingwei.link/2018/07/01/runtime-of-goroutine-creation.html</a></p>
<p>ssaé‡Œçš„ä¼˜åŒ–passï¼šhttps://github.com/golang/go/blob/acbe242f8a2cae8ef4749806291a37d23089b572/src/cmd/compile/internal/ssa/compile.go#L418</p>
<p>Generate x86 Assembly with Go</p>
<p><a href="https://github.com/mmcloughlin/avo" target="_blank" rel="noopener">https://github.com/mmcloughlin/avo</a></p>
<ul>
<li>æ±‡ç¼–é£æ ¼åˆ†ä¸º2ç±»</li>
</ul>
<ol>
<li>intelé£æ ¼(move dest, source)</li>
<li>AT&amp;Té£æ ¼(å·¦ --&gt; å³) goæ˜¯plan9ï¼Œ å±äºæ­¤ç±»</li>
</ol>
<ul>
<li>
<p>åŠ©è®°ç¬¦    call, add</p>
</li>
<li>
<p>register  ax, sb, pc</p>
</li>
<li>
<p>ç«‹å³æ•° $1 , $0x100</p>
</li>
<li>
<p>å†…å­˜å¯»å€ ï¼ˆR1ï¼‰</p>
</li>
<li>
<p>plan 9</p>
<ul>
<li><a href="https://lrita.github.io/2017/12/12/golang-asm/#go%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8" target="_blank" rel="noopener">https://lrita.github.io/2017/12/12/golang-asm/#go%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8</a></li>
<li><a href="https://lrita.github.io/images/posts/go/GoFunctionsInAssembly.pdf" target="_blank" rel="noopener">https://lrita.github.io/images/posts/go/GoFunctionsInAssembly.pdf</a></li>
<li><a href="https://github.com/buptbill220/gotls/tree/master/interesting" target="_blank" rel="noopener">https://github.com/buptbill220/gotls/tree/master/interesting</a></li>
<li>æŸ¥çœ‹å½“å‰cpuæ¶æ„çš„æŒ‡ä»¤é›†åˆ cat /proc/cpuinfo | grep flags | head -1</li>
<li>æŒ‡ä»¤æŸ¥è¯¢ï¼š <a href="http://68k.hax.com/" target="_blank" rel="noopener">http://68k.hax.com/</a></li>
<li>å‘½ä»¤æŸ¥è¯¢ï¼šhttps://9p.io/magic/man2html/1/8a</li>
<li>plan9 æ–‡æ¡£ï¼š <a href="https://9p.io/sys/doc/" target="_blank" rel="noopener">https://9p.io/sys/doc/</a></li>
</ul>
</li>
<li>
<p><a href="https://defuse.ca/online-x86-assembler.htm#disassembly2" target="_blank" rel="noopener">https://defuse.ca/online-x86-assembler.htm#disassembly2</a></p>
<ul>
<li>x86 or x64 assembly instructions encoding&lt;==&gt; decoding binary code</li>
<li>It uses GCC and objdump behind the scenes</li>
</ul>
</li>
<li>
<p>goroot/src/syscall --ã€‹ å»ºè®®ä½¿ç”¨ golang.org/x/sys</p>
</li>
</ul>
<h3 id="go-è®¾è®¡æ¨¡å¼">go è®¾è®¡æ¨¡å¼ <a href="#go-%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f" class="anchor">ğŸ”—</a></h3><p>search keyword <code>go patterns</code> <br></p>
<h4 id="è´£ä»»é“¾">è´£ä»»é“¾ <a href="#%e8%b4%a3%e4%bb%bb%e9%93%be" class="anchor">ğŸ”—</a></h4><p>é€šè¿‡é—­åŒ…å®ç°çš„httpä¸­é—´ä»¶ï¼Œåœ¨åŸæœ‰å‡½æ•°çš„åŸºç¡€ä¸ŠåŒ…è£¹ä¸­é—´åŠŸèƒ½ï¼Œè€Œä¸ç ´ååŸæœ‰å‡½æ•°</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-golang" data-lang="golang"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">HandleFunc</span>(<span style="color:#e6db74">&#34;/hello&#34;</span>, <span style="color:#a6e22e">timewrapper</span>(<span style="color:#a6e22e">hello</span>))
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ListenAndServe</span>(<span style="color:#e6db74">&#34;:8888&#34;</span>, <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">timewrapper</span>(<span style="color:#a6e22e">f</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>)) <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">w</span> <span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">ResponseWriter</span>, <span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">start</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">f</span>(<span style="color:#a6e22e">w</span>, <span style="color:#a6e22e">r</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">end</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;take time: &#34;</span>, <span style="color:#a6e22e">end</span>.<span style="color:#a6e22e">Sub</span>(<span style="color:#a6e22e">start</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div>
    </div>

    
        <div class="tags">
            
                <a href="http://brettkk.github.io/tags/golang">golang</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <script src="https://utteranc.es/client.js"
repo="brettKK/brettkk.github.io"
issue-term="title"
theme="github-light"
crossorigin="anonymous"
async>
</script>  

    <div class="copyright">
    
       Â© Copyright 
       2023 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://github.com/nodejh/hugo-theme-cactus-plus'>nodejh</a>
      </div>
    
</footer>




  </body>
</html>
