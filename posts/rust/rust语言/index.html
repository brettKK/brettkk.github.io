<!DOCTYPE html>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css">
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<html lang="zh-cn">
  <head>
    <title>rustè¯­è¨€ | brettkk</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="google comprehensive-rust 4days ğŸ”—è¾ƒçŸ­æ—¶é—´4 dayså…¥é—¨ã€‚ æ‘˜è¦: standard library Option, Result, error handling String Vec HashMap, config hash">
<meta name="generator" content="Hugo 0.103.1" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link href="https://cdn.bootcss.com/highlight.js/9.15.10/styles/zenburn.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<link rel="stylesheet" href="http://brettkk.github.io/css/syntax.css" />


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />




  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>




  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">rustè¯­è¨€</h1>

    <div class="tip">
        <time datetime="2022-11-05 11:33:56 &#43;0800 CST">Nov 5, 2022</time>
        <span class="split">
          Â·
        </span>
        <span>
          11066 words
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          23 minute read
        </span>
    </div>

    
    
        
  
    <aside class="toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#google-comprehensive-rust-4days">google comprehensive-rust 4days</a></li>
    <li><a href="#the-rust-programming-language">ã€ŠThe Rust Programming Languageã€‹</a>
      <ul>
        <li><a href="#1-å¼€å§‹å¼€å‘ç¯å¢ƒæ–‡æ¡£">1 å¼€å§‹(å¼€å‘ç¯å¢ƒï¼Œæ–‡æ¡£)</a></li>
        <li><a href="#cargo">cargo</a></li>
        <li><a href="#2-projectåŠ¨æ‰‹çŒœæ•°å°æ¸¸æˆ">2 projectï¼šåŠ¨æ‰‹çŒœæ•°å°æ¸¸æˆã€‚</a></li>
        <li><a href="#3-å’Œå…¶ä»–è¯­è¨€ç±»ä¼¼çš„æ¦‚å¿µ">3 å’Œå…¶ä»–è¯­è¨€ç±»ä¼¼çš„æ¦‚å¿µ</a></li>
        <li><a href="#4-æ‰€æœ‰æƒownership">4 æ‰€æœ‰æƒownership</a></li>
        <li><a href="#5ç»“æ„ä½“struct">5ç»“æ„ä½“struct</a></li>
        <li><a href="#6æšä¸¾ä½“enum-å’Œ-æ¨¡å¼åŒ¹é…">6æšä¸¾ä½“enum å’Œ æ¨¡å¼åŒ¹é…</a></li>
        <li><a href="#7-project-packagecrate-module">7 Project, package,crate, module</a></li>
        <li><a href="#8-å¸¸è§çš„é›†åˆ">8 å¸¸è§çš„é›†åˆ</a>
          <ul>
            <li><a href="#vect">Vec<T></a></li>
            <li><a href="#utf-8-encoding-in-string">UTF-8 encoding in String</a></li>
            <li><a href="#hashmapk-v">HashMap&lt;K, V&gt;</a></li>
            <li><a href="#å…¶ä»–æ•°æ®é›†åˆ">å…¶ä»–æ•°æ®é›†åˆ</a></li>
          </ul>
        </li>
        <li><a href="#9-é”™è¯¯å¤„ç†">9 é”™è¯¯å¤„ç†</a>
          <ul>
            <li><a href="#unrecoverable-errors-panic">unrecoverable errors panic!</a></li>
            <li><a href="#recoverable-errors-resultt-e">recoverable errors Result&lt;T, E&gt;</a></li>
          </ul>
        </li>
        <li><a href="#10-æ³›å‹traitç”Ÿå‘½å‘¨æœŸ">10 æ³›å‹ï¼Œtraitï¼Œç”Ÿå‘½å‘¨æœŸ</a>
          <ul>
            <li><a href="#æ³›æ³›çš„æ•°æ®ç±»å‹">æ³›æ³›çš„æ•°æ®ç±»å‹</a></li>
            <li><a href="#trait-å®šä¹‰é€šç”¨å…±äº«çš„è¡Œä¸º">trait å®šä¹‰é€šç”¨ã€å…±äº«çš„è¡Œä¸º</a></li>
            <li><a href="#æ£€æŸ¥å¼•ç”¨å€Ÿç”¨æœ‰æ•ˆæ€§--ç”Ÿå‘½å‘¨æœŸ">æ£€æŸ¥å¼•ç”¨(å€Ÿç”¨)æœ‰æ•ˆæ€§--ç”Ÿå‘½å‘¨æœŸ</a></li>
          </ul>
        </li>
        <li><a href="#11-æµ‹è¯•">11 æµ‹è¯•</a></li>
        <li><a href="#12-project-io-code">12 project: io code</a></li>
        <li><a href="#13-å‡½æ•°ç¼–ç¨‹è¯­è¨€çš„ç‰¹ç‚¹-iterator-closure">13 å‡½æ•°ç¼–ç¨‹è¯­è¨€çš„ç‰¹ç‚¹ï¼š Iterator, closure</a>
          <ul>
            <li><a href="#é—­åŒ…">é—­åŒ…</a></li>
            <li><a href="#è¿­ä»£å™¨">è¿­ä»£å™¨</a></li>
          </ul>
        </li>
        <li><a href="#14-cargo--cratesio">14 cargo &amp; crates.io</a>
          <ul>
            <li><a href="#cargotoml">Cargo.toml</a></li>
            <li><a href="#å‘å¸ƒåˆ°cratesio">å‘å¸ƒåˆ°crates.io</a></li>
            <li><a href="#workspaceç»„ç»‡é¡¹ç›®">workspaceç»„ç»‡é¡¹ç›®</a></li>
            <li><a href="#ä»cratesioä¸Šå®‰è£…è½¯ä»¶">ä»crates.ioä¸Šå®‰è£…è½¯ä»¶</a></li>
            <li><a href="#æ‰©å±•cargoçš„å­å‘½ä»¤">æ‰©å±•cargoçš„å­å‘½ä»¤</a></li>
          </ul>
        </li>
        <li><a href="#15-æ™ºèƒ½æŒ‡é’ˆ">15 æ™ºèƒ½æŒ‡é’ˆ</a></li>
        <li><a href="#16-å¹¶å‘">16 å¹¶å‘</a>
          <ul>
            <li><a href="#åˆ›å»ºçº¿ç¨‹">åˆ›å»ºçº¿ç¨‹</a></li>
            <li><a href="#çº¿ç¨‹é—´çš„é€šä¿¡message-passing-concurrencyvia-channel">çº¿ç¨‹é—´çš„é€šä¿¡ï¼Œmessage-passing concurrency,via channel</a></li>
            <li><a href="#çº¿ç¨‹é—´å…±äº«å†…å­˜å…±äº«çŠ¶æ€-shared-state-concurrency">çº¿ç¨‹é—´å…±äº«å†…å­˜ï¼ˆå…±äº«çŠ¶æ€ï¼‰ï¼Œ shared-state concurrency</a></li>
            <li><a href="#sync-send-trait">Sync, Send trait</a></li>
          </ul>
        </li>
        <li><a href="#17-ruståœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸Šçš„ç‰¹ç‚¹">17 ruståœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸Šçš„ç‰¹ç‚¹</a></li>
        <li><a href="#18-æ¨¡å¼å’ŒåŒ¹é…-patterns-and-matching">18 æ¨¡å¼å’ŒåŒ¹é… patterns and matching</a></li>
        <li><a href="#19-advance-features">19 advance features</a>
          <ul>
            <li><a href="#unsafe-rust">unsafe rust</a></li>
            <li><a href="#advance-trait">advance trait</a></li>
            <li><a href="#advance-type">advance type</a></li>
            <li><a href="#macros">Macros</a></li>
          </ul>
        </li>
        <li><a href="#20-project-web-server">20 project: web server</a></li>
        <li><a href="#å…¶ä»–é™„å½•">å…¶ä»–é™„å½•</a>
          <ul>
            <li><a href="#æºç ç»“æ„">æºç ç»“æ„</a></li>
          </ul>
        </li>
        <li><a href="#é¡¹ç›®ç»„ç»‡">é¡¹ç›®ç»„ç»‡</a>
          <ul>
            <li><a href="#å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–crate">å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–crate</a></li>
            <li><a href="#module">module</a></li>
            <li><a href="#å·¥ä½œç©ºé—´-rust-workspace">å·¥ä½œç©ºé—´ rust workspace</a></li>
          </ul>
        </li>
        <li><a href="#æ•°æ®">æ•°æ®</a>
          <ul>
            <li><a href="#å †å’Œæ ˆ">å †å’Œæ ˆ</a></li>
            <li><a href="#é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</a></li>
            <li><a href="#è¿­ä»£å™¨-1">è¿­ä»£å™¨</a></li>
          </ul>
        </li>
        <li><a href="#ä»£ç ">ä»£ç </a>
          <ul>
            <li><a href="#å‡½æ•°ä¸é—­åŒ…">å‡½æ•°ä¸é—­åŒ…</a></li>
            <li><a href="#æ¥å£ä¸è™šè¡¨">æ¥å£ä¸è™šè¡¨</a></li>
            <li><a href="#å®">å®</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#expression--statement">expression ğŸ†š statement</a>
      <ul>
        <li>
          <ul>
            <li><a href="#æ™ºèƒ½æŒ‡é’ˆ">æ™ºèƒ½æŒ‡é’ˆ</a></li>
            <li><a href="#åŠ¨æ€åˆ†æ´¾é™æ€åˆ†æ´¾">åŠ¨æ€åˆ†æ´¾ï¼Œé™æ€åˆ†æ´¾</a></li>
            <li><a href="#closure">closure</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#æ ¼å¼åŒ–è¾“å‡º">æ ¼å¼åŒ–è¾“å‡º</a></li>
    <li><a href="#rustä¹¦å†™çš„ä¹ æƒ¯">rustä¹¦å†™çš„ä¹ æƒ¯</a>
      <ul>
        <li><a href="#å‚è€ƒä¸èµ„æ–™">å‚è€ƒä¸èµ„æ–™</a></li>
      </ul>
    </li>
  </ul>
</nav>
          </div>
      </details>
    </aside>
  


    


    <div class="content">
      <h1 id="google-comprehensive-rust-4days">google comprehensive-rust 4days <a href="#google-comprehensive-rust-4days" class="anchor">ğŸ”—</a></h1><p><strong>è¾ƒçŸ­æ—¶é—´4 dayså…¥é—¨ã€‚</strong><br>
æ‘˜è¦:
standard library <br></p>
<ul>
<li>Option, Result, error handling</li>
<li>String</li>
<li>Vec</li>
<li>HashMap, config hash algorithm</li>
<li>Box: an owned pointer for heap-alloc data</li>
<li>Rc: a shared reference counted pointer for heap-alloc data</li>
</ul>
<p>é‡è¦çš„traits<br>
Iterator , IntoIterator(for in)
From<T> Into<T> convert type, Drop.</p>
<p>shared state å…±äº«å†…å­˜çš„çŠ¶æ€<br></p>
<ul>
<li>Arc<T>: share read-only access via <code>clone()</code></li>
<li>Mutex<T>: allow mutable access to T behind a read-only interfz</li>
<li><code>Arc&lt;Mutex&lt;Vec&lt;i32&gt;&gt;&gt;</code></li>
</ul>
<p>Send &amp; Sync <br></p>
<ul>
<li>T: send, T can move to thread. T alloc at t1 and de-alloc at t2</li>
<li>T: Sync, &amp;T can move to thread.  only if &amp;T: Send.</li>
<li>Send + Sync
<ul>
<li>å¤§éƒ¨åˆ†ç±»å‹éƒ½æ˜¯ i32, char, &amp;str, String, Arc<T>, Mutex<T> AtomicBool</li>
</ul>
</li>
<li>Send + !Sync
<ul>
<li>interior mutability</li>
<li>mpsc::Sender<T>, mpsc::Receiver<T></li>
<li>Cell<T> RefCell<T></li>
</ul>
</li>
<li>!Send + Sync
<ul>
<li>MutexGuard<T>,  alloc at t1 and should de-alloc at t2</li>
</ul>
</li>
<li>!Send + !Sync
<ul>
<li>Rc<T></li>
<li>*const T, *mut T</li>
</ul>
</li>
</ul>
<h1 id="the-rust-programming-language">ã€ŠThe Rust Programming Languageã€‹ <a href="#the-rust-programming-language" class="anchor">ğŸ”—</a></h1><p>æ¯”è¾ƒå…¨é¢ï¼Œçœ‹å®Œéœ€è¦è¾ƒé•¿æ—¶é—´</p>
<h2 id="1-å¼€å§‹å¼€å‘ç¯å¢ƒæ–‡æ¡£">1 å¼€å§‹(å¼€å‘ç¯å¢ƒï¼Œæ–‡æ¡£) <a href="#1-%e5%bc%80%e5%a7%8b%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83%e6%96%87%e6%a1%a3" class="anchor">ğŸ”—</a></h2><ul>
<li>rustup.rså®‰è£…rustcï¼Œ cargoï¼Œ rustfmt, etc...</li>
<li>rustup update æ›´æ–°rustcç‰ˆæœ¬ï¼Œ rustc --version</li>
<li>rustup doc // offline book</li>
<li>rustup docs --book ä¼šæ‰“å¼€file:///Users/brett/.rustup/toolchains/nightly-aarch64-apple-darwin/share/doc/rust/html/book/index.html <br></li>
<li>IDE support via <code>rust-analyzer</code></li>
<li>docs.rs å¯ä»¥çœ‹stdåº“çš„api</li>
<li>cargo --versionï¼Œ cargo checkï¼ˆmake sure it compiles and not gen exefileï¼‰</li>
</ul>
<p>çœ‹ä¹¦æ—¶çš„å°å½©è›‹ï¼Œ 3ç§èƒèŸ¹ğŸ¦€ï¸å›¾æ ‡å…·æœ‰ç‰¹æ®Šå«ä¹‰ï¼ˆä¸èƒ½ç¼–è¯‘ï¼Œè¿è¡Œæ—¶panicï¼Œä¸æ˜¯é¢„æœŸè¡Œä¸ºï¼‰ã€‚</p>
<h2 id="cargo">cargo <a href="#cargo" class="anchor">ğŸ”—</a></h2><p><code>cargo home</code>: åœ¨$HOME/.cargo/ä¸­å­˜å‚¨é¡¹ç›®çš„ä¾èµ–ã€‚ å…¶ä¸­ï¼Œ/binï¼šcargo installå®‰è£…çš„ç¨‹åºã€‚ /gitï¼š å¯¹githubä»“åº“çš„ä¾èµ–ã€‚ /registryï¼š å¯¹crate.ioä»“åº“çš„ä¾èµ–ã€‚</p>
<p><code>Cargo.toml</code>æ¸…å•çš„æ ¼å¼ã€‚<code>[workspace]</code>: é›†æˆå¤šä¸ªpackageä¸€èµ·å…±äº«ç›¸åŒçš„Cargo.lockï¼Œç›¸åŒçš„outputã€‚<code>[profiles]</code>: æ›´æ”¹ç¼–è¯‘å™¨çš„å‚æ•°, overflow-checks, lto (link time optimizations), incrementalå¢é‡ç¼–è¯‘ã€‚</p>
<h2 id="2-projectåŠ¨æ‰‹çŒœæ•°å°æ¸¸æˆ">2 projectï¼šåŠ¨æ‰‹çŒœæ•°å°æ¸¸æˆã€‚ <a href="#2-project%e5%8a%a8%e6%89%8b%e7%8c%9c%e6%95%b0%e5%b0%8f%e6%b8%b8%e6%88%8f" class="anchor">ğŸ”—</a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> rand::Rng;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::cmp::Ordering;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::io;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> secret_number <span style="color:#f92672">=</span> rand::thread_rng().gen_range(<span style="color:#ae81ff">1</span><span style="color:#f92672">..=</span><span style="color:#ae81ff">100</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">loop</span> {
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;Please input your guess.&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> guess <span style="color:#f92672">=</span> String::new();
</span></span><span style="display:flex;"><span>        io::stdin()
</span></span><span style="display:flex;"><span>            .read_line(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> guess)
</span></span><span style="display:flex;"><span>            .expect(<span style="color:#e6db74">&#34;Failed to read line&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> guess: <span style="color:#66d9ef">u32</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">match</span> guess.trim().parse() {
</span></span><span style="display:flex;"><span>            Ok(num) <span style="color:#f92672">=&gt;</span> num,
</span></span><span style="display:flex;"><span>            Err(_) <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">continue</span>,
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;You guessed: {guess}&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">match</span> guess.cmp(<span style="color:#f92672">&amp;</span>secret_number) {
</span></span><span style="display:flex;"><span>            Ordering::Less <span style="color:#f92672">=&gt;</span> println!(<span style="color:#e6db74">&#34;Too small!&#34;</span>),
</span></span><span style="display:flex;"><span>            Ordering::Greater <span style="color:#f92672">=&gt;</span> println!(<span style="color:#e6db74">&#34;Too big!&#34;</span>),
</span></span><span style="display:flex;"><span>            Ordering::Equal <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>                println!(<span style="color:#e6db74">&#34;You win!&#34;</span>);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><a href="https://doc.rust-lang.org/stable/std/string/struct.String.html" target="_blank" rel="noopener">Stringæ˜¯æ ‡å‡†åº“ä¸­å®šä¹‰çš„ç±»å‹</a><br>
String::new()è¡¨ç¤ºnewæ˜¯Stringç±»å‹ä¸Šå®ç°çš„å…³è”å‡½æ•°ï¼ˆassociated functionï¼‰ã€‚<br>
æ³¨æ„ç‚¹ï¼š <a href="https://doc.rust-lang.org/stable/std/prelude/index.html" target="_blank" rel="noopener">è‡ªåŠ¨å¯¼å…¥æ ‡å‡†åº“ä¸­çš„åŒ…</a><br>
io::stdin() è¿”å›<a href="https://doc.rust-lang.org/stable/std/io/struct.Stdin.html" target="_blank" rel="noopener">std::io::Stdinç»“æ„ä½“</a>ã€‚ read_lineè¿”å›enum Resultç»“æ„ä½“ï¼Œéœ€è¦å¤„ç†æ½œåœ¨çš„é”™è¯¯ï¼Œå¯ä»¥ä½¿ç”¨<a href="https://doc.rust-lang.org/stable/std/result/enum.Result.html#method.expect" target="_blank" rel="noopener">expect</a>ã€‚å¦‚æœResult&lt;T, E&gt;ç±»å‹çš„å€¼æ˜¯OkæˆåŠŸï¼Œè¿”å›Tã€‚å¦‚æœå¤±è´¥ï¼Œç¨‹åºåœ¨æ­¤å¤„panicå´©æºƒã€‚<br></p>
<p><a href="https://crates.io/crates/rand" target="_blank" rel="noopener">rand</a>æä¾›ç”Ÿæˆéšæœºæ•°çš„åŠŸèƒ½<br>
use rand::Rng; ä¸ºä»€ä¹ˆéœ€è¦å¯¼å…¥Rng? <br>
gen_range()æ–¹æ³•åœ¨trait Rngä¸­å®šä¹‰ã€‚å¦‚æœè¦ä½¿ç”¨traitä¸­çš„æ–¹æ³•ï¼Œtraitå¿…é¡»å¯¼å…¥åˆ°scopeä¸­ã€‚<br></p>
<p>å¦‚æœä¸çŸ¥é“ä¾èµ–çš„crateè¯¥æ€ä¹ˆä½¿ç”¨ï¼Ÿ<strong><font color=blue>cargo doc --open</font></strong></p>
<h2 id="3-å’Œå…¶ä»–è¯­è¨€ç±»ä¼¼çš„æ¦‚å¿µ">3 å’Œå…¶ä»–è¯­è¨€ç±»ä¼¼çš„æ¦‚å¿µ <a href="#3-%e5%92%8c%e5%85%b6%e4%bb%96%e8%af%ad%e8%a8%80%e7%b1%bb%e4%bc%bc%e7%9a%84%e6%a6%82%e5%bf%b5" class="anchor">ğŸ”—</a></h2><ul>
<li>å˜é‡
<ul>
<li>å¯å˜æ€§ã€‚ å˜é‡é»˜è®¤immutableä¸å¯å˜</li>
<li>constantsã€‚å£°æ˜æ—¶ä¸ç”¨letç”¨constã€‚å¿…é¡»æŒ‡æ˜ç±»å‹ã€‚const HOUR_IN_SECONDS: u32 = 60 * 60;</li>
<li>shadowingã€‚å˜é‡é®æŒ¡ã€‚</li>
</ul>
</li>
<li>æ•°æ®ç±»å‹
<ul>
<li>rustæ˜¯é™æ€ç±»å‹è¯­è¨€ï¼Œç¼–è¯‘æœŸéœ€è¦çŸ¥é“ç±»å‹</li>
<li>åŸºæœ¬ç±»å‹u32ï¼Œ i32ï¼Œ isizeï¼Œusizeï¼Œ charã€‚ã€‚ã€‚</li>
<li>å¤åˆç±»å‹tupleï¼ˆfix sizeï¼Œdiff typeï¼Œanomyï¼‰ï¼Œ arrayï¼ˆfix sizeï¼Œsame typeï¼‰ï¼Œstructï¼ˆï¼‰ï¼Œenumã€‚ã€‚ã€‚</li>
</ul>
</li>
<li>å‡½æ•°</li>
<li>æ³¨é‡Š
<ul>
<li>æ™®é€šæ³¨é‡Š</li>
<li>æ–‡æ¡£æ³¨é‡Š</li>
</ul>
</li>
<li>æ§åˆ¶æµï¼Œ if else, for, while, loop, break, continueï¼Œ gotoã€‚</li>
</ul>
<h2 id="4-æ‰€æœ‰æƒownership">4 æ‰€æœ‰æƒownership <a href="#4-%e6%89%80%e6%9c%89%e6%9d%83ownership" class="anchor">ğŸ”—</a></h2><pre tabindex="0"><code>ownership, a feature that makes Rust different from other languages. 
make memory safety guarantees without needing a garbage collector,
</code></pre><p>how Rust lays data out in memory. <br></p>
<p>stack &amp; heap -&gt; data on stack must fix-sized. <br></p>
<p>&amp;str (on text seg) vs String (on heap, mutable).<br>
Stringç±»å‹çš„å˜é‡æ˜¯æ™ºèƒ½æŒ‡é’ˆåœ¨stackä¸Šï¼ŒåŒ…å«3éƒ¨åˆ†ï¼ˆptr to heap addr, len, capacityï¼‰ã€‚</p>
<p><strong>shallow copy: copying the data on the pointer, length, and capacity without copying the data on heap </strong>  <strong>deep copy<strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hello&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> s1; <span style="color:#75715e">// ä¸ä»…ä»…æ˜¯æµ…æ‹·è´äº†s1ï¼Œ è€Œä¸”invalid s1ã€‚ ç§°ä¸ºmoveã€‚
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hello&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> s1.clone(); <span style="color:#75715e">//  deeply copy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    println!(<span style="color:#e6db74">&#34;s1 = {}, s2 = {}&#34;</span>, s1, s2);
</span></span></code></pre></div><p><code>trait Copy</code>åœ¨æ ˆä¸Šå­˜å‚¨çš„æ•°æ®ç±»å‹å®ç°äº†Copy traitï¼Œ éœ€è¦moveæ—¶æ‰§è¡Œçš„æ˜¯copyã€‚ä¾‹å¦‚ï¼š  <a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=9f6b7e4366b96713af039f4531e8da98" target="_blank" rel="noopener">æ ˆä¸Šçš„åŸºæœ¬ç±»å‹æ•°ç»„ä¹Ÿå®ç°äº†Copy trait</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> y <span style="color:#f92672">=</span> x; <span style="color:#75715e">// Stack-Only Data: deep and shallow copying is same.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    println!(<span style="color:#e6db74">&#34;x = {}, y = {}&#34;</span>, x, y);
</span></span></code></pre></div><pre tabindex="0"><code>Rust wonâ€™t let us annotate a type with Copy if the type, or any of its parts, has implemented the Drop trait.
</code></pre><p>æŒæœ‰æ‰€æœ‰æƒçš„å˜é‡ç¦»å¼€scopeæ—¶ï¼Œé‡Šæ”¾å†…å­˜<a href="https://doc.rust-lang.org/stable/std/ops/trait.Drop.html#tymethod.drop" target="_blank" rel="noopener">drop</a> ï¼Œä¸C++çš„Resource Acquisition Is Initialization (RAII)ç±»ä¼¼ã€‚<br></p>
<p>ownership &amp; function. <br></p>
<p>borrowing == reference <br>
rustä¸­æ‰€ç”¨çš„å‚æ•°ä¼ é€’éƒ½æ˜¯ä¼ å€¼ã€‚ å¼•ç”¨å®ç°äº†copy traitã€‚ æŒ‰ç…§copyè¯­ä¹‰ï¼Œå¼•ç”¨ä¼šå¤åˆ¶ä¸€ä»½äº¤ç»™è°ƒç”¨çš„å‡½æ•°ã€‚
<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=14d37d992ace5e53031eb2c88efe6cfe" target="_blank" rel="noopener">[char; 2] is Copy (as is any [T; N] where T: Copy).</a>ã€‚<br>
<a href="https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=008f91de3d0e88ccb5944768fef05c80" target="_blank" rel="noopener">[string; 2]ä¸èƒ½è¢«è‡ªåŠ¨copyã€‚</a>
borrow checker, . <a href="https://blog.rust-lang.org/2018/12/06/Rust-1.31-and-rust-2018.html#non-lexical-lifetimes" target="_blank" rel="noopener">calculate overlap</a></p>
<p>ref &amp;, deref *<br></p>
<p>slices == [T] -&gt; DST, å•å•åˆ‡ç‰‡ç±»å‹[T]æ˜¯ä¸çŸ¥é“é•¿åº¦çš„ï¼Œæ‰€ä»¥&amp;[T]ç”Ÿæˆæ™ºèƒ½æŒ‡é’ˆ(ptr + len)å°±å¯ä»¥ä½¿ç”¨äº†<br>
æ•°ç»„çš„åˆ‡ç‰‡ï¼Œå­—ç¬¦ä¸²çš„åˆ‡ç‰‡éƒ½æ˜¯ç±»ä¼¼ã€‚ &amp;[i32;9], &amp;String, &amp;strï¼Œ &amp;Vec<i32> ... <br></p>
<pre tabindex="0"><code>A slice is a kind of reference, let you reference a contiguous sequence of elements in a collection
</code></pre><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ch <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;åŒ—äº¬&#34;</span>.chars().nth(<span style="color:#ae81ff">0</span>).unwrap();
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;{ch}&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> chbyte <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;åŒ—äº¬&#34;</span>.bytes().nth(<span style="color:#ae81ff">0</span>).unwrap();
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;{chbyte}&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hello world&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> hello <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>s[<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">5</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> world <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>s[<span style="color:#ae81ff">6</span><span style="color:#f92672">..</span><span style="color:#ae81ff">11</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;ä½ å¥½&#34;</span>)<span style="color:#960050;background-color:#1e0010">ï¼›</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> ni <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>s[<span style="color:#ae81ff">0</span>:<span style="color:#ae81ff">2</span>]; <span style="color:#75715e">// error, 2ä¸æ˜¯[utf-8çš„å­—ç¬¦è¾¹ç•Œ]ã€‚
</span></span></span></code></pre></div><p><a href="https://doc.rust-lang.org/stable/book/ch08-02-strings.html#storing-utf-8-encoded-text-with-strings" target="_blank" rel="noopener">utf-8çš„å­—ç¬¦è¾¹ç•Œ</a><br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> string: String <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hello&#34;</span>);
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;string addr = {:?}&#34;</span>, string.as_ptr());
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;string len = {:?}&#34;</span>, string.len());
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;string cap = {:?}&#34;</span>, string.capacity());
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// String == struct{ptr, len, cap} on stack.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>println!(<span style="color:#e6db74">&#34;{:x?}&#34;</span>, <span style="color:#66d9ef">unsafe</span> {
</span></span><span style="display:flex;"><span>            std::mem::transmute::<span style="color:#f92672">&lt;</span>String, [<span style="color:#66d9ef">u8</span>; std::mem::size_of::<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span>()]<span style="color:#f92672">&gt;</span>(string)
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// &amp;str == struct{ptr, len}
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello&#34;</span>;
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;str addr = {:?}&#34;</span>, <span style="color:#66d9ef">str</span>.as_ptr());
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;str len = {:?}&#34;</span>, <span style="color:#66d9ef">str</span>.len());
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// println!(&#34;str cap = {:?}&#34;, str.capacity());
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>println!(<span style="color:#e6db74">&#34;{:x?}&#34;</span>, <span style="color:#66d9ef">unsafe</span> {
</span></span><span style="display:flex;"><span>            std::mem::transmute::<span style="color:#f92672">&lt;&amp;</span><span style="color:#66d9ef">str</span>, [<span style="color:#66d9ef">u8</span>; std::mem::size_of::<span style="color:#f92672">&lt;&amp;</span><span style="color:#66d9ef">str</span><span style="color:#f92672">&gt;</span>()]<span style="color:#f92672">&gt;</span>(<span style="color:#66d9ef">str</span>)
</span></span><span style="display:flex;"><span>        });
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">first_word</span>(s: <span style="color:#66d9ef">&amp;</span>String) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> bytes <span style="color:#f92672">=</span> s.as_bytes();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (i, <span style="color:#f92672">&amp;</span>item) <span style="color:#66d9ef">in</span> bytes.iter().enumerate() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> item <span style="color:#f92672">==</span> <span style="color:#e6db74">b&#39; &#39;</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span>s[<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span>i];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&amp;</span>s[<span style="color:#f92672">..</span>]
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>string Literals are Slices<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">str</span><span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Hello, world!&#34;</span>; <span style="color:#75715e">//&amp;str is an immutable reference. a slice pointing to that specific point of the binary.
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">first_word</span>(s: <span style="color:#66d9ef">&amp;</span>String) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span> {}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">first_word</span>(s: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span> {} <span style="color:#75715e">//  both &amp;String values and &amp;str values can call
</span></span></span></code></pre></div><h2 id="5ç»“æ„ä½“struct">5ç»“æ„ä½“struct <a href="#5%e7%bb%93%e6%9e%84%e4%bd%93struct" class="anchor">ğŸ”—</a></h2><p>3ç±»ç»“æ„ä½“ã€‚ struct A {}; struct B (); struct C;</p>
<p>tuple struct</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Color</span>(<span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> black <span style="color:#f92672">=</span> Color(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">AlwaysEqual</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> subject <span style="color:#f92672">=</span> AlwaysEqual; <span style="color:#75715e">//unit-like structs. useful for implement a trait on some type, donâ€™t have any data to store in the type
</span></span></span></code></pre></div><p>structä¸­çš„fieldæ‹¥æœ‰æ‰€æœ‰æƒæ—¶ï¼Œfieldå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ == structå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚<br>
structä¸­çš„fieldä¸­typeæ˜¯Stringï¼Œ æˆ–è€…typeæ˜¯&amp;strã€‚<br>
å½“fieldæ˜¯å¼•ç”¨ç±»å‹æ—¶ï¼Œstructç±»å‹éœ€è¦ä¿è¯structå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ &lt;= ä¾èµ–çš„å¼•ç”¨ç±»å‹å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚æ‰€ä»¥éœ€è¦å¼•å…¥lifetimeæ ‡è¯†ç¬¦ã€‚<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">User</span><span style="color:#f92672">&lt;&#39;</span><span style="color:#a6e22e">a</span><span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    active: <span style="color:#66d9ef">bool</span>,
</span></span><span style="display:flex;"><span>    username: <span style="color:#66d9ef">&amp;</span><span style="color:#f92672">&#39;</span><span style="color:#a6e22e">a</span> <span style="color:#66d9ef">str</span>,
</span></span><span style="display:flex;"><span>    email: <span style="color:#66d9ef">&amp;</span><span style="color:#f92672">&#39;</span><span style="color:#a6e22e">a</span> <span style="color:#66d9ef">str</span>,
</span></span><span style="display:flex;"><span>    sign_in_count: <span style="color:#66d9ef">u64</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Rectangle</span> {
</span></span><span style="display:flex;"><span>    width: <span style="color:#66d9ef">u32</span>,
</span></span><span style="display:flex;"><span>    height: <span style="color:#66d9ef">u32</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> rect1 <span style="color:#f92672">=</span> Rectangle {
</span></span><span style="display:flex;"><span>        width: <span style="color:#ae81ff">30</span>,
</span></span><span style="display:flex;"><span>        height: <span style="color:#a6e22e">dbg</span><span style="color:#f92672">!</span>(scale <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span>), <span style="color:#75715e">// dbg! return the ownership of the expressionâ€™s value and print expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    };
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;rect1 is {}&#34;</span>, rect1);  <span style="color:#75715e">// error[E0277]: `Rectangle` doesn&#39;t implement `std::fmt::Display`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>println!(<span style="color:#e6db74">&#34;rect1 is {:?}, {:#?}&#34;</span>, rect1, rect1); <span style="color:#75715e">//error[E0277]: `Rectangle` doesn&#39;t implement `Debug`
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// solved: #[derive(Debug)]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>dbg!(<span style="color:#f92672">&amp;</span>rect1);
</span></span></code></pre></div><p>automatic referencing and dereferencing. <br>
Rust automatically adds in &amp;, &amp;mut, or * to matches the signature of the method.<br></p>
<h2 id="6æšä¸¾ä½“enum-å’Œ-æ¨¡å¼åŒ¹é…">6æšä¸¾ä½“enum å’Œ æ¨¡å¼åŒ¹é… <a href="#6%e6%9e%9a%e4%b8%be%e4%bd%93enum-%e5%92%8c-%e6%a8%a1%e5%bc%8f%e5%8c%b9%e9%85%8d" class="anchor">ğŸ”—</a></h2><p>æšä¸¾ç±»å‹çš„å€¼èŒƒå›´æ˜¯å›ºå®šå¯æšä¸¾çš„ã€‚æ¨¡å¼åŒ¹é…ã€‚<a href="https://doc.rust-lang.org/stable/std/option/enum.Option.html" target="_blank" rel="noopener">Option</a>, match, if letã€‚<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">enum</span> Option<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    None,
</span></span><span style="display:flex;"><span>    Some(T),
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>æ¨¡å¼åŒ¹é… matchéœ€è¦<code>fill all arms, exhaustive patterns</code>ã€‚å¦‚æœåªå…³å¿ƒå…¶ä¸­ä¸€ä¸ªpatternï¼Œä½¿ç”¨<code>if let</code> <code>while let</code>ã€‚<br></p>
<p><strong>é»˜è®¤çš„åŒ¹é…æ˜¯ç»‘å®šæ“ä½œï¼Œ ä¼šè½¬ç§»æ‰€æœ‰æƒã€‚</strong><br>
<strong>ä»¥å¼•ç”¨æ–¹å¼å»åŒ¹é…, <code>ref</code>å¯ä»¥åœ¨åŒ¹é…æ—¶è·å¾—ä¸€ä¸ªå˜é‡çš„å¼•ç”¨</storng><br></p>
<h2 id="7-project-packagecrate-module">7 Project, package,crate, module <a href="#7-project-packagecrate-module" class="anchor">ğŸ”—</a></h2><p>å¦‚ä½•ç»„ç»‡rusté¡¹ç›®çš„ä»£ç ï¼Ÿ<br></p>
<ul>
<li>Packages: A Cargo feature that lets you build, test, and share crates, Cargo.toml
<ul>
<li>ä¸€ä¸ªpackageä¸‹å¯æœ‰å¤šä¸ªbin cratesï¼Œ <strong>src/main.rs</strong>ï¼› å¦‚æœæœ‰<strong>src/binæœ‰rsæ–‡ä»¶ï¼Œeach file will be a separate binary crate</strong>ã€‚</li>
<li>ä½†æœ€å¤šä¸€ä¸ªlib cratesï¼Œ src/lib.rsã€‚</li>
</ul>
</li>
<li>Crates:  A tree of modules that produces a library or executable, src/main.rs or src/lib.rs</li>
<li>Modules and use: Let you control the organization, scope, and privacy of paths
+</li>
<li>Paths:  A way of naming an item, such as a struct, function, or module
+</li>
</ul>
<h2 id="8-å¸¸è§çš„é›†åˆ">8 å¸¸è§çš„é›†åˆ <a href="#8-%e5%b8%b8%e8%a7%81%e7%9a%84%e9%9b%86%e5%90%88" class="anchor">ğŸ”—</a></h2><ul>
<li>vector åŠ¨æ€æ‰©å®¹æ•°ç»„</li>
<li>String å­—ç¬¦çš„é›†åˆï¼Œå­—ç¬¦ä¸²</li>
<li>HashMap</li>
</ul>
<p><a href="https://doc.rust-lang.org/stable/std/collections/index.html" target="_blank" rel="noopener">å…¶ä»–æ•°æ®é›†åˆ</a><br></p>
<h3 id="vect">Vec<T> <a href="#vect" class="anchor">ğŸ”—</a></h3><p><a href="">std::vec::Vec</a><br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#75715e">// create
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> v: Vec<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">i32</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> Vec::new();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> v <span style="color:#f92672">=</span> vec![<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// infer the type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Updating a Vector
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> v <span style="color:#f92672">=</span> Vec::new();
</span></span><span style="display:flex;"><span>    v.push(<span style="color:#ae81ff">4</span>);v.push(<span style="color:#ae81ff">5</span>);v.push(<span style="color:#ae81ff">6</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Reading Elements of Vectors
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>         <span style="color:#75715e">// via indexing or using the get method
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> third: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">i32</span> <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>v[<span style="color:#ae81ff">2</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> third: Option<span style="color:#f92672">&lt;&amp;</span><span style="color:#66d9ef">i32</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> v.get(<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">match</span> third {
</span></span><span style="display:flex;"><span>        Some(third) <span style="color:#f92672">=&gt;</span> println!(<span style="color:#e6db74">&#34;The third element is {third}&#34;</span>),
</span></span><span style="display:flex;"><span>        None <span style="color:#f92672">=&gt;</span> println!(<span style="color:#e6db74">&#34;There is no third element.&#34;</span>),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Iterating over the Values in a Vector
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> v <span style="color:#f92672">=</span> vec![<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">57</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#66d9ef">in</span> <span style="color:#f92672">&amp;</span>v { <span style="color:#75715e">// immutable reference to each element ï¼Œ type of i is &amp;i32
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println!(<span style="color:#e6db74">&#34;{i}&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> v <span style="color:#f92672">=</span> vec![<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">32</span>, <span style="color:#ae81ff">57</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#66d9ef">in</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> v { <span style="color:#75715e">// mutable reference, type of i is &amp;mut i32
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">*</span>i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">50</span>;     <span style="color:#75715e">// * dereference operator to get to the value in i
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Using an Enum to Store Multiple Types
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">SpreadsheetCell</span> {
</span></span><span style="display:flex;"><span>        Int(<span style="color:#66d9ef">i32</span>),
</span></span><span style="display:flex;"><span>        Float(<span style="color:#66d9ef">f64</span>),
</span></span><span style="display:flex;"><span>        Text(String),
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> row <span style="color:#f92672">=</span> vec![
</span></span><span style="display:flex;"><span>        SpreadsheetCell::Int(<span style="color:#ae81ff">3</span>),
</span></span><span style="display:flex;"><span>        SpreadsheetCell::Text(String::from(<span style="color:#e6db74">&#34;blue&#34;</span>)),
</span></span><span style="display:flex;"><span>        SpreadsheetCell::Float(<span style="color:#ae81ff">10.12</span>),
</span></span><span style="display:flex;"><span>    ];
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// using trait object to store in vector
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>more details at â€œThe Rustonomiconâ€ã€‚</p>
<h3 id="utf-8-encoding-in-string">UTF-8 encoding in String <a href="#utf-8-encoding-in-string" class="anchor">ğŸ”—</a></h3><p>åœ¨coreåŒ…ä¸­åªå®šä¹‰äº†strç±»å‹ï¼Œä»¥å¼•ç”¨çš„å½¢å¼å‡ºç°&amp;strã€‚<br>
åœ¨stdåŒ…ä¸­å®šä¹‰äº†Stringç±»å‹ï¼Œa growable, mutable, owned, <strong>UTF-8 encoded</strong> string typeã€‚
[]byte ã€‚A String is  a wrapper over a Vec<u8>ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#75715e">// create
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> s <span style="color:#f92672">=</span> String::new();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;initial contents&#34;</span>.to_string(); <span style="color:#75715e">// string literals  implements the Display trait (define to_string)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> s <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;initial contents&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Updating a String
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> s <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;foo&#34;</span>);
</span></span><span style="display:flex;"><span>    s.push_str(<span style="color:#e6db74">&#34;bar&#34;</span>);
</span></span><span style="display:flex;"><span>    s.push(<span style="color:#e6db74">&#39;l&#39;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Concatenation with the + Operator or the format! Macro
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;Hello, &#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;world!&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// fn add(self, s: &amp;str) -&gt; String ... coerce the &amp;String argument into a &amp;str
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> s3 <span style="color:#f92672">=</span> s1 <span style="color:#f92672">+</span> <span style="color:#f92672">&amp;</span>s2; <span style="color:#75715e">// note s1 has been moved here and can no longer be used
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> s <span style="color:#f92672">=</span> format!(<span style="color:#e6db74">&#34;{s2}{s3}&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Indexing into Strings
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// error....`String` cannot be indexed by `{integer}`  UTF-8ä¸­æœ‰æ•ˆå­—ç¬¦ä¸æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œindex at i å¯èƒ½æ˜¯ä¹±ç 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hello&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> h <span style="color:#f92672">=</span> s1[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Slicing Strings
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> hello <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Ğ—Ğ´Ñ€Ğ°Ğ²ÑÑ‚Ğ²ÑƒĞ¹Ñ‚Ğµ&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>hello[<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">4</span>];  <span style="color:#75715e">//s == &#34;3&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> s <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>hello[<span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">1</span>];  <span style="color:#75715e">//panic, `1` is not a `char boundary`; it is inside &#39;Ğ—&#39; (bytes 0..2) 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Methods for Iterating Over Strings
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> c <span style="color:#66d9ef">in</span> <span style="color:#e6db74">&#34;Ğ—Ğ´&#34;</span>.chars() {
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;{c}&#34;</span>); <span style="color:#75715e">// Ğ— \n Ğ´ \n
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> b <span style="color:#66d9ef">in</span> <span style="color:#e6db74">&#34;Ğ—Ğ´&#34;</span>.bytes() {
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;{b}&#34;</span>); <span style="color:#75715e">// 208 \n 151 \n 208 \n 180
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }   
</span></span></code></pre></div><h3 id="hashmapk-v">HashMap&lt;K, V&gt; <a href="#hashmapk-v" class="anchor">ğŸ”—</a></h3><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#75715e">//create
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// not ofen use, so not in the prelude
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">use</span> std::collections::HashMap;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> scores <span style="color:#f92672">=</span> HashMap::new();
</span></span><span style="display:flex;"><span>    scores.insert(String::from(<span style="color:#e6db74">&#34;Blue&#34;</span>), <span style="color:#ae81ff">10</span>);
</span></span><span style="display:flex;"><span>    scores.insert(String::from(<span style="color:#e6db74">&#34;Yellow&#34;</span>), <span style="color:#ae81ff">50</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// standard lib less support, no built-in macro to construct them.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Accessing Values in a Hash Map
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> team_name <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;Blue&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> score <span style="color:#f92672">=</span> scores.get(<span style="color:#f92672">&amp;</span>team_name).copied().unwrap_or(<span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> (key, value) <span style="color:#66d9ef">in</span> <span style="color:#f92672">&amp;</span>scores {
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;{}: {}&#34;</span>, key, value);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Hash Maps and Ownership
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// Adding a Key and Value Only If a Key Isnâ€™t Present
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    scores.entry(String::from(<span style="color:#e6db74">&#34;Yellow&#34;</span>)).or_insert(<span style="color:#ae81ff">50</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Updating a Value Based on the Old Value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello world wonderful world&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> map <span style="color:#f92672">=</span> HashMap::new();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> word <span style="color:#66d9ef">in</span> text.split_whitespace() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> count <span style="color:#f92672">=</span> map.entry(word).or_insert(<span style="color:#ae81ff">0</span>); <span style="color:#75715e">//or_insert method returns a mutable reference (&amp;mut V) to the value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#f92672">*</span>count <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//
</span></span></span></code></pre></div><h3 id="å…¶ä»–æ•°æ®é›†åˆ">å…¶ä»–æ•°æ®é›†åˆ <a href="#%e5%85%b6%e4%bb%96%e6%95%b0%e6%8d%ae%e9%9b%86%e5%90%88" class="anchor">ğŸ”—</a></h3><p>é“¾è¡¨ã€‚<br></p>
<hr>
<h2 id="9-é”™è¯¯å¤„ç†">9 é”™è¯¯å¤„ç† <a href="#9-%e9%94%99%e8%af%af%e5%a4%84%e7%90%86" class="anchor">ğŸ”—</a></h2><p>recover from an error or to stop execution? <br></p>
<h3 id="unrecoverable-errors-panic">unrecoverable errors panic! <a href="#unrecoverable-errors-panic" class="anchor">ğŸ”—</a></h3><p><a href="">panic!</a><br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">//RUST_BACKTRACE=1 cargo run
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// RUST_BACKTRACE=full cargo run
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> v <span style="color:#f92672">=</span> vec![<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>    v[<span style="color:#ae81ff">99</span>];
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="recoverable-errors-resultt-e">recoverable errors Result&lt;T, E&gt; <a href="#recoverable-errors-resultt-e" class="anchor">ğŸ”—</a></h3><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">enum</span> Result<span style="color:#f92672">&lt;</span>T, E<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    Ok(T),
</span></span><span style="display:flex;"><span>    Err(E),
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#66d9ef">use</span> std::fs::File;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">use</span> std::io::ErrorKind;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> greeting_file_result <span style="color:#f92672">=</span> File::open(<span style="color:#e6db74">&#34;hello.txt&#34;</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> greeting_file <span style="color:#f92672">=</span> <span style="color:#66d9ef">match</span> greeting_file_result {
</span></span><span style="display:flex;"><span>        Ok(file) <span style="color:#f92672">=&gt;</span> file,
</span></span><span style="display:flex;"><span>        Err(error) <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">match</span> error.kind() {
</span></span><span style="display:flex;"><span>            ErrorKind::NotFound <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">match</span> File::create(<span style="color:#e6db74">&#34;hello.txt&#34;</span>) {
</span></span><span style="display:flex;"><span>                Ok(fc) <span style="color:#f92672">=&gt;</span> fc,
</span></span><span style="display:flex;"><span>                Err(e) <span style="color:#f92672">=&gt;</span> panic!(<span style="color:#e6db74">&#34;Problem creating the file: {:?}&#34;</span>, e),
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            other_error <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>                panic!(<span style="color:#e6db74">&#34;Problem opening the file: {:?}&#34;</span>, other_error);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>    };
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::fs::File;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::io::ErrorKind;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> greeting_file <span style="color:#f92672">=</span> File::open(<span style="color:#e6db74">&#34;hello.txt&#34;</span>).unwrap_or_else(<span style="color:#f92672">|</span>error<span style="color:#f92672">|</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> error.kind() <span style="color:#f92672">==</span> ErrorKind::NotFound {
</span></span><span style="display:flex;"><span>            File::create(<span style="color:#e6db74">&#34;hello.txt&#34;</span>).unwrap_or_else(<span style="color:#f92672">|</span>error<span style="color:#f92672">|</span> {
</span></span><span style="display:flex;"><span>                panic!(<span style="color:#e6db74">&#34;Problem creating the file: {:?}&#34;</span>, error);
</span></span><span style="display:flex;"><span>            })
</span></span><span style="display:flex;"><span>        } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            panic!(<span style="color:#e6db74">&#34;Problem opening the file: {:?}&#34;</span>, error);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Shortcuts for Panic on Error: <strong>unwrap()</strong> and <strong>expect(&quot;infos&quot;)</strong> <br></p>
<p>Propagating Errors: ? <br>
? after a Result value. From trait and from function. <br>
? after Option value.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::fs::File;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> greeting_file <span style="color:#f92672">=</span> File::open(<span style="color:#e6db74">&#34;hello.txt&#34;</span>)<span style="color:#f92672">?</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::error::Error;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::fs::File;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() -&gt; Result<span style="color:#f92672">&lt;</span>(), Box<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">dyn</span> Error<span style="color:#f92672">&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> greeting_file <span style="color:#f92672">=</span> File::open(<span style="color:#e6db74">&#34;hello.txt&#34;</span>)<span style="color:#f92672">?</span>;
</span></span><span style="display:flex;"><span>    Ok(())
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>the ? operator in a function that must returns Result, Option, or another type that implements FromResidual <br>
mainçš„return type implement <a href="https://doc.rust-lang.org/stable/std/process/trait.Termination.html" target="_blank" rel="noopener">the std::process::Termination trait</a><br></p>
<h2 id="10-æ³›å‹traitç”Ÿå‘½å‘¨æœŸ">10 æ³›å‹ï¼Œtraitï¼Œç”Ÿå‘½å‘¨æœŸ <a href="#10-%e6%b3%9b%e5%9e%8btrait%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" class="anchor">ğŸ”—</a></h2><p>ç”Ÿå‘½å‘¨æœŸã€‚ å³å¼•ç”¨çš„æœ‰æ•ˆä½œç”¨åŸŸã€‚</p>
<h3 id="æ³›æ³›çš„æ•°æ®ç±»å‹">æ³›æ³›çš„æ•°æ®ç±»å‹ <a href="#%e6%b3%9b%e6%b3%9b%e7%9a%84%e6%95%b0%e6%8d%ae%e7%b1%bb%e5%9e%8b" class="anchor">ğŸ”—</a></h3><p>concrete types VS generic types -&gt; reduce code duplication.<br>
Monomorphization is the process of turning generic code into specific code by filling in the concrete types that are used when compiled.<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">// in function
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">largest</span><span style="color:#f92672">&lt;</span>T: <span style="color:#a6e22e">std</span>::cmp::PartialOrd<span style="color:#f92672">&gt;</span>(list: <span style="color:#66d9ef">&amp;</span>[T]) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">T</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> largest <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>list[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> item <span style="color:#66d9ef">in</span> list {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> item <span style="color:#f92672">&gt;</span> largest {
</span></span><span style="display:flex;"><span>            largest <span style="color:#f92672">=</span> item;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    largest
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// in struct
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Point</span><span style="color:#f92672">&lt;</span>T, U<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    x: <span style="color:#a6e22e">T</span>,
</span></span><span style="display:flex;"><span>    y: <span style="color:#a6e22e">U</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// in enum
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">enum</span> Option<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    Some(T),
</span></span><span style="display:flex;"><span>    None,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">enum</span> Result<span style="color:#f92672">&lt;</span>T, E<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    Ok(T),
</span></span><span style="display:flex;"><span>    Err(E),
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="trait-å®šä¹‰é€šç”¨å…±äº«çš„è¡Œä¸º">trait å®šä¹‰é€šç”¨ã€å…±äº«çš„è¡Œä¸º <a href="#trait-%e5%ae%9a%e4%b9%89%e9%80%9a%e7%94%a8%e5%85%b1%e4%ba%ab%e7%9a%84%e8%a1%8c%e4%b8%ba" class="anchor">ğŸ”—</a></h3><p>traitä¸ºç±»å‹å®šä¹‰é€šç”¨ã€å…±äº«çš„è¡Œä¸ºã€‚traitä¹Ÿå¯ä»¥é™åˆ¶æ³›å‹ç±»å‹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">// å®šä¹‰traitç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">trait</span> A {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">foo</span>(<span style="color:#f92672">&amp;</span>self);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¯ä»¥æœ‰é»˜è®¤çš„å‡½æ•°å®ç°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">bar</span>(<span style="color:#f92672">&amp;</span>self) -&gt; String {
</span></span><span style="display:flex;"><span>        String::from(<span style="color:#e6db74">&#34;bar&#34;</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// åœ¨ç±»å‹Type_Bä¸Šå®ç°trait A
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">impl</span> A <span style="color:#66d9ef">for</span> Type_B {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">foo</span>(<span style="color:#f92672">&amp;</span>self) {<span style="color:#f92672">..</span>.};
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// traitä½œä¸ºå‚æ•°
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">C</span>(item: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">impl</span> A) {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//accepts any type that implements the specified trait A
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    println!(<span style="color:#e6db74">&#34;hi, i have implement trait A, {}&#34;</span>, item.bar());
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//  trait bound;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">D</span><span style="color:#f92672">&lt;</span>T: <span style="color:#a6e22e">A</span><span style="color:#f92672">&gt;</span>(item: <span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;{}&#34;</span>, item.bar());
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Returning Types that impl trait. must returning a single implement trait type
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// especially useful in the context of closures and iterators,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//ä¸ºå®ç°äº†Display traitçš„ç±»å‹å®ç°ToString trait
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T: <span style="color:#a6e22e">Display</span><span style="color:#f92672">&gt;</span> ToString <span style="color:#66d9ef">for</span> T {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// --snip--
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> s <span style="color:#f92672">=</span> <span style="color:#ae81ff">3.</span>to_string(); <span style="color:#75715e">//ä»»ä½•å®ç°äº†Displayçš„ç±»å‹çš„å¯¹è±¡å¯è°ƒç”¨to_stringæ–¹æ³•ã€‚
</span></span></span></code></pre></div><h3 id="æ£€æŸ¥å¼•ç”¨å€Ÿç”¨æœ‰æ•ˆæ€§--ç”Ÿå‘½å‘¨æœŸ">æ£€æŸ¥å¼•ç”¨(å€Ÿç”¨)æœ‰æ•ˆæ€§--ç”Ÿå‘½å‘¨æœŸ <a href="#%e6%a3%80%e6%9f%a5%e5%bc%95%e7%94%a8%e5%80%9f%e7%94%a8%e6%9c%89%e6%95%88%e6%80%a7--%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" class="anchor">ğŸ”—</a></h3><p><a href="">Borrow Checker</a><br> ä¸ºäº†é¿å…dangling referencesã€‚
Lifetime Annotations in function Definitions<br>
Lifetime Annotations in Struct Definitions<br>
lifetime elision rules<br></p>
<p>å¦‚ä½•è®¡ç®—æ¯ä¸ªå˜é‡çš„ç”Ÿå‘½å‘¨æœŸ, a_refçš„life time[4 - 9]-&gt; a life time [code 2 - 10] (åŒºé—´æ˜¯åŒ…å«å…³ç³») âœ…</p>
<p>xçš„'a &gt;  yçš„'bï¼Œ x = &amp;y (âŒ) <br>
xçš„'a &lt;= yçš„'b, x = &amp;y (yes) <br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> s: <span style="color:#66d9ef">&amp;</span><span style="color:#f92672">&#39;</span>static <span style="color:#66d9ef">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;I have a static lifetime.&#34;</span>;
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s1 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hi&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;world&#34;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> largest <span style="color:#f92672">=</span> get_largest(s1, s2);
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;largest: {}&#34;</span>, largest);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">get_largest</span><span style="color:#f92672">&lt;&#39;</span><span style="color:#a6e22e">a</span><span style="color:#f92672">&gt;</span>(s1: <span style="color:#66d9ef">&amp;</span><span style="color:#f92672">&#39;</span><span style="color:#a6e22e">a</span> <span style="color:#66d9ef">str</span>, s2: <span style="color:#66d9ef">&amp;</span><span style="color:#f92672">&#39;</span><span style="color:#a6e22e">a</span> <span style="color:#66d9ef">str</span>) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#f92672">&#39;</span><span style="color:#a6e22e">a</span> <span style="color:#66d9ef">str</span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> s1.len() <span style="color:#f92672">&gt;</span> s2.len() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> s1
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    s2
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><a href="https://practice.rs/lifetime/static.html" target="_blank" rel="noopener">&amp;'static and T: 'static</a> <br></p>
<p>&amp;'staticç±»å‹çš„å€¼å‡ºç°çš„ä¸¤ç§æ–¹å¼</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello,world&#34;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> b <span style="color:#f92672">=</span> Box::leak(Box::new(a));
</span></span></code></pre></div><p><strong>Generic Type Parameters, Trait Bounds, and Lifetimes Together</strong> look a little complex, but all features happen at the compile time, no effect on runtime time.</p>
<h2 id="11-æµ‹è¯•">11 æµ‹è¯• <a href="#11-%e6%b5%8b%e8%af%95" class="anchor">ğŸ”—</a></h2><p>[type checking and borrow checking]ä¸èƒ½æ£€æŸ¥ç¨‹åºçš„å†…éƒ¨é€»è¾‘çš„æ­£ç¡®æ€§ï¼Œæ‰€ä»¥å¼•å…¥testingã€‚<br>
rust testingä¸­æœ‰å¥½ç”¨çš„annotationså’Œmacrosï¼Œä»¥åŠå¦‚ä½•ç»„ç»‡å•å…ƒæµ‹è¯•ï¼Œé›†æˆæµ‹è¯•ã€‚<br></p>
<p>#[test]å°†å‡½æ•°å˜ä¸ºæµ‹è¯•å‡½æ•°ã€‚</p>
<pre tabindex="0"><code>$cargo test 
running 1 test
test tests::it_works ... ok

test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s

   Doc-tests adder

running 0 tests

test result: ok. 0 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out; finished in 0.00s


0 ignored -&gt; #[should_ignore]
0 measured -&gt;  for benchmark tests 
0 filtered out -&gt; pass an argument to the cargo test command to run special tests 

Doc-tests adder -&gt; documentation tests.
</code></pre><p>assert_eq!, assert_ne! macros ç”¨åˆ°äº† operators == and !=ï¼Œ æ‰€ä»¥å‚æ•°éœ€è¦å®ç°PartialEq traitã€‚ åŒæ—¶failåï¼Œéœ€è¦æ‰“å°Debug formatçš„ä¿¡æ¯ï¼Œä¹Ÿéœ€è¦å®ç°Debug traitã€‚åŸºæœ¬ç±»å‹å·²ç»å®ç°äº†è¿™2ä¸ªtraitã€‚struct å’Œ enumç±»å‹éœ€è¦è‡ªè¡Œå®ç°ï¼Œæˆ–è€…#[derive(PartialEq, Debug)]ã€‚</p>
<p>cargo testçš„ä¸€äº›å‚æ•°é€‰é¡¹å¯ä»¥æ§åˆ¶å•æµ‹çš„æ‰§è¡Œã€‚<br>
show the output of successful tests:   cargo test -- --show-output. <br>
Runn Single Tests: cargo test single_func_name <br>
Run only the ignored tests: cargo test -- --ignored <br></p>
<p>å¦‚ä½•ç»„ç»‡æµ‹è¯•ä»£ç ï¼Ÿunit tests and integration tests<br></p>
<p>#[cfg(test)] åªä¼šåœ¨cargo testä¸‹æ‰§è¡Œï¼Œé¿å…æ‹–æ…¢ç¼–è¯‘é€Ÿåº¦ã€‚
tests/ä¸‹ æ”¾é›†æˆæµ‹è¯•æ–‡ä»¶ï¼Œä¸éœ€è¦#[cfg(test)]ã€‚
cargo testçš„æµ‹è¯•æ‰§è¡Œé¡ºåºæ˜¯ tests/ é›†æˆæµ‹è¯• -&gt; å•å…ƒæµ‹è¯• -&gt; æ–‡æ¡£æµ‹è¯•ã€‚<br></p>
<h2 id="12-project-io-code">12 project: io code <a href="#12-project-io-code" class="anchor">ğŸ”—</a></h2><p><a href="">done</a><br></p>
<h2 id="13-å‡½æ•°ç¼–ç¨‹è¯­è¨€çš„ç‰¹ç‚¹-iterator-closure">13 å‡½æ•°ç¼–ç¨‹è¯­è¨€çš„ç‰¹ç‚¹ï¼š Iterator, closure <a href="#13-%e5%87%bd%e6%95%b0%e7%bc%96%e7%a8%8b%e8%af%ad%e8%a8%80%e7%9a%84%e7%89%b9%e7%82%b9-iterator-closure" class="anchor">ğŸ”—</a></h2><h3 id="é—­åŒ…">é—­åŒ… <a href="#%e9%97%ad%e5%8c%85" class="anchor">ğŸ”—</a></h3><p>åŒ¿åå‡½æ•°ï¼Œæºå¸¦ç¯å¢ƒå˜é‡ã€‚</p>
<p>FnOnce (grand parent) -&gt; FnMut (parent) -&gt; Fn (child) <br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> Option<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">unwrap_or_else</span>(<span style="color:#f92672">&amp;</span>self, f: <span style="color:#a6e22e">F</span>) -&gt; <span style="color:#a6e22e">T</span> 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">where</span> F: FnOnce() -&gt; <span style="color:#a6e22e">T</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">match</span> self {
</span></span><span style="display:flex;"><span>            Some(x) <span style="color:#f92672">=&gt;</span> x,
</span></span><span style="display:flex;"><span>            None <span style="color:#f92672">=&gt;</span> f(), <span style="color:#75715e">//all closures implement FnOnce
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> a: Option<span style="color:#f92672">&lt;</span>Vec<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;&gt;</span> <span style="color:#f92672">=</span> None;
</span></span><span style="display:flex;"><span>a.unwrap_or_else(Vec::new); 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">#[derive[Debug]]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Rectangle</span> {
</span></span><span style="display:flex;"><span>    width: <span style="color:#66d9ef">u32</span>,
</span></span><span style="display:flex;"><span>    height: <span style="color:#66d9ef">u32</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> arr <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    Rectangle{width: <span style="color:#ae81ff">10</span>, height: <span style="color:#ae81ff">1</span>},
</span></span><span style="display:flex;"><span>    Rectangle{width: <span style="color:#ae81ff">3</span>, height: <span style="color:#ae81ff">5</span>},
</span></span><span style="display:flex;"><span>    Rectangle{width: <span style="color:#ae81ff">7</span>, height: <span style="color:#ae81ff">12</span>},
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> num_sort_operations <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>arr.sort_by_key(<span style="color:#f92672">|</span>r<span style="color:#f92672">|</span> {
</span></span><span style="display:flex;"><span>    num_sort_operations <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>    r.width}); <span style="color:#75715e">//uses FnMut
</span></span></span></code></pre></div><h3 id="è¿­ä»£å™¨">è¿­ä»£å™¨ <a href="#%e8%bf%ad%e4%bb%a3%e5%99%a8" class="anchor">ğŸ”—</a></h3><p>å¾ˆå¤šè¿­ä»£å™¨çš„å‡½æ•°å‚æ•°éƒ½æ˜¯é—­åŒ…ã€‚<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> v <span style="color:#f92672">=</span> vec![<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> v_iter <span style="color:#f92672">=</span> v.iter(); <span style="color:#75715e">//lazy and do nothing
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">for</span> item <span style="color:#66d9ef">in</span> v_iter {
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;Got: {item}&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>v_iter.next(); <span style="color:#75715e">//error
</span></span></span></code></pre></div><p>æ‰€æœ‰çš„è¿­ä»£å™¨å®ç°äº†trait Iteratorã€‚<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">trait</span> Iterator {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Item</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">next</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self) -&gt; Option<span style="color:#f92672">&lt;</span>Self::Item<span style="color:#f92672">&gt;</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">..</span>.
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> v1 <span style="color:#f92672">=</span> vec![<span style="color:#ae81ff">1</span> , <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span><span style="color:#75715e">// v1.into_iter(), v1.iter_mut()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> v1_iter <span style="color:#f92672">=</span> v1.iter(); <span style="color:#75715e">// should mut, for item in v_iter take Ownership
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>assert_eq!(v1_iter.next(), Some(<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>assert_eq!(v1_iter.next(), Some(<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">2</span>));
</span></span><span style="display:flex;"><span>assert_eq!(v1_iter.next(), Some(<span style="color:#f92672">&amp;</span><span style="color:#ae81ff">3</span>));
</span></span><span style="display:flex;"><span>assert_eq!(v1_iter.next(), None);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// sum()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> total: <span style="color:#66d9ef">i32</span> <span style="color:#f92672">=</span> v1_iter.sum(); <span style="color:#75715e">// take ownership
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// iterator adaptor map(), returns a new iterator
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> v1: Vec<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">i32</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> vec![<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>v1.iter().map(<span style="color:#f92672">|</span>x<span style="color:#f92672">|</span> x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>); <span style="color:#75715e">//lazy
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// filter()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// collect()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> v2: Vec<span style="color:#f92672">&lt;</span>_<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> v1.iter().map(<span style="color:#f92672">|</span>x<span style="color:#f92672">|</span> x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>).collect();
</span></span></code></pre></div><hr>
<p>loop vs iterator<br></p>
<h2 id="14-cargo--cratesio">14 cargo &amp; crates.io <a href="#14-cargo--cratesio" class="anchor">ğŸ”—</a></h2><p><a href="https://doc.rust-lang.org/cargo/" target="_blank" rel="noopener">The Cargo Book</a><br></p>
<h3 id="cargotoml">Cargo.toml <a href="#cargotoml" class="anchor">ğŸ”—</a></h3><pre tabindex="0"><code>[profile.dev]
opt-level = 0
[profile.release]
opt-level = 3
</code></pre><h3 id="å‘å¸ƒåˆ°cratesio">å‘å¸ƒåˆ°crates.io <a href="#%e5%8f%91%e5%b8%83%e5%88%b0cratesio" class="anchor">ğŸ”—</a></h3><p>æ–‡æ¡£æ³¨é‡Šï¼Œ <strong>cargo doc --open</strong> æŸ¥çœ‹æœ¬é¡¹ç›®çš„æ–‡æ¡£æ³¨é‡Šå¯¹åº”çš„htmlæ–‡æ¡£ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#e6db74">/// # Examples 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/// # Panics
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/// # Safety
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">/// # Errors
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#75715e">// æ–‡æ¡£æµ‹è¯•
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//ï¼ 
</span></span></span></code></pre></div><p>Exporting a Convenient Public API with <strong>pub use</strong> <br>
use my_crate::some_module::another_module::UsefulType; -&gt; use my_crate::UsefulType;<br>
åœ¨ä¸€ä¸ªlibrary Açš„src/lib.rsä¸­<strong>pub use A::B::C::D;</strong> å¯ä»¥åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½¿ç”¨<strong>use A::D</strong>å¯¼å…¥åˆ°scopeä¸­ã€‚<br></p>
<p>åœ¨crates.ioä¸Šåˆ›å»ºè´¦å·å¹¶è·å–tokenã€‚ cargo login token11222<br>
æ›´æ”¹tomlæ–‡ä»¶ä¸­çš„cargo publish<br></p>
<h3 id="workspaceç»„ç»‡é¡¹ç›®">workspaceç»„ç»‡é¡¹ç›® <a href="#workspace%e7%bb%84%e7%bb%87%e9%a1%b9%e7%9b%ae" class="anchor">ğŸ”—</a></h3><p>ä¸€ä¸ªworkspaceä¸‹ç®¡ç†å¤šä¸ªæ–‡ä»¶å¤¹ï¼Œ<strong>å…±äº«åŒä¸€ä¸ªCargo.lockå’Œoutput targetç›®å½•</strong><br>
ä¾‹å¦‚ä¸€ä¸ªworkspaceä¸‹åŒ…å«ä¸€ä¸ªbinå’Œ2ä¸ªlibrariesã€‚workspace: add -&gt; (bin: adder, lib: add_one, add_two)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">$</span> mkdir add
</span></span><span style="display:flex;"><span><span style="color:#75715e">$</span> cd add
</span></span><span style="display:flex;"><span><span style="color:#75715e">// touch and edit Cargo.toml
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>[workspace]
</span></span><span style="display:flex;"><span>members <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;adder&#34;</span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">// under the add workspace directory
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">$</span> cargo new adder
</span></span><span style="display:flex;"><span>     Created binary (application) <span style="color:#960050;background-color:#1e0010">`</span>adder<span style="color:#960050;background-color:#1e0010">`</span> package
</span></span><span style="display:flex;"><span><span style="color:#75715e">$</span> cargo build 
</span></span></code></pre></div><p>ç°åœ¨workspace addç›®å½•ä¸‹çš„ç»“æ„ï¼š<br>
â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ adder
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main.rs
â””â”€â”€ target</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>[workspace]
</span></span><span style="display:flex;"><span>members <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;adder&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;add_one&#34;</span>,
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span><span style="color:#75715e">// under the add workspace directory
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">$</span> cargo new add_one <span style="color:#f92672">--</span>lib
</span></span><span style="display:flex;"><span>     Created library <span style="color:#960050;background-color:#1e0010">`</span>add_one<span style="color:#960050;background-color:#1e0010">`</span> package
</span></span></code></pre></div><p>â”œâ”€â”€ Cargo.lock
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ add_one
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ lib.rs
â”œâ”€â”€ adder
â”‚   â”œâ”€â”€ Cargo.toml
â”‚   â””â”€â”€ src
â”‚       â””â”€â”€ main.rs
â””â”€â”€ target</p>
<p>edit add_one/src/lib.rs</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">// add_one/src/lib.rs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">add_one</span>(x: <span style="color:#66d9ef">i32</span>) -&gt; <span style="color:#66d9ef">i32</span> {
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åœ¨adder crateä¸­å¢åŠ å¯¹add_one lib crateçš„ä¾èµ–ã€‚</p>
<pre tabindex="0"><code>Filename: adder/Cargo.toml

[dependencies]
add_one = { path = &#34;../add_one&#34; }
</code></pre><p>edit Filename: adder/src/main.rs</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> add_one;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> num <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;Hello, world! {num} plus one is {}!&#34;</span>, add_one::add_one(num));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>åœ¨workspace addç›®å½•ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">$</span> cargo run <span style="color:#f92672">-</span>p adder
</span></span><span style="display:flex;"><span>    Finished dev [unoptimized <span style="color:#f92672">+</span> debuginfo] target(s) <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">0.0</span>s
</span></span><span style="display:flex;"><span>     Running <span style="color:#960050;background-color:#1e0010">`</span>target<span style="color:#f92672">/</span>debug<span style="color:#f92672">/</span>adder<span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>Hello, world<span style="color:#f92672">!</span> <span style="color:#ae81ff">10</span> plus one is <span style="color:#ae81ff">11</span><span style="color:#f92672">!</span>
</span></span></code></pre></div><p>ç”±äºworkspaceä¸‹çš„crateå…±äº«äº†Cargo.lockã€‚all crates are using the same version of all dependencies<br></p>
<pre tabindex="0"><code>// add_one/Cargo.toml
[dependencies]
rand = &#34;0.8.3&#34;
</code></pre><p>å¦‚éœ€è¦publish workspaceä¸‹çš„crateåˆ°crate.ioï¼Œéœ€è¦publish -p åˆ†å¼€å‘å¸ƒã€‚<br></p>
<h3 id="ä»cratesioä¸Šå®‰è£…è½¯ä»¶">ä»crates.ioä¸Šå®‰è£…è½¯ä»¶ <a href="#%e4%bb%8ecratesio%e4%b8%8a%e5%ae%89%e8%a3%85%e8%bd%af%e4%bb%b6" class="anchor">ğŸ”—</a></h3><p>cargo install æ–¹é¢ä»crates.ioä¸Šå®‰è£…å·¥å…·ï¼Œå¹¶å®‰è£…åœ¨$HOME/.cargo/</p>
<pre tabindex="0"><code>$ cargo install ripgrep
    Updating crates.io index
  Downloaded ripgrep v11.0.2
  Downloaded 1 crate (243.3 KB) in 0.88s
  Installing ripgrep v11.0.2
--snip--
   Compiling ripgrep v11.0.2
    Finished release [optimized + debuginfo] target(s) in 3m 10s
  Installing ~/.cargo/bin/rg
   Installed package `ripgrep v11.0.2` (executable `rg`)
$ rg --help
</code></pre><h3 id="æ‰©å±•cargoçš„å­å‘½ä»¤">æ‰©å±•cargoçš„å­å‘½ä»¤ <a href="#%e6%89%a9%e5%b1%95cargo%e7%9a%84%e5%ad%90%e5%91%bd%e4%bb%a4" class="anchor">ğŸ”—</a></h3><p>å¦‚æœåœ¨$PAThä¸‹æœ‰ä¸€ä¸ªâ€˜cargo-somethingâ€™çš„exeï¼Œèƒ½å¤Ÿåƒcargo subcommandæ–¹å¼è¿è¡Œï¼Œâ€˜cargo somethingâ€™ã€‚
cargo --list<br></p>
<h2 id="15-æ™ºèƒ½æŒ‡é’ˆ">15 æ™ºèƒ½æŒ‡é’ˆ <a href="#15-%e6%99%ba%e8%83%bd%e6%8c%87%e9%92%88" class="anchor">ğŸ”—</a></h2><p>é€šè¿‡structå®ç°ï¼ŒåŒ…å«æŒ‡é’ˆ+metaä¿¡æ¯ï¼Œstructä¹Ÿå®ç°<font color=blue><strong>Deref, Drop trait</strong></font>ã€‚ å¼•ç”¨ä»…ä»…åªæ˜¯å€Ÿç”¨æ•°æ®ã€‚æŒ‡é’ˆæŒ‡é’ˆå¯ä»¥ownæ•°æ®ã€‚<br>
<strong>String, Vec<T></strong>æ˜¯æ™ºèƒ½æŒ‡é’ˆã€‚<br></p>
<ul>
<li>Box<T> allocatie value of type T on heapï¼Œå•æ‰€æœ‰æƒ</li>
<li>Rc<T> enables multiple ownership å¤šæ‰€æœ‰æƒï¼Œ only immutable borrow</li>
<li>Ref<T>, RefMut<T>, RefCell<T>ï¼Œ å•æ‰€æœ‰æƒ  the borrowing rules at runtime</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> b <span style="color:#f92672">=</span> Box::new(<span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// implements the Deref trait, which allows Box&lt;T&gt; values to be treated like references
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>println!(<span style="color:#e6db74">&#34;b = {}&#34;</span>, b);
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;deref b = {}&#34;</span>,<span style="color:#f92672">*</span>b); <span style="color:#75715e">// *b == *(b.deref())  deref() è¿”å›çš„æ˜¯itemçš„å¼•ç”¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//å¿…é¡»ä½¿ç”¨Boxæ‰èƒ½å®šä¹‰è¿™äº›ç±»å‹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">List</span> {
</span></span><span style="display:flex;"><span>    Cons(<span style="color:#66d9ef">i32</span>, List), <span style="color:#75715e">// fail compileã€‚ (1, (2, (3, Nil)))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    Nil,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ä½¿ç”¨Boxå®šä¹‰å¸¦æœ‰é€’å½’çš„ç±»å‹ï¼ˆæœ‰ä¸€ä¸ªå­—æ®µçš„ç±»å‹å’Œè‡ªå·±æœ‰ç›¸åŒçš„ç±»å‹ï¼‰ã€‚ 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">List</span> {
</span></span><span style="display:flex;"><span>    Cons(<span style="color:#66d9ef">i32</span>, Box<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&gt;</span>),
</span></span><span style="display:flex;"><span>    Nil,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> list <span style="color:#f92672">=</span> Cons(<span style="color:#ae81ff">1</span>, Box::new(Cons(<span style="color:#ae81ff">2</span>, Box::new(Cons(<span style="color:#ae81ff">3</span>, Box::new(Nil))))));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//å› ä¸ºsmart pointerå®ç°Deref traitï¼Œå¯ä»¥compileråš dereference operator * è¿›è€Œä¸æ™®é€šå¼•ç”¨ä¸€æ ·ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// deref coercionï¼Œ &amp;String -&gt; &amp;str, 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">hello</span>(name: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) {
</span></span><span style="display:flex;"><span>    println(<span style="color:#e6db74">&#34;hello: {name}&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> m <span style="color:#f92672">=</span> Box::new(String::from(<span style="color:#e6db74">&#34;Yellow&#34;</span>));
</span></span><span style="display:flex;"><span><span style="color:#75715e">//&amp;Box&lt;String&gt; --Box impl Defref--&gt; &amp;String --String impl Defref--&gt; &amp;str --&gt; type matching.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// or manually, &amp;(*m)[..] 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>hello(<span style="color:#f92672">&amp;</span>m);
</span></span></code></pre></div><p>deref coercion<br></p>
<ul>
<li>from &amp;T to &amp;U when T: Deref&lt;Target=U&gt;</li>
<li>from &amp;mut T to &amp;mut U when T: DefrefMut&lt;Target=U&gt;</li>
<li>from &amp;mut T to &amp;U when T: Defref&lt;Target=U&gt;</li>
</ul>
<p>std::mem::dropåœ¨preludeé‡Œï¼Œ drop(x) å¯æå‰é‡Šæ”¾å†…å­˜ã€‚<br></p>
<p><strong><font color=blue>Rc<T> å¼•ç”¨è®¡æ•°çš„æ™ºèƒ½æŒ‡é’ˆ  </font></strong><br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> Cons(<span style="color:#ae81ff">5</span>, Box::new(Cons(<span style="color:#ae81ff">10</span>, Box::new(Nil))));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> b <span style="color:#f92672">=</span> Cons(<span style="color:#ae81ff">3</span>, Box::new(a)); <span style="color:#75715e">// Box::new() take ownership
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> c <span style="color:#f92672">=</span> Cons(<span style="color:#ae81ff">4</span>, Box::new(a)); <span style="color:#75715e">// failed, use of moved value: `a`
</span></span></span></code></pre></div><p>instead</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::rc::Rc; <span style="color:#75715e">//not in the prelude
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">List</span> {
</span></span><span style="display:flex;"><span>    Cons(<span style="color:#66d9ef">i32</span>, Rc<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&gt;</span>),
</span></span><span style="display:flex;"><span>    Nil,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> Rc::new(Cons(<span style="color:#ae81ff">5</span>, Rc::new(Cons(<span style="color:#ae81ff">10</span>, Rc::new(Nil)))));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> b <span style="color:#f92672">=</span> Cons(<span style="color:#ae81ff">3</span>, Rc::clone(<span style="color:#f92672">&amp;</span>a));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> c <span style="color:#f92672">=</span> Cons(<span style="color:#ae81ff">4</span>, Rc::clone(<span style="color:#f92672">&amp;</span>a));
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;after clone, rc count = {}&#34;</span>, Rc::strong_count(<span style="color:#f92672">&amp;</span>a));
</span></span><span style="display:flex;"><span><span style="color:#75715e">// immutable
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//Drop trait decreases the reference count on  Rc&lt;T&gt; value
</span></span></span></code></pre></div><p><strong>RefCell<T></strong> <br>
mutate data even when there are immutable references to that data, use <code>unsafe code</code> inside <br>
åœ¨ç¼–è¯‘æœŸé—´æ£€æŸ¥æ˜¯ä¿å®ˆçš„ï¼Œå¯èƒ½ä¼šrejectä¸€äº›æ­£ç¡®çš„ç¨‹åºã€‚RefCellç±»å‹çš„å˜é‡åœ¨runtimeæ—¶è¿›è¡Œå€Ÿç”¨æ£€æŸ¥ï¼Œå¤±è´¥ä¼španicã€‚<br>
<strong> interior mutability</strong>: an immutable type exposes an API for mutating an interior value.<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">List</span> {
</span></span><span style="display:flex;"><span>    Cons(Rc<span style="color:#f92672">&lt;</span>RefCell<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">i32</span><span style="color:#f92672">&gt;&gt;</span>, Rc<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&gt;</span>),
</span></span><span style="display:flex;"><span>    Nil,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> <span style="color:#66d9ef">crate</span>::List::{Cons, Nil};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::cell::RefCell;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::rc::Rc;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> value <span style="color:#f92672">=</span> Rc::new(RefCell::new(<span style="color:#ae81ff">5</span>));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> Rc::new(Cons(Rc::clone(<span style="color:#f92672">&amp;</span>value), Rc::new(Nil)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> b <span style="color:#f92672">=</span> Cons(Rc::new(RefCell::new(<span style="color:#ae81ff">3</span>)), Rc::clone(<span style="color:#f92672">&amp;</span>a));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> c <span style="color:#f92672">=</span> Cons(Rc::new(RefCell::new(<span style="color:#ae81ff">4</span>)), Rc::clone(<span style="color:#f92672">&amp;</span>a));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>value.borrow_mut() <span style="color:#f92672">+=</span> <span style="color:#ae81ff">10</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;a after = {:?}&#34;</span>, a);
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;b after = {:?}&#34;</span>, b);
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;c after = {:?}&#34;</span>, c);
</span></span><span style="display:flex;"><span><span style="color:#75715e">//  a after = Cons(RefCell { value: 15 }, Nil)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//  b after = Cons(RefCell { value: 3 }, Cons(RefCell { value: 15 }, Nil))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//  c after = Cons(RefCell { value: 4 }, Cons(RefCell { value: 15 }, Nil))
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>reference cycles -&gt; leak memory <br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> <span style="color:#66d9ef">crate</span>::List::{Cons, Nil};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::cell::RefCell;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::rc::Rc;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">List</span> {
</span></span><span style="display:flex;"><span>    Cons(<span style="color:#66d9ef">i32</span>, RefCell<span style="color:#f92672">&lt;</span>Rc<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&gt;&gt;</span>),
</span></span><span style="display:flex;"><span>    Nil,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> List {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">tail</span>(<span style="color:#f92672">&amp;</span>self) -&gt; Option<span style="color:#f92672">&lt;&amp;</span>RefCell<span style="color:#f92672">&lt;</span>Rc<span style="color:#f92672">&lt;</span>List<span style="color:#f92672">&gt;&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">match</span> self {
</span></span><span style="display:flex;"><span>            Cons(_, item) <span style="color:#f92672">=&gt;</span> Some(item),
</span></span><span style="display:flex;"><span>            Nil <span style="color:#f92672">=&gt;</span> None,
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> Rc::new(Cons(<span style="color:#ae81ff">5</span>, RefCell::new(Rc::new(Nil))));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;a initial rc count = {}&#34;</span>, Rc::strong_count(<span style="color:#f92672">&amp;</span>a));
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;a next item = {:?}&#34;</span>, a.tail());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> b <span style="color:#f92672">=</span> Rc::new(Cons(<span style="color:#ae81ff">10</span>, RefCell::new(Rc::clone(<span style="color:#f92672">&amp;</span>a))));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;a rc count after b creation = {}&#34;</span>, Rc::strong_count(<span style="color:#f92672">&amp;</span>a));
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;b initial rc count = {}&#34;</span>, Rc::strong_count(<span style="color:#f92672">&amp;</span>b));
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;b next item = {:?}&#34;</span>, b.tail());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> Some(link) <span style="color:#f92672">=</span> a.tail() {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">*</span>link.borrow_mut() <span style="color:#f92672">=</span> Rc::clone(<span style="color:#f92672">&amp;</span>b);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;b rc count after changing a = {}&#34;</span>, Rc::strong_count(<span style="color:#f92672">&amp;</span>b));
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;a rc count after changing a = {}&#34;</span>, Rc::strong_count(<span style="color:#f92672">&amp;</span>a));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Uncomment the next line to see that we have a cycle;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// it will overflow the stack
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// println!(&#34;a next item = {:?}&#34;, a.tail());
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><p>weak reference, Rc::downgrade, Weak<T></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::cell::RefCell;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::rc::Rc;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Node</span> { <span style="color:#75715e">// æ ‘ä¸ŠèŠ‚ç‚¹çš„æ•°æ®ç»“æ„
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    value: <span style="color:#66d9ef">i32</span>,
</span></span><span style="display:flex;"><span>    children: <span style="color:#a6e22e">RefCell</span><span style="color:#f92672">&lt;</span>Vec<span style="color:#f92672">&lt;</span>Rc<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> leaf <span style="color:#f92672">=</span> Rc::new(Node {
</span></span><span style="display:flex;"><span>        value: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>        children: <span style="color:#a6e22e">RefCell</span>::new(vec![]),
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> branch <span style="color:#f92672">=</span> Rc::new(Node {
</span></span><span style="display:flex;"><span>        value: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>        children: <span style="color:#a6e22e">RefCell</span>::new(vec![Rc::clone(<span style="color:#f92672">&amp;</span>leaf)]),
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::cell::RefCell;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::rc::{Rc, Weak};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Node</span> {
</span></span><span style="display:flex;"><span>    value: <span style="color:#66d9ef">i32</span>,
</span></span><span style="display:flex;"><span>    parent: <span style="color:#a6e22e">RefCell</span><span style="color:#f92672">&lt;</span>Weak<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>    children: <span style="color:#a6e22e">RefCell</span><span style="color:#f92672">&lt;</span>Vec<span style="color:#f92672">&lt;</span>Rc<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::cell::RefCell;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::rc::{Rc, Weak};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Node</span> {
</span></span><span style="display:flex;"><span>    value: <span style="color:#66d9ef">i32</span>,
</span></span><span style="display:flex;"><span>    parent: <span style="color:#a6e22e">RefCell</span><span style="color:#f92672">&lt;</span>Weak<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>    children: <span style="color:#a6e22e">RefCell</span><span style="color:#f92672">&lt;</span>Vec<span style="color:#f92672">&lt;</span>Rc<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> leaf <span style="color:#f92672">=</span> Rc::new(Node {
</span></span><span style="display:flex;"><span>        value: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>        parent: <span style="color:#a6e22e">RefCell</span>::new(Weak::new()),
</span></span><span style="display:flex;"><span>        children: <span style="color:#a6e22e">RefCell</span>::new(vec![]),
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// leaf parent = None
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    println!(<span style="color:#e6db74">&#34;leaf parent = {:?}&#34;</span>, leaf.parent.borrow().upgrade());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> branch <span style="color:#f92672">=</span> Rc::new(Node {
</span></span><span style="display:flex;"><span>        value: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>        parent: <span style="color:#a6e22e">RefCell</span>::new(Weak::new()),
</span></span><span style="display:flex;"><span>        children: <span style="color:#a6e22e">RefCell</span>::new(vec![Rc::clone(<span style="color:#f92672">&amp;</span>leaf)]),
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>leaf.parent.borrow_mut() <span style="color:#f92672">=</span> Rc::downgrade(<span style="color:#f92672">&amp;</span>branch);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//leaf parent = Some(Node { value: 5, parent: RefCell { value: (Weak) },
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//children: RefCell { value: [Node { value: 3, parent: RefCell { value: (Weak) },
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">//children: RefCell { value: [] } }] } })
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;leaf parent = {:?}&#34;</span>, leaf.parent.borrow().upgrade());
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::cell::RefCell;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::rc::{Rc, Weak};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Node</span> {
</span></span><span style="display:flex;"><span>    value: <span style="color:#66d9ef">i32</span>,
</span></span><span style="display:flex;"><span>    parent: <span style="color:#a6e22e">RefCell</span><span style="color:#f92672">&lt;</span>Weak<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>    children: <span style="color:#a6e22e">RefCell</span><span style="color:#f92672">&lt;</span>Vec<span style="color:#f92672">&lt;</span>Rc<span style="color:#f92672">&lt;</span>Node<span style="color:#f92672">&gt;&gt;&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> leaf <span style="color:#f92672">=</span> Rc::new(Node {
</span></span><span style="display:flex;"><span>        value: <span style="color:#ae81ff">3</span>,
</span></span><span style="display:flex;"><span>        parent: <span style="color:#a6e22e">RefCell</span>::new(Weak::new()),
</span></span><span style="display:flex;"><span>        children: <span style="color:#a6e22e">RefCell</span>::new(vec![]),
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    println!(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;leaf strong = {}, weak = {}&#34;</span>,
</span></span><span style="display:flex;"><span>        Rc::strong_count(<span style="color:#f92672">&amp;</span>leaf),
</span></span><span style="display:flex;"><span>        Rc::weak_count(<span style="color:#f92672">&amp;</span>leaf),
</span></span><span style="display:flex;"><span>    ); <span style="color:#75715e">//leaf strong = 1, weak = 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> branch <span style="color:#f92672">=</span> Rc::new(Node {
</span></span><span style="display:flex;"><span>            value: <span style="color:#ae81ff">5</span>,
</span></span><span style="display:flex;"><span>            parent: <span style="color:#a6e22e">RefCell</span>::new(Weak::new()),
</span></span><span style="display:flex;"><span>            children: <span style="color:#a6e22e">RefCell</span>::new(vec![Rc::clone(<span style="color:#f92672">&amp;</span>leaf)]),
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">*</span>leaf.parent.borrow_mut() <span style="color:#f92672">=</span> Rc::downgrade(<span style="color:#f92672">&amp;</span>branch);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        println!(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;branch strong = {}, weak = {}&#34;</span>,
</span></span><span style="display:flex;"><span>            Rc::strong_count(<span style="color:#f92672">&amp;</span>branch),
</span></span><span style="display:flex;"><span>            Rc::weak_count(<span style="color:#f92672">&amp;</span>branch),
</span></span><span style="display:flex;"><span>        ); <span style="color:#75715e">//branch strong = 1, weak = 1
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        println!(
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#34;leaf strong = {}, weak = {}&#34;</span>,
</span></span><span style="display:flex;"><span>            Rc::strong_count(<span style="color:#f92672">&amp;</span>leaf),
</span></span><span style="display:flex;"><span>            Rc::weak_count(<span style="color:#f92672">&amp;</span>leaf),
</span></span><span style="display:flex;"><span>        ); <span style="color:#75715e">// leaf strong = 2, weak = 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//leaf parent = None
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    println!(<span style="color:#e6db74">&#34;leaf parent = {:?}&#34;</span>, leaf.parent.borrow().upgrade());
</span></span><span style="display:flex;"><span>    println!(
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;leaf strong = {}, weak = {}&#34;</span>,
</span></span><span style="display:flex;"><span>        Rc::strong_count(<span style="color:#f92672">&amp;</span>leaf),
</span></span><span style="display:flex;"><span>        Rc::weak_count(<span style="color:#f92672">&amp;</span>leaf),
</span></span><span style="display:flex;"><span>    ); <span style="color:#75715e">//leaf strong = 1, weak = 0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h2 id="16-å¹¶å‘">16 å¹¶å‘ <a href="#16-%e5%b9%b6%e5%8f%91" class="anchor">ğŸ”—</a></h2><p>æ— ç•å¹¶å‘ï¼š å¹¶å‘é—®é¢˜åœ¨ç¼–è¯‘æœŸé—´æš´éœ²ï¼Œè€Œä¸ºè¿è¡Œæ—¶å‡ºç°åå†å»èŠ±æ—¶é—´å»å¤ç°ï¼Œå› æ­¤è®©ç”¨æˆ·æ— ç•æƒ§å¹¶å‘ã€‚<br></p>
<h3 id="åˆ›å»ºçº¿ç¨‹">åˆ›å»ºçº¿ç¨‹ <a href="#%e5%88%9b%e5%bb%ba%e7%ba%bf%e7%a8%8b" class="anchor">ğŸ”—</a></h3><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::thread;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::time::Duration;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    thread::spawn(<span style="color:#f92672">||</span>{
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;i am a thread&#34;</span>);
</span></span><span style="display:flex;"><span>        thread::sleep(Duration::from_millis(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>     thread::sleep(Duration::from_millis(<span style="color:#ae81ff">2</span>));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::thread;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::time::Duration;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> v <span style="color:#f92672">=</span> vec![<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> handle <span style="color:#f92672">=</span> thread::spawn(<span style="color:#66d9ef">move</span> <span style="color:#f92672">||</span> {
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;Here&#39;s a vector: {:?}&#34;</span>, v);
</span></span><span style="display:flex;"><span>    });
</span></span><span style="display:flex;"><span>    handle.join().unwrap();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="çº¿ç¨‹é—´çš„é€šä¿¡message-passing-concurrencyvia-channel">çº¿ç¨‹é—´çš„é€šä¿¡ï¼Œmessage-passing concurrency,via channel <a href="#%e7%ba%bf%e7%a8%8b%e9%97%b4%e7%9a%84%e9%80%9a%e4%bf%a1message-passing-concurrencyvia-channel" class="anchor">ğŸ”—</a></h3><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>     <span style="color:#66d9ef">use</span> std::{
</span></span><span style="display:flex;"><span>        sync::mpsc::{self, Sender},
</span></span><span style="display:flex;"><span>        thread,
</span></span><span style="display:flex;"><span>        time::Duration,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">test_channel</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> (tx, rx) <span style="color:#f92672">=</span> mpsc::channel();
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// let tx1 = tx.clone();
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">let</span> tx1 <span style="color:#f92672">=</span> Sender::clone(<span style="color:#f92672">&amp;</span>tx);
</span></span><span style="display:flex;"><span>        thread::spawn(<span style="color:#66d9ef">move</span> <span style="color:#f92672">||</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> vals <span style="color:#f92672">=</span> vec![
</span></span><span style="display:flex;"><span>                String::from(<span style="color:#e6db74">&#34;hi&#34;</span>),
</span></span><span style="display:flex;"><span>                String::from(<span style="color:#e6db74">&#34;from&#34;</span>),
</span></span><span style="display:flex;"><span>                String::from(<span style="color:#e6db74">&#34;the&#34;</span>),
</span></span><span style="display:flex;"><span>                String::from(<span style="color:#e6db74">&#34;thread&#34;</span>),
</span></span><span style="display:flex;"><span>            ];
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> val <span style="color:#66d9ef">in</span> vals {
</span></span><span style="display:flex;"><span>                tx1.send(val).unwrap();
</span></span><span style="display:flex;"><span>                thread::sleep(Duration::from_secs(<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        thread::spawn(<span style="color:#66d9ef">move</span> <span style="color:#f92672">||</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> vals <span style="color:#f92672">=</span> vec![
</span></span><span style="display:flex;"><span>                String::from(<span style="color:#e6db74">&#34;more&#34;</span>),
</span></span><span style="display:flex;"><span>                String::from(<span style="color:#e6db74">&#34;messages&#34;</span>),
</span></span><span style="display:flex;"><span>                String::from(<span style="color:#e6db74">&#34;for&#34;</span>),
</span></span><span style="display:flex;"><span>                String::from(<span style="color:#e6db74">&#34;you&#34;</span>),
</span></span><span style="display:flex;"><span>            ];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> val <span style="color:#66d9ef">in</span> vals {
</span></span><span style="display:flex;"><span>                tx.send(val).unwrap();
</span></span><span style="display:flex;"><span>                thread::sleep(Duration::from_secs(<span style="color:#ae81ff">1</span>));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> received <span style="color:#66d9ef">in</span> rx {
</span></span><span style="display:flex;"><span>            println!(<span style="color:#e6db74">&#34;got: {}&#34;</span>, received);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="çº¿ç¨‹é—´å…±äº«å†…å­˜å…±äº«çŠ¶æ€-shared-state-concurrency">çº¿ç¨‹é—´å…±äº«å†…å­˜ï¼ˆå…±äº«çŠ¶æ€ï¼‰ï¼Œ shared-state concurrency <a href="#%e7%ba%bf%e7%a8%8b%e9%97%b4%e5%85%b1%e4%ba%ab%e5%86%85%e5%ad%98%e5%85%b1%e4%ba%ab%e7%8a%b6%e6%80%81-shared-state-concurrency" class="anchor">ğŸ”—</a></h3><p>å·²ç»å¯ä»¥é€šè¿‡channelæ¥é€šä¿¡ï¼Œå¦å¤–ä¸€ç§æ–¹å¼æ˜¯é€šè¿‡å…±äº«å†…å­˜æ¥é€šä¿¡ã€‚<br>
channelçš„æ–¹å¼ç±»ä¼¼äºå•ä¸€æ‰€æœ‰æƒï¼Œæ•°æ®è¢«å‘é€ç»™channelåï¼Œæ‰€æœ‰æƒå°±è½¬ç§»åˆ°channelä¸Š<br>
å…±äº«å†…å­˜çš„æ–¹å¼ç±»ä¼¼å¤šä¸ªæ‰€æœ‰æƒï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®ã€‚<br></p>
<p><strong>Mutex<T>æ§åˆ¶å•ä¸€è®¿é—®å…±äº«çš„å†…å­˜</strong><br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#66d9ef">use</span> std::sync::Mutex;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> m <span style="color:#f92672">=</span> Mutex::new(<span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> num <span style="color:#f92672">=</span> m.lock().unwrap();
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">*</span>num <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;m = {:?}&#34;</span>, m); <span style="color:#75715e">//m = Mutex { data: 6, poisoned: false, .. }
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::sync::{Mutex, Arc};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::sync::thread;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> counter <span style="color:#f92672">=</span> Arc::new(Mutex::new(<span style="color:#ae81ff">0</span>));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> handles <span style="color:#f92672">=</span> vec![];
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> _ <span style="color:#66d9ef">in</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">..</span><span style="color:#ae81ff">10</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> counter <span style="color:#f92672">=</span> Arc::clone(<span style="color:#f92672">&amp;</span>counter);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> handle <span style="color:#f92672">=</span> thread::spawn(<span style="color:#f92672">||</span>{
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> num <span style="color:#f92672">=</span> counter.lock().unwrap(); <span style="color:#75715e">//Mutex&lt;T&gt; provides interior mutability
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>            <span style="color:#f92672">*</span>num <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        })
</span></span><span style="display:flex;"><span>        handles.push(handle);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> handle <span style="color:#66d9ef">in</span> handles {
</span></span><span style="display:flex;"><span>        handle.join().unwrap();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;counter:{}&#34;</span>, <span style="color:#f92672">*</span>counter.lock().unwrap());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><a href="https://doc.rust-lang.org/stable/std/sync/atomic/index.html" target="_blank" rel="noopener">std::sync::atomic</a> <br></p>
<h3 id="sync-send-trait">Sync, Send trait <a href="#sync-send-trait" class="anchor">ğŸ”—</a></h3><p>std::marker::Send trait<br> å®ç°äº†Sendçš„ç±»å‹çš„å€¼çš„æ‰€æœ‰æƒå¯ä»¥åœ¨çº¿ç¨‹ä¸­è½¬ç§»ã€‚
å¤§å¤šrustä¸­çš„ç±»å‹éƒ½æ˜¯Sendçš„ï¼Œä¹Ÿæœ‰ä¾‹å¤–ï¼ŒRc<T></p>
<p>std::marker::Sync <br></p>
<p>æ ‡å‡†åº“ä¸­æä¾›çš„ç±»å‹ã€‚</p>
<p>æŠŠrustcå¯¹å¹¶å‘å®‰å…¨çš„ä¿è¯æ‰©å±•åˆ°ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»å‹ä¸Šã€‚</p>
<h2 id="17-ruståœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸Šçš„ç‰¹ç‚¹">17 ruståœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸Šçš„ç‰¹ç‚¹ <a href="#17-rust%e5%9c%a8%e9%9d%a2%e5%90%91%e5%af%b9%e8%b1%a1%e7%bc%96%e7%a8%8b%e4%b8%8a%e7%9a%84%e7%89%b9%e7%82%b9" class="anchor">ğŸ”—</a></h2><h2 id="18-æ¨¡å¼å’ŒåŒ¹é…-patterns-and-matching">18 æ¨¡å¼å’ŒåŒ¹é… patterns and matching <a href="#18-%e6%a8%a1%e5%bc%8f%e5%92%8c%e5%8c%b9%e9%85%8d-patterns-and-matching" class="anchor">ğŸ”—</a></h2><h2 id="19-advance-features">19 advance features <a href="#19-advance-features" class="anchor">ğŸ”—</a></h2><ul>
<li>Unsafe Rust: static analysis is conservative.</li>
<li>Advanced traits:</li>
<li>Advanced types</li>
<li>Advanced functions and closures: function pointers and returning closures</li>
<li>Macros:</li>
</ul>
<h3 id="unsafe-rust">unsafe rust <a href="#unsafe-rust" class="anchor">ğŸ”—</a></h3><ul>
<li>è§£å¼•ç”¨è£¸æŒ‡é’ˆ *const T and *mut T</li>
<li>è°ƒç”¨ä¸å®‰å…¨çš„æ–¹æ³•</li>
<li>todo</li>
</ul>
<h3 id="advance-trait">advance trait <a href="#advance-trait" class="anchor">ğŸ”—</a></h3><p>traitæ˜¯ç”¨åˆ°å®šä¹‰å…±äº«çš„è¡Œä¸ºçš„ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">#![allow(unused)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">trait</span> Add<span style="color:#f92672">&lt;</span>Rhs<span style="color:#f92672">=</span>Self<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Output</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">add</span>(self, rhs: <span style="color:#a6e22e">Rhs</span>) -&gt; <span style="color:#a6e22e">Self</span>::Output;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="advance-type">advance type <a href="#advance-type" class="anchor">ğŸ”—</a></h3><p>ç±»å‹ç³»ç»Ÿæœ‰ä¸¤ä¸ªåŸºæœ¬çš„ä¿éšœï¼š éœ€è¦çŸ¥é“ä¸€ä¸ªç±»å‹çš„æ‰€æœ‰å€¼å å¤šå°‘ç©ºé—´ã€‚ä¸€ä¸ªç±»å‹ä¸‹çš„æ‰€æœ‰å€¼å ç”¨ç›¸åŒçš„ç©ºé—´ã€‚<br>
strï¼Œ dyn trait, slice éƒ½æ˜¯DSTã€‚ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™ç§ç±»å‹ã€‚å¦‚æœå…è®¸ï¼Œlet s1 str = &quot;aa&quot;; let s2 str = &quot;bbb&quot;;
é‚£ä¹ˆstrç±»å‹ä¸‹çš„s1å’Œs2å ä¸åŒçš„ç©ºé—´ï¼Œè¿èƒŒç±»å‹ç³»ç»Ÿçš„ä¿éšœã€‚æ‰€æœ‰DSTç±»å‹åœ¨è¯­è¨€ä¸­éƒ½æ˜¯ä»¥å¼•ç”¨çš„å½¢å¼ï¼ˆæ™ºèƒ½æŒ‡é’ˆï¼‰å‡ºç°ã€‚
&amp;str -&gt; the address of the str and its length. <br></p>
<p>str -&gt; &amp;str, Box<str>, Rc<str>
trait -&gt; &amp;dyn Trait, Box<dyn Trait>, Rc<dyn Trait></p>
<h3 id="macros">Macros <a href="#macros" class="anchor">ğŸ”—</a></h3><h2 id="20-project-web-server">20 project: web server <a href="#20-project-web-server" class="anchor">ğŸ”—</a></h2><p>thread, Arc, Mutex, channel...</p>
<h2 id="å…¶ä»–é™„å½•">å…¶ä»–é™„å½• <a href="#%e5%85%b6%e4%bb%96%e9%99%84%e5%bd%95" class="anchor">ğŸ”—</a></h2><h3 id="æºç ç»“æ„">æºç ç»“æ„ <a href="#%e6%ba%90%e7%a0%81%e7%bb%93%e6%9e%84" class="anchor">ğŸ”—</a></h3><p><p class="markdown-image">
  <img src="rust.svg" alt="image"  />
</p></p>
<h2 id="é¡¹ç›®ç»„ç»‡">é¡¹ç›®ç»„ç»‡ <a href="#%e9%a1%b9%e7%9b%ae%e7%bb%84%e7%bb%87" class="anchor">ğŸ”—</a></h2><h3 id="å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–crate">å¼•å…¥ç¬¬ä¸‰æ–¹ä¾èµ–crate <a href="#%e5%bc%95%e5%85%a5%e7%ac%ac%e4%b8%89%e6%96%b9%e4%be%9d%e8%b5%96crate" class="anchor">ğŸ”—</a></h3><p>ä¾‹å¦‚åœ¨tomlæ–‡ä»¶ä¸­å¼•å…¥rand crateåï¼Œcargo buildçš„è¾“å‡ºï¼ŒCargo.lockçš„å†…å®¹ã€‚</p>
<h3 id="module">module <a href="#module" class="anchor">ğŸ”—</a></h3><p>packageï¼Œ crateï¼Œ moduleã€‚</p>
<p>æ¨¡å—æœºåˆ¶: rustçš„modå³æ˜¯å‘½åç©ºé—´ã€‚</p>
<p>use æ˜¯optionalï¼Œå¯ä»¥ä½¿ç”¨full path æ›¿æ¢ï¼Œä¸æ˜¯å¿…é¡»ä½¿ç”¨çš„ã€‚</p>
<p>useä½œç”¨ï¼šå°†å…¶ä»–moduleçš„itemå¯¼å…¥åˆ°current namespaceï¼Œæ–¹ä¾¿è®¿é—®ã€‚
ä¸å¸¦{}çš„modä½œç”¨ï¼šå°†moduleçš„å†…å®¹æ’å…¥åˆ°å½“å‰fileä¸­ã€‚</p>
<p>å£°æ˜ï¼šmod ä¸ pub mod</p>
<p>å¼•å…¥ï¼šuse ä¸ pub use</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">crate</span> rand;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">use</span> rand::Rng; <span style="color:#75715e">// in order to use gen_range method in trait `Rng`.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// gen_range is a method in Rng trait.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// the basic idea is this: methods are defined on something called `trait`, 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// and for the method to work, it needs the trait to be in scope.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> guess <span style="color:#f92672">=</span> rand::thread_rng().gen_range(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">101</span>);
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;guess={}&#34;</span>, guess);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="å·¥ä½œç©ºé—´-rust-workspace">å·¥ä½œç©ºé—´ rust workspace <a href="#%e5%b7%a5%e4%bd%9c%e7%a9%ba%e9%97%b4-rust-workspace" class="anchor">ğŸ”—</a></h3><p><p class="markdown-image">
  <img src="mod_crate_workspace.svg" alt="image"  />
</p></p>
<hr>
<h2 id="æ•°æ®">æ•°æ® <a href="#%e6%95%b0%e6%8d%ae" class="anchor">ğŸ”—</a></h2><h3 id="å †å’Œæ ˆ">å †å’Œæ ˆ <a href="#%e5%a0%86%e5%92%8c%e6%a0%88" class="anchor">ğŸ”—</a></h3><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> s <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello&#34;</span>.to_string();
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;addr={:p}&#34;</span>, <span style="color:#f92672">&amp;</span>s);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// è¾“å‡ºçš„åœ°å€æ˜¯ æ ˆä¸­s = ptr|len|capè¿™ä¸ªç»“æ„ä½“çš„åœ°å€ï¼Œè¿˜æ˜¯pträ¸­å †ä¸Šçš„åœ°å€ï¼Ÿ
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello&#34;</span>; <span style="color:#75715e">// a is fatten pointer
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> b <span style="color:#f92672">=</span> a; <span style="color:#75715e">// copy trait, b is also a fatten pointer 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>println!(<span style="color:#e6db74">&#34;&amp;a={:p}, &amp;b={:p}&#34;</span>, <span style="color:#f92672">&amp;</span>a, <span style="color:#f92672">&amp;</span>b);  <span style="color:#75715e">// different addr on stack 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>println!(<span style="color:#e6db74">&#34;*a={:p}, *b={:p}&#34;</span>, <span style="color:#f92672">&amp;*</span>a, <span style="color:#f92672">&amp;*</span>b); <span style="color:#75715e">// same addr which is on BSS segment
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">static</span> Data_Seg: <span style="color:#66d9ef">u32</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">foo</span> () {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> hello <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello&#34;</span>.to_string();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> data <span style="color:#f92672">=</span> Box::new(<span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;RODATA = {:p}&#34;</span>, <span style="color:#e6db74">&#34;hello world&#34;</span>);
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;Data static var = {:p}&#34;</span>, <span style="color:#f92672">&amp;</span>Data_seg);
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;Text seg = {:p}&#34;</span>, foo <span style="color:#66d9ef">as</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> ());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Stringçš„ç»“æ„ä½“åˆ†é…åœ¨æ ˆä¸Šï¼Œå…¶å¼•ç”¨æŒ‡å‘æ ˆåœ°å€
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    println!(<span style="color:#e6db74">&#34;STACK (&amp;hello) = {:p}&#34;</span>, <span style="color:#f92672">&amp;</span>hello);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// helloæŒæœ‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// é€šè¿‡è§£å¼•ç”¨è·å–å †ä¸Šæ•°æ®ï¼Œç„¶åå–å…¶å¼•ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    println!(<span style="color:#e6db74">&#34;HEAP (&amp;*hello) = {:p}&#34;</span>, <span style="color:#f92672">&amp;*</span>hello);
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Boxå®ç°äº†Pointer traitï¼Œ æ— éœ€é¢å¤–çš„è§£å¼•ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    println!(<span style="color:#e6db74">&#34;HEAP box impl pointer, {:p}, {:p}&#34;</span>, data, <span style="color:#f92672">&amp;*</span>data);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç† <a href="#%e9%94%99%e8%af%af%e5%a4%84%e7%90%86" class="anchor">ğŸ”—</a></h3><p>æŠŠé”™è¯¯å°è£…åœ¨Result&lt;T, E&gt;ä¸­ã€‚
é”™è¯¯ä¼ æ’­ ï¼Ÿã€‚
unwrap()æ–¹æ³•åªå…³å¿ƒæˆåŠŸçš„è¿”å›ç»“æœTï¼Œè‹¥å‡ºé”™ï¼Œæ•´ä¸ªç¨‹åºç»ˆæ­¢ã€‚</p>
<h3 id="è¿­ä»£å™¨-1">è¿­ä»£å™¨ <a href="#%e8%bf%ad%e4%bb%a3%e5%99%a8-1" class="anchor">ğŸ”—</a></h3><p>forå¾ªç¯å¯ä»¥ç”¨äºä»»ä½•å®ç°äº†IntoIterator traitçš„æ•°æ®ç»“æ„ã€‚</p>
<h2 id="ä»£ç ">ä»£ç  <a href="#%e4%bb%a3%e7%a0%81" class="anchor">ğŸ”—</a></h2><h3 id="å‡½æ•°ä¸é—­åŒ…">å‡½æ•°ä¸é—­åŒ… <a href="#%e5%87%bd%e6%95%b0%e4%b8%8e%e9%97%ad%e5%8c%85" class="anchor">ğŸ”—</a></h3><h3 id="æ¥å£ä¸è™šè¡¨">æ¥å£ä¸è™šè¡¨ <a href="#%e6%8e%a5%e5%8f%a3%e4%b8%8e%e8%99%9a%e8%a1%a8" class="anchor">ğŸ”—</a></h3><p>è™šè¡¨æ˜¯æ¯ä¸ªtraitæœ‰ä¸€ä»½ï¼Œè¿˜æ˜¯æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä»½ï¼Œè¿˜æ˜¯æ¯ä¸ªèƒ–æŒ‡é’ˆæœ‰ä¸€ä»½ï¼Ÿ</p>
<p>godbolt.org</p>
<p>impl TraitA for TypeB {}ã€‚ è™šè¡¨æ˜¯æ¯ä¸ª&lt;Trait, Type&gt;æœ‰ä¸€ä»½ï¼Œåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆå¥½åœ¨äºŒè¿›åˆ¶æ–‡ä»¶é‡Œã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hello&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;byebye&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> traitObj1: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">dyn</span> Display <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>s1;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> traitObj2: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">dyn</span> Debug <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>s1;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> traitObj3: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">dyn</span> Display <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>s2;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> traitObj4: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">dyn</span> Debug <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>s2;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> (addr1, vtable1) <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsafe</span>{ transmute::<span style="color:#f92672">&lt;</span>_, (<span style="color:#66d9ef">usize</span>, <span style="color:#66d9ef">usize</span>)<span style="color:#f92672">&gt;</span>(traitObj1 <span style="color:#66d9ef">as</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">dyn</span> Display) };
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> (addr2, vtable2) <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsafe</span>{ transmute::<span style="color:#f92672">&lt;</span>_, (<span style="color:#66d9ef">usize</span>, <span style="color:#66d9ef">usize</span>)<span style="color:#f92672">&gt;</span>(traitObj2 <span style="color:#66d9ef">as</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">dyn</span> Debug) };
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> (addr3, vtable3) <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsafe</span>{ transmute::<span style="color:#f92672">&lt;</span>_, (<span style="color:#66d9ef">usize</span>, <span style="color:#66d9ef">usize</span>)<span style="color:#f92672">&gt;</span>(traitObj3 <span style="color:#66d9ef">as</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">dyn</span> Display) };
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> (addr4, vtable4) <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsafe</span>{ transmute::<span style="color:#f92672">&lt;</span>_, (<span style="color:#66d9ef">usize</span>, <span style="color:#66d9ef">usize</span>)<span style="color:#f92672">&gt;</span>(traitObj4 <span style="color:#66d9ef">as</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">dyn</span> Debug) };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;s1:{:p}, s2: {:p}, main(): {:p}&#34;</span>, <span style="color:#f92672">&amp;</span>s1, <span style="color:#f92672">&amp;</span>s2, main <span style="color:#66d9ef">as</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;addr1: 0x{:x}, vtable1: 0x{:x}&#34;</span>, addr1, vtable1);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>assert_eq!(addr1, addr2);
</span></span><span style="display:flex;"><span>assert_eq!(addr3, addr4);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// String + Display
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>assert_eq!(vtable1, vtable3);
</span></span><span style="display:flex;"><span><span style="color:#75715e">// String + Debug
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>assert_eq!(vtable2, vtable4);
</span></span></code></pre></div><h3 id="å®">å® <a href="#%e5%ae%8f" class="anchor">ğŸ”—</a></h3><ul>
<li>å£°æ˜å®</li>
<li>è¿‡ç¨‹å®ï¼ˆå‡½æ•°å® æ´¾ç”Ÿå® å±æ€§å®ï¼‰</li>
</ul>
<h1 id="expression--statement">expression ğŸ†š statement <a href="#expression--statement" class="anchor">ğŸ”—</a></h1><p>ruståªæœ‰ä¸¤ç§è¯­å¥ï¼ˆæ— è¿”å›å€¼ï¼‰ï¼Œå…¶ä»–çš„å‡æ˜¯è¡¨è¾¾å¼ï¼ˆæœ‰è¿”å›å€¼ï¼‰ã€‚
ä¸€ç§è¯­å¥æ˜¯è¡¨è¾¾å¼è¯­å¥ã€‚åœ¨è¡¨è¾¾å¼ååŠ ï¼›ã€‚ä¸€ç§è¯­å¥æ˜¯å£°æ˜å¼è¯­å¥ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> x <span style="color:#f92672">=</span> (ley y <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>); <span style="color:#75715e">//error
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> y <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// y = 6 is expression, return ().
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> x <span style="color:#f92672">=</span> ( y <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span>); <span style="color:#75715e">// x has the value `()`, not 6
</span></span></span></code></pre></div><hr>
<ul>
<li>æ‰€æœ‰æƒä¸å€Ÿç”¨ï¼Œ ç”Ÿå‘½å‘¨æœŸ</li>
<li>ownership, borrowing</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hallo&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> s1;
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;{},{}&#34;</span>, s1, s2); <span style="color:#75715e">// error[E0382]: borrow of moved value: `s1`.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hallo&#34;</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> s1.clone();  <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println!(<span style="color:#e6db74">&#34;{}, {}&#34;</span>, s1, s2);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>       <span style="color:#75715e">//reference
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       <span style="color:#66d9ef">let</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hallo&#34;</span>); <span style="color:#75715e">// s1 is the owner of data &#39;hallo&#39;.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>s1;  <span style="color:#75715e">// s2 is a reference which points to the same data.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       println!(<span style="color:#e6db74">&#34;s1={}, s2={}&#34;</span>, s1, s2);
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">let</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hallo&#34;</span>);
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>s1; 
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">let</span> s3 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>s2; <span style="color:#75715e">// two readonly reference of &#39;hallo&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       println!(<span style="color:#e6db74">&#34;s1={}, s2={}&#34;</span>, s1, s2);
</span></span><span style="display:flex;"><span>       println!(<span style="color:#e6db74">&#34;s3={}, len={}&#34;</span>, s3, s3.len());
</span></span><span style="display:flex;"><span>   }
</span></span><span style="display:flex;"><span>   {
</span></span><span style="display:flex;"><span>       <span style="color:#75715e">//change string
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hello&#34;</span>); <span style="color:#75715e">// mutable borrow
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> s1;  <span style="color:#75715e">// mutable borrow occurs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       s2.push(<span style="color:#e6db74">&#39;~&#39;</span>);
</span></span><span style="display:flex;"><span>       println!(<span style="color:#e6db74">&#34;s2 = {}&#34;</span>, s2);  <span style="color:#75715e">// s2 = hello~
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       <span style="color:#75715e">// can only use the original when the borrowed item is dropped.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       <span style="color:#75715e">// s2 is dropped, so s1 can use.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       println!(<span style="color:#e6db74">&#34;s1 = {}&#34;</span>, s1);  <span style="color:#75715e">// s1 = hello~  
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   }
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hello&#34;</span>); <span style="color:#75715e">// mutable borrow
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> s1;  <span style="color:#75715e">// mutable borrow occurs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       s2.push(<span style="color:#e6db74">&#39;~&#39;</span>);
</span></span><span style="display:flex;"><span>       println!(<span style="color:#e6db74">&#34;s2 = {}&#34;</span>, s2); 
</span></span><span style="display:flex;"><span>       println!(<span style="color:#e6db74">&#34;s1 = {}&#34;</span>, s1); <span style="color:#75715e">// not compile!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       s2.push(<span style="color:#e6db74">&#39;~&#39;</span>) 
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>       <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> s1 <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;hello&#34;</span>); <span style="color:#75715e">// mutable borrow
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       <span style="color:#66d9ef">let</span> s2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> s1;  <span style="color:#75715e">// mutable borrow occurs
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       s2.push(<span style="color:#e6db74">&#39;~&#39;</span>);
</span></span><span style="display:flex;"><span>       println!(<span style="color:#e6db74">&#34;s1 = {}&#34;</span>, s1); <span style="color:#75715e">// not compile!
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>       println!(<span style="color:#e6db74">&#34;s2 = {}&#34;</span>, s2); 
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> words <span style="color:#f92672">=</span> vec![String::from(<span style="color:#e6db74">&#34;hallo&#34;</span>), String::from(<span style="color:#e6db74">&#34;espaÃ±ol&#34;</span>), String::from(<span style="color:#e6db74">&#34;brett&#34;</span>)];
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;{:?}&#34;</span>, words);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> t <span style="color:#f92672">=</span> words[<span style="color:#ae81ff">1</span>].clone();
</span></span><span style="display:flex;"><span>        words[<span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> words[<span style="color:#ae81ff">2</span>].clone();
</span></span><span style="display:flex;"><span>        words[<span style="color:#ae81ff">2</span>] <span style="color:#f92672">=</span> t;
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;{:?}&#34;</span>, words);
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// can&#39;t take two mutable loans from one vector,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#75715e">// just cast them to raw pointers to do the swap.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        words.swap(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>); <span style="color:#75715e">// built-in swap function.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println!(<span style="color:#e6db74">&#34;{:?}&#34;</span>, words);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    std::mem::swap(..) // use unsafe
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    pub fn swap(&amp;mut self, a: usize, b: usize) {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        unsafe {
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            let pa: *mut T = &amp;mut self[a];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            let pb: *mut T = &amp;mut self[b];
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            ptr::swap(pa, pb);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    */</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="æ™ºèƒ½æŒ‡é’ˆ">æ™ºèƒ½æŒ‡é’ˆ <a href="#%e6%99%ba%e8%83%bd%e6%8c%87%e9%92%88" class="anchor">ğŸ”—</a></h3><p>Deref trait,</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> Deref {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Target</span>: <span style="color:#f92672">?</span>Sized;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">deref</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Self</span>::Target;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Drop trait</p>
<h3 id="åŠ¨æ€åˆ†æ´¾é™æ€åˆ†æ´¾">åŠ¨æ€åˆ†æ´¾ï¼Œé™æ€åˆ†æ´¾ <a href="#%e5%8a%a8%e6%80%81%e5%88%86%e6%b4%be%e9%9d%99%e6%80%81%e5%88%86%e6%b4%be" class="anchor">ğŸ”—</a></h3><p>é™æ€åˆ†æ´¾ï¼š é æ³›å‹çš„å•æ€åŒ–å®ç°ï¼Œç¼–è¯‘æ—¶ç¡®å®šå‡½æ•°è°ƒç”¨ã€‚ calleeç¡®å®šï¼Œå¯ä»¥inlineã€‚
åŠ¨æ€åˆ†æ´¾ï¼šé trait objectå®ç°ï¼Œè¿è¡Œæ—¶ç¡®å®šå‡½æ•°è°ƒç”¨ã€‚</p>
<p>traitç±»å‹æ˜¯DSTç±»å‹ï¼Œ åœ¨ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šsizeã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">trait</span> Fly {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">fly</span>(<span style="color:#f92672">&amp;</span>self);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Flyæ˜¯traitç±»å‹ï¼Œåœ¨ç¼–è¯‘æ—¶æ— æ³•ç¡®å®šsizeï¼Œæ— æ³•ç›´æ¥ä½œä¸ºparam å’Œreturnã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// å’Œjavaï¼Œgolangçš„interfaceæœ‰åŒºåˆ«
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">test</span>(arg: <span style="color:#a6e22e">Fly</span>){} 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// åˆ©ç”¨æ³›å‹çº¦æŸTï¼Œ ok
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">&lt;</span>T: <span style="color:#a6e22e">Fly</span><span style="color:#f92672">&gt;</span>(arg: <span style="color:#a6e22e">T</span>) {}
</span></span></code></pre></div><p>traitç±»å‹æ˜¯DSTï¼Œ å®ç°traitçš„å…·ä½“ç±»å‹å¯èƒ½æœ‰å¤šä¸ªï¼ŒæŒ‡å‘traitç±»å‹çš„æŒ‡é’ˆï¼ˆèƒ–ï¼‰éœ€è¦è®°å½•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::raw <span style="color:#75715e">// module
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">TraitObject</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">pub</span> data: <span style="color:#f92672">*</span><span style="color:#66d9ef">mut</span>(),   <span style="color:#75715e">// å®ç°traitçš„å…·ä½“å¯¹è±¡ï¼Œå¯¹è±¡é‡Œä¸åŒ…å«æŒ‡å‘è™šå‡½æ•°tableçš„æŒ‡é’ˆã€‚ä¸C++ä¸åŒã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">pub</span> vtable: <span style="color:#f92672">*</span><span style="color:#66d9ef">mut</span>(), <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">use</span> std::mem;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Bird</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Duck</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Fly <span style="color:#66d9ef">for</span> Bird {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">fly</span>(<span style="color:#f92672">&amp;</span>self) {println!(<span style="color:#e6db74">&#34;bird can fly&#34;</span>);}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Fly <span style="color:#66d9ef">for</span> Duck {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">fly</span>(<span style="color:#f92672">&amp;</span>self) {println!(<span style="color:#e6db74">&#34;duck can fly&#34;</span>);}
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// &amp;Fly, Box&lt;Fly&gt; both trait object
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">print_trait_object</span>(p: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Fly</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> (data, vtalbe): (<span style="color:#66d9ef">usize</span>, <span style="color:#66d9ef">usize</span>) <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsafe</span>{mem::transmute(p)};
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;trait object: data={}, vtable={}&#34;</span>, data, vtable);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">unsafe</span>{
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> v: <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">usize</span> <span style="color:#f92672">=</span> vtable <span style="color:#66d9ef">as</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span>() <span style="color:#66d9ef">as</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">usize</span>;
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;vtable {}, {}, {}, {}&#34;</span>, <span style="color:#f92672">*</span>v, <span style="color:#f92672">*</span>v.offset(<span style="color:#ae81ff">1</span>), <span style="color:#f92672">*</span>v.offset(<span style="color:#ae81ff">2</span>), <span style="color:#f92672">*</span>v.offset(<span style="color:#ae81ff">3</span>));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> duck Duck;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> p_duck <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>duck;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> p_fly <span style="color:#f92672">=</span> p_duck <span style="color:#66d9ef">as</span> <span style="color:#f92672">&amp;</span>Fly;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    let p_fly = TraitObject{
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            data: &amp;p_duck, // store data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">            vtable: &amp;Fly_for_Duck_vtable, //store method
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    }
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    */</span>
</span></span><span style="display:flex;"><span>    p_fly.fly();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">        (p_fly.vtable.method)(p_fly.data);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">    */</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;size of p_duck={}, size of p_fly={}&#34;</span>, mem::size_of_val(p_duck), mem::size_of_val(p_fly));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> duck_fly: <span style="color:#66d9ef">usize</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsafe</span>{mem::transmute(Duck::fly)};
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> bird_fly: <span style="color:#66d9ef">usize</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsafe</span>{mem::transmute(Bird::fly)};
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;Duck::fly={}, Bird::fly={}&#34;</span>, duck_fly, bird_fly);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print_trait_object(p_fly);
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> bird Bird;
</span></span><span style="display:flex;"><span>    print_trait_object(<span style="color:#f92672">&amp;</span>brid <span style="color:#66d9ef">as</span> <span style="color:#f92672">&amp;</span>Fly);
</span></span><span style="display:flex;"><span>}x
</span></span></code></pre></div><p>object safeï¼š trait objectå—åˆ°é™åˆ¶ã€‚</p>
<ul>
<li>å½“traitä¸Šæœ‰Selfï¼šsizedé™åˆ¶æ—¶ï¼Œæ— æ³•æ„é€ trait objã€‚</li>
<li>traité‡Œæ‰€æœ‰å‡½æ•°éƒ½æ˜¯object safe
<ul>
<li>å½“traité‡Œå‡½æ•°ä¸Šæœ‰Self: sizedé™åˆ¶æ—¶ï¼Œè¯¥å‡½æ•°ä¸ä¼šåŠ å…¥åˆ°vtableä¸­ã€‚</li>
<li>å½“å‡½æ•°ä¸­é™¤äº†selfå‚æ•°ä¹‹å¤–è¿˜æœ‰Selfç±»å‹ä½œä¸ºå‚æ•°æˆ–è€…è¿”å›ç±»å‹æ—¶ï¼Œ</li>
<li>å½“å‡½æ•°æœ‰æ³›å‹å‚æ•°æ—¶ã€‚</li>
</ul>
</li>
</ul>
<h3 id="closure">closure <a href="#closure" class="anchor">ğŸ”—</a></h3><p>å¦‚æœä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œå…¶å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œé‚£ä¹ˆå®ƒå¿…ç„¶ä¼šæ”¯æŒé—­åŒ…ï¼ˆclosureï¼‰ï¼Œå› ä¸ºå‡½æ•°ä½œä¸ºè¿”å›å€¼å¾€å¾€éœ€è¦è¿”å›ä¸€ä¸ªé—­åŒ…ã€‚<br>
é—­åŒ…ç›¸å½“äºä¸€ä¸ªæ•è·å˜é‡çš„ç»“æ„ä½“ï¼Œå®ç°äº† FnOnce æˆ– FnMut æˆ– Fnã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">f</span><span style="color:#f92672">&lt;</span>F: FnOnce() -&gt; String<span style="color:#f92672">&gt;</span>(g: <span style="color:#a6e22e">F</span>) {
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;{}&#34;</span>, g());
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> s <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;halo&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> t <span style="color:#f92672">=</span> String::from(<span style="color:#e6db74">&#34;world&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>f(<span style="color:#f92672">||</span>{
</span></span><span style="display:flex;"><span>    s <span style="color:#f92672">+=</span> <span style="color:#f92672">&amp;</span>t;
</span></span><span style="display:flex;"><span>    s
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Closure</span><span style="color:#f92672">&lt;&#39;</span><span style="color:#a6e22e">a</span><span style="color:#f92672">&gt;</span>{
</span></span><span style="display:flex;"><span>    s: String,
</span></span><span style="display:flex;"><span>    t: <span style="color:#66d9ef">&amp;</span><span style="color:#f92672">&#39;</span><span style="color:#a6e22e">a</span> String,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> <span style="color:#f92672">&lt;&#39;</span><span style="color:#a6e22e">a</span><span style="color:#f92672">&gt;</span> FnOnce<span style="color:#f92672">&lt;</span>()<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">for</span> Closure<span style="color:#f92672">&lt;&#39;</span><span style="color:#a6e22e">a</span><span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Output</span> <span style="color:#f92672">=</span> String;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">call_once</span>(self) -&gt; <span style="color:#a6e22e">Output</span>{
</span></span><span style="display:flex;"><span>        self.s <span style="color:#f92672">+=</span> <span style="color:#f92672">&amp;*</span>self.t;
</span></span><span style="display:flex;"><span>        self.s
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>f(Closure{s: <span style="color:#a6e22e">s</span>, t: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">t</span>});
</span></span></code></pre></div><p>æ ‡å‡†åº“ä¸­ï¼š Rc, Box::leak() çªç ´å•ä¸€æ‰€æœ‰æƒ<br>
Iterator ä¸æ–­æ„é€ æ–°ç»“æ„ï¼Œæ”¯æŒlazy evaluation<br>
Rc::clone å†…éƒ¨å¯å˜æ€§ã€‚</p>
<p>tree src, readme.md ç›®å½•æ¡†æ¶<br></p>
<p>dors.rs &lt;-&gt; code æ–¹ä¾¿æ¥å›åˆ‡æ¢ <br></p>
<p>ä»traitå¼€å§‹ï¼š docsä¸Šrequired method(éœ€è¦è¢«å®ç°çš„æ–¹æ³•), provided method, implementations on foreign typesï¼Œ implementorã€‚</p>
<p>ä»structå¼€å§‹ï¼š methodsï¼Œ trait implementation, auto trait, blanket trait <br></p>
<p>[Blanket Implementations}(https://doc.rust-lang.org/nightly/src/core/any.rs.html#200)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">#[stable(feature = </span><span style="color:#e6db74">&#34;rust1&#34;</span><span style="color:#75715e">, since = </span><span style="color:#e6db74">&#34;1.0.0&#34;</span><span style="color:#75715e">)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T: <span style="color:#f92672">&#39;</span>static <span style="color:#f92672">+</span> <span style="color:#f92672">?</span>Sized<span style="color:#f92672">&gt;</span> Any <span style="color:#66d9ef">for</span> T {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">type_id</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#a6e22e">TypeId</span> {
</span></span><span style="display:flex;"><span>        TypeId::of::<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>â€ƒâ€ƒ<code>T: 'static</code> -&gt;  the type does not contain any non-static referencesã€‚ <br>
â€ƒâ€ƒTç±»å‹æ˜¯è¦ä¹ˆæ‹¥æœ‰æ‰€æœ‰æƒï¼Œè¦ä¹ˆæ˜¯æ‹¥æœ‰é™æ€å¼•ç”¨&amp;strã€‚ <br></p>
<p>blanket traitä¾‹å¦‚Anyï¼Œ ä¸ºæ³›å‹Tå®ç°äº†Any traitï¼Œ é‚£ä¹ˆä»»ä½•ç±»å‹åªè¦æ»¡è¶³bound trait</p>
<p><a href="https://blog.rust-lang.org/2015/04/17/Enums-match-mutation-and-moves.html" target="_blank" rel="noopener">match is designed to work quite well without taking ownership</a><br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">tree_weight_v2</span>(t: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">BinaryTree</span>) -&gt; <span style="color:#66d9ef">i32</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//               ^~~~~~~~~~~ The `&amp;` means we are *borrowing* the tree
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#75715e">// *t == L-value expression
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>   <span style="color:#66d9ef">match</span> <span style="color:#f92672">*</span>t { <span style="color:#75715e">// *t ==  not making a copy of the tree, nor moving it to a new temporary location
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        BinaryTree::Leaf(payload) <span style="color:#f92672">=&gt;</span> payload,
</span></span><span style="display:flex;"><span>        BinaryTree::Node(<span style="color:#66d9ef">ref</span> left, payload, <span style="color:#66d9ef">ref</span> right) <span style="color:#f92672">=&gt;</span> {
</span></span><span style="display:flex;"><span>            tree_weight_v2(left) <span style="color:#f92672">+</span> payload <span style="color:#f92672">+</span> tree_weight_v2(right)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">// å½“æ‰€æœ‰æƒè½¬ç§»æ—¶ï¼Œæ•°æ®çš„å¯å˜æ€§å¯èƒ½å‘ç”Ÿæ”¹å˜ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> immutable_box <span style="color:#f92672">=</span> Box::new(<span style="color:#ae81ff">5</span><span style="color:#66d9ef">u32</span>);
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;immutable_box contains {}&#34;</span>, immutable_box);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//*immutable_box = 4;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">// ç§»åŠ¨boxï¼Œæ”¹å˜æ‰€æœ‰æƒï¼ˆå’Œå¯å˜æ€§ï¼‰
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> mutable_box <span style="color:#f92672">=</span> immutable_box;
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;mutable_box contains {}&#34;</span>, mutable_box);
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">*</span>mutable_box <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;mutable_box now contains {}&#34;</span>, mutable_box);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// éƒ¨åˆ†ç§»åŠ¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Person</span> {
</span></span><span style="display:flex;"><span>        name: String,
</span></span><span style="display:flex;"><span>        age: <span style="color:#66d9ef">u8</span>,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> person <span style="color:#f92672">=</span> Person {
</span></span><span style="display:flex;"><span>        name: String::from(<span style="color:#e6db74">&#34;brett&#34;</span>),
</span></span><span style="display:flex;"><span>        age: <span style="color:#ae81ff">19</span>,
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// `name` ä» person ä¸­ç§»èµ°ï¼Œä½† `age` åªæ˜¯å¼•ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">let</span> Person { name, <span style="color:#66d9ef">ref</span> age } <span style="color:#f92672">=</span> person;
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;The person&#39;s age is {}&#34;</span>, age);
</span></span><span style="display:flex;"><span>    println!(<span style="color:#e6db74">&#34;The person&#39;s name is {}&#34;</span>, name);
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// æŠ¥é”™ï¼éƒ¨åˆ†ç§»åŠ¨å€¼çš„å€Ÿç”¨ï¼š`person` éƒ¨åˆ†å€Ÿç”¨äº§ç”Ÿ
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#75715e">//println!(&#34;The person struct is {:?}&#34;, person);
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// `person` ä¸èƒ½ä½¿ç”¨ï¼Œä½† `person.age` å› ä¸ºæ²¡æœ‰è¢«ç§»åŠ¨è€Œå¯ä»¥ç»§ç»­ä½¿ç”¨
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    println!(<span style="color:#e6db74">&#34;The person&#39;s age from person struct is {}&#34;</span>, person.age);
</span></span></code></pre></div><br>
<p>ç›´æ¥è®¿é—®Vecç»“æ„ä½“ä¸­çš„lenå­—æ®µï¼Œå¯ä»¥å—ï¼Ÿ åˆ†ä¸¤ç§æƒ…å†µå§ï¼Œ<a href="https://doc.rust-lang.org/beta/error_codes/E0616.html" target="_blank" rel="noopener">safe rustä¸è¡Œ</a>ã€‚ unsafe rustä¸‹ mem::transmute åº”è¯¥æ˜¯å¯ä»¥çš„ã€‚
error[E0616]: field <code>len</code> of struct <code>Vec</code> is private
<a href="https://doc.rust-lang.org/beta/error_codes/E0616.html" target="_blank" rel="noopener">https://doc.rust-lang.org/beta/error_codes/E0616.html</a></p>
<pre tabindex="0"><code>&#34;a&#34;.to_string() vs &#34;a&#34;.to_owned() 
https://users.rust-lang.org/t/to-string-vs-to-owned-for-string-literals/1441
</code></pre><p>How to step into std source code when debugging in VS Code?`
<a href="https://users.rust-lang.org/t/solved-how-to-step-into-std-source-code-when-debugging-in-vs-code/25319" target="_blank" rel="noopener">solved</a> <br>
<a href="https://github.com/vadimcn/vscode-lldb/blob/master/MANUAL.md#source-path-remapping" target="_blank" rel="noopener">Source Path Remapping</a><br></p>
<h1 id="æ ¼å¼åŒ–è¾“å‡º">æ ¼å¼åŒ–è¾“å‡º <a href="#%e6%a0%bc%e5%bc%8f%e5%8c%96%e8%be%93%e5%87%ba" class="anchor">ğŸ”—</a></h1><p><code>{}</code> é€‚ç”¨äº å®ç°äº† <code>std::fmt::Display</code>ç±»å‹ã€‚ <code>{:?}</code> é€‚ç”¨äº å®ç°äº†<code>std::fmt::Debug</code>ç±»å‹</p>
<h1 id="rustä¹¦å†™çš„ä¹ æƒ¯">rustä¹¦å†™çš„ä¹ æƒ¯ <a href="#rust%e4%b9%a6%e5%86%99%e7%9a%84%e4%b9%a0%e6%83%af" class="anchor">ğŸ”—</a></h1><p>ç±»å‹æ˜¯é©¼å³°å‘½åã€‚ å˜é‡åå’Œå‡½æ•°åæ˜¯è›‡å½¢å‘½åã€‚</p>
<h2 id="å‚è€ƒä¸èµ„æ–™">å‚è€ƒä¸èµ„æ–™ <a href="#%e5%8f%82%e8%80%83%e4%b8%8e%e8%b5%84%e6%96%99" class="anchor">ğŸ”—</a></h2><p>[1]<a href="https://www.ralfj.de/projects/rust-101/main.html" target="_blank" rel="noopener"> welcome to rust 101</a><br>
[2]<a href="https://tourofrust.com/" target="_blank" rel="noopener"> rust by example</a><br>
[3]<a href="https://blog.rust-lang.org/" target="_blank" rel="noopener"> rust blog</a><br>
[4]<a href="https://this-week-in-rust.org/" target="_blank" rel="noopener"> this week in rust</a><br>
[5]<a href="https://blog.rust-lang.org/inside-rust/index.html" target="_blank" rel="noopener"> inside rust</a><br>
[6]<a href="https://tourofrust.com/TOC_en.html" target="_blank" rel="noopener"> Tour of Rust</a> ä»¥ç®€å•çš„ä¾‹å­ä¸²è®²ï¼Œå¾ˆå¥½å…¥æ‰‹<br>
[7]<a href="https://doc.rust-lang.org/stable/book/" target="_blank" rel="noopener">ã€ŠThe Rust Programming Languageã€‹</a> done<br>
[8]<a href="https://rust-book.cs.brown.edu/experiment-intro.html" target="_blank" rel="noopener">ã€ŠRust Book experiment: Experiment Introductionã€‹</a>
[9]<a href="https://doc.rust-lang.org/nightly/nomicon/dot-operator.html" target="_blank" rel="noopener"> rust noniom</a><br>
[10]<a href="https://cheats.rs/#data-structures" target="_blank" rel="noopener"> Rust Language Cheat Sheet</a> é€‚åˆå¿«é€Ÿæµè§ˆï¼Œæœ‰é—®é¢˜æ—¶æŸ¥çœ‹çš„å·¥å…·ä¹¦ done<br>
[11]<a href="https://doc.rust-lang.org/nightly/rust-by-example" target="_blank" rel="noopener"> rust by example</a> æ¯ç¯‡éƒ½å¾ˆçŸ­å¹¶é…æœ‰ä¾‹å­ï¼Œå¾ˆå¥½å…¥æ‰‹ã€‚done<br>
[12]<a href="https://github.com/google/comprehensive-rust" target="_blank" rel="noopener"> google comprehensive-rust 4days</a><br>
[13]<a href="github.com/rust-in-blockchain/awesome-blockchain-rust"> awesome block chain rust</a><br>
[14]<a href=""></a><br>
[15]<a href=""></a><br>
[16]<a href=""></a><br>
[17]<a href=""></a><br>
[18]<a href=""></a><br>
[19]<a href=""></a><br>
[20]<a href=""></a><br>
text editor. <a href="https://www.philippflenker.com/hecto" target="_blank" rel="noopener">https://www.philippflenker.com/hecto</a>
pngme book.  build your text editor with rust.</p>
<pre><code>                    writing an os in rust.   os.phil-opp.com/zh-CN/     github.com/phil-opp/blog-os
</code></pre>

    </div>

    
        <div class="tags">
            
                <a href="http://brettkk.github.io/tags/rust">rust</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <script src="https://utteranc.es/client.js"
repo="brettKK/brettkk.github.io"
issue-term="title"
theme="github-light"
crossorigin="anonymous"
async>
</script>  

    <div class="copyright">
    
       Â© Copyright 
       2023 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://github.com/nodejh/hugo-theme-cactus-plus'>nodejh</a>
      </div>
    
</footer>




  </body>
</html>
