<!DOCTYPE html>
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css">
<script src="https://cdn.bootcss.com/highlight.js/9.12.0/languages/yaml.min.js"></script>
<html lang="zh-cn">
  <head>
    <title>ç¯å¢ƒé—®é¢˜ &#43; ç±»å‹ç³»ç»Ÿç–‘é—® | brettkk</title>

    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">    
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="åœ¨vscodeä¸‹é…ç½®rusté¡¹ç›®çš„é˜…è¯»å’Œdebug ğŸ”—rust">
<meta name="generator" content="Hugo 0.103.1" />


  <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link href="https://cdn.bootcss.com/highlight.js/9.15.10/styles/zenburn.min.css" rel="stylesheet">
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<link rel="stylesheet" href="http://brettkk.github.io/css/syntax.css" />


<link rel="stylesheet" href="/css/style.css">



<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />




  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css" integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js" integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>




  </head>

  <body>
    <nav class="navigation">
	
		<a href="/"> <span class="arrow">â†</span>Home</a>
	
	<a href="/posts">Archive</a>
	<a href="/tags">Tags</a>
	<a href="/about">About</a>

	

	
</nav>


    <main class="main">
      

<section id="single">
    <h1 class="title">ç¯å¢ƒé—®é¢˜ &#43; ç±»å‹ç³»ç»Ÿç–‘é—®</h1>

    <div class="tip">
        <time datetime="2022-11-21 11:33:56 &#43;0800 CST">Nov 21, 2022</time>
        <span class="split">
          Â·
        </span>
        <span>
          5027 words
        </span>
        <span class="split">
          Â·
        </span>
        <span>
          11 minute read
        </span>
    </div>

    
    
        
  
    <aside class="toc">
      <details>
          <summary>Table of Contents
          </summary>
          <div>
              <nav id="TableOfContents">
  <ul>
    <li><a href="#åœ¨vscodeä¸‹é…ç½®rusté¡¹ç›®çš„é˜…è¯»å’Œdebug">åœ¨vscodeä¸‹é…ç½®rusté¡¹ç›®çš„é˜…è¯»å’Œdebug</a></li>
    <li><a href="#stdoptionoptionçš„ç–‘é—®">std::option::Optionçš„ç–‘é—®</a></li>
    <li><a href="#è¯­è¨€ä¸­çš„sugar">è¯­è¨€ä¸­çš„sugar</a>
      <ul>
        <li><a href="#coercion">coercion</a></li>
        <li><a href="#deref">deref</a></li>
      </ul>
    </li>
    <li><a href="#borrow-and-asref">Borrow and AsRef</a></li>
    <li><a href="#traitçš„å…³è”ç±»å‹">traitçš„å…³è”ç±»å‹</a></li>
    <li><a href="#æ‰€æœ‰æƒè½¬ç§»æ—¶å¯æ”¹æ•°æ®çš„å¯å˜å±æ€§éƒ¨åˆ†ç§»åŠ¨">æ‰€æœ‰æƒè½¬ç§»æ—¶å¯æ”¹æ•°æ®çš„å¯å˜å±æ€§ï¼Œéƒ¨åˆ†ç§»åŠ¨</a></li>
    <li><a href="#ref">ref</a></li>
    <li><a href="#static">'static</a></li>
    <li><a href="#è¿­ä»£å™¨ä¸­çš„ç±»å‹ç–‘é—®">è¿­ä»£å™¨ä¸­çš„ç±»å‹ç–‘é—®</a></li>
    <li><a href="#as-_">as _</a></li>
    <li><a href="#intoiterator">IntoIterator</a></li>
    <li><a href="#æ™ºèƒ½æŒ‡é’ˆ">æ™ºèƒ½æŒ‡é’ˆ</a></li>
    <li><a href="#pint-unpin">Pin<T>, Unpin</a></li>
    <li><a href="#send-sync">Send, Sync</a></li>
    <li><a href="#ç±»å‹å ç”¨äº†å¤šå°‘å†…å­˜">ç±»å‹å ç”¨äº†å¤šå°‘å†…å­˜</a>
      <ul>
        <li><a href="#dst">DST</a></li>
      </ul>
    </li>
    <li><a href="#é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç†</a></li>
    <li><a href="#lifetime">lifetime</a></li>
    <li><a href="#unsafe">unsafe</a></li>
    <li><a href="#æ³›å‹">æ³›å‹</a></li>
    <li><a href="#å†™ç®—æ³•éœ€è¦ç†Ÿç»ƒæŒæ¡çš„æ¨¡å—">å†™ç®—æ³•éœ€è¦ç†Ÿç»ƒæŒæ¡çš„æ¨¡å—</a>
      <ul>
        <li><a href="#optiont-ä¼šç”¨åˆ°çš„api">Option<T> ä¼šç”¨åˆ°çš„API</a></li>
        <li><a href="#asreft">AsRef<T></a></li>
      </ul>
    </li>
    <li><a href="#stdsyncatmoic-memory-ordering">std::sync::atmoic, memory ordering</a></li>
    <li><a href="#åŒ…æ¨¡å—å¯è§æ€§">åŒ…ï¼Œæ¨¡å—ï¼Œå¯è§æ€§</a></li>
    <li><a href="#stdcmdåŒ…">std::cmdåŒ…</a></li>
    <li><a href="#æ³›å‹ç¼–ç¨‹">æ³›å‹ç¼–ç¨‹</a></li>
    <li><a href="#è¯­æ³•é—®é¢˜">è¯­æ³•é—®é¢˜</a></li>
    <li><a href="#ç±»å‹çš„åµŒå¥—">ç±»å‹çš„åµŒå¥—</a></li>
    <li><a href="#å¯¹è±¡å®‰å…¨-trait-object">å¯¹è±¡å®‰å…¨ï¼Œ trait object</a></li>
    <li><a href="#any-trait"><code>Any</code> trait</a></li>
    <li><a href="#fn-fnmut-fnonce-åŒºåˆ«">Fn FnMut FnOnce åŒºåˆ«</a></li>
    <li><a href="#æ‰€æœ‰æƒmoveè¯­ä¹‰å€Ÿç”¨ç”Ÿå‘½å‘¨æœŸçš„æ¨è¿›å…³ç³»">æ‰€æœ‰æƒï¼Œmoveè¯­ä¹‰ï¼Œå€Ÿç”¨ï¼Œç”Ÿå‘½å‘¨æœŸçš„æ¨è¿›å…³ç³»</a></li>
    <li><a href="#traitsçš„å†…å­˜è¡¨ç¤º">traitsçš„å†…å­˜è¡¨ç¤º</a></li>
    <li><a href="#attribute-å±æ€§">attribute å±æ€§</a></li>
    <li><a href="#rust-ç”Ÿå‘½å®-è¿‡ç¨‹å®-rustä¸­çš„æ’æ¡©">rust ç”Ÿå‘½å®ï¼Œ è¿‡ç¨‹å®ï¼Œ rustä¸­çš„æ’æ¡©</a></li>
    <li><a href="#å­ç±»å‹-ç±»å‹äº§ç”Ÿå™¨-åå˜é€†å˜ä¸å˜">å­ç±»å‹ï¼Œ ç±»å‹äº§ç”Ÿå™¨ï¼Œ åå˜ï¼Œé€†å˜ï¼Œä¸å˜</a></li>
    <li><a href="#t-mut-t">&amp;T &amp;mut T</a></li>
    <li><a href="#rust-å†…å­˜æ¨¡å‹">rust å†…å­˜æ¨¡å‹</a></li>
  </ul>
</nav>
          </div>
      </details>
    </aside>
  


    


    <div class="content">
      <h1 id="åœ¨vscodeä¸‹é…ç½®rusté¡¹ç›®çš„é˜…è¯»å’Œdebug">åœ¨vscodeä¸‹é…ç½®rusté¡¹ç›®çš„é˜…è¯»å’Œdebug <a href="#%e5%9c%a8vscode%e4%b8%8b%e9%85%8d%e7%bd%aerust%e9%a1%b9%e7%9b%ae%e7%9a%84%e9%98%85%e8%af%bb%e5%92%8cdebug" class="anchor">ğŸ”—</a></h1><pre tabindex="0"><code>rust-analyzer failed to load workspace: Failed to read Cargo metadata from Cargo.toml file /Users/gonglei/rust-workspace/rust/Cargo.toml, cargo 1.53.0 (4369396ce 2021-04-27): Failed to run `&#34;cargo&#34; &#34;metadata&#34; &#34;--format-version&#34; &#34;1&#34; &#34;--manifest-path&#34; &#34;/Users/gonglei/rust-workspace/rust/Cargo.toml&#34; &#34;--filter-platform&#34; &#34;aarch64-apple-darwin&#34;`: `cargo metadata` exited with an error: error: failed to load manifest for workspace member `/Users/gonglei/rust-workspace/rust/src/bootstrap` Caused by: failed to parse manifest at `/Users/gonglei/rust-workspace/rust/src/bootstrap/Cargo.toml` Caused by: feature `edition2021` is required this Cargo does not support nightly features, but if you switch to nightly channel you can add `cargo-features = [&#34;edition2021&#34;]` to enable this feature


solvedï¼šUpdate the Rust to satisfy the new edition 2021.
rustup default nightly &amp;&amp; rustup update
</code></pre><hr>
<p>é˜…è¯»rust-langæ—¶é‡åˆ°çš„é—®é¢˜ï¼Œ åŸå› æ˜¯gitå¤§ä»“ä¸‹æœ‰äº›submodule, è¿™äº›submoduleåœ¨cloneæ—¶å¹¶ä¸ä¼šéšå¤§ä»“ä¸€èµ·ä¸‹è½½åˆ°æœ¬åœ°ã€‚<br></p>
<p>rustc -g main.rs<br>
lldb main<br>
b main
run
step
then...</p>
<pre tabindex="0"><code>* thread #1, name = &#39;main&#39;, queue = &#39;com.apple.main-thread&#39;, stop reason = step in
</code></pre><pre tabindex="0"><code>rust-analyzer failed to load workspace: Failed to read Cargo metadata from Cargo.toml file /Users/gonglei/rust-1.65.0/Cargo.toml, Some(Version { major: 1, minor: 67, patch: 0, pre: Prerelease(&#34;nightly&#34;) }): Failed to run `&#34;cargo&#34; &#34;metadata&#34; &#34;--format-version&#34; &#34;1&#34; &#34;--manifest-path&#34; &#34;/Users/gonglei/rust-1.65.0/Cargo.toml&#34; &#34;--filter-platform&#34; &#34;aarch64-apple-darwin&#34;`: `cargo metadata` exited with an error: error: failed to load manifest for workspace member `/Users/gonglei/rust-1.65.0/src/tools/rust-installer` Caused by: failed to read `/Users/gonglei/rust-1.65.0/src/tools/rust-installer/Cargo.toml` Caused by: No such file or directory (os error 2)
</code></pre><p><strong>é‡åˆ°è°ƒç”¨åº“å‡½æ•°æ—¶è¿›å…¥åˆ°æ±‡ç¼–ï¼Œæ‰¾ä¸åˆ°æºä»£ç æ—¶çš„é…ç½®</strong></p>
<pre tabindex="0"><code>//settings.json
{
    &#34;lldb.executable&#34;: &#34;rust-lldb&#34;,
    &#34;lldb.launch.sourceLanguages&#34;: [&#34;rust&#34;],
    &#34;lldb.launch.sourceMap&#34;: {
      &#34;/rustc/e75aab045fc476f176a58c408f6b06f0e275c6e1/&#34;: &#34;/Users/brett/.rustup/toolchains/nightly-aarch64-apple-darwin/lib/rustlib/src/rust&#34;
    },
}
</code></pre><p>å¢åŠ é…ç½®åï¼Œrust/libraryé‡Œçš„core, std, allocéƒ½å¯ä»¥step inè¿›å»äº†ã€‚ ä½†æ˜¯compileç›¸å…³çš„ä»£ç è¿˜æ˜¯step inåˆ°äº†æ±‡ç¼–<br>
rustupå®‰è£…å®Œå
<img src="/rust/rustup_copy_compile.png" height = "400" /><br>
å¤åˆ¶åï¼Œ lldb debug step into compileräº†ã€‚<br>
<img src="/rust/rust_step_in_compiler.png" width = "605" /><br></p>
<hr>
<h1 id="stdoptionoptionçš„ç–‘é—®">std::option::Optionçš„ç–‘é—® <a href="#stdoptionoption%e7%9a%84%e7%96%91%e9%97%ae" class="anchor">ğŸ”—</a></h1><p>std::option::Optionçš„mapæ–¹æ³•æ¶ˆè€—æ‰€æœ‰æƒä¸”è¿”å›<code>Option&lt;U&gt;</code>ç±»å‹ï¼Œ ä¸è¿­ä»£å™¨ä¸­çš„mapæ–¹æ³•åŒåï¼Œä½†æ˜¯è¿”å›å€¼ä¸ç›¸åŒã€‚<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> maybe_some_string <span style="color:#f92672">=</span> Some(String::from(<span style="color:#e6db74">&#34;Hello, World!&#34;</span>));
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> maybe_some_len <span style="color:#f92672">=</span> maybe_some_string.map(<span style="color:#f92672">|</span>s<span style="color:#f92672">|</span> s.len());
</span></span><span style="display:flex;"><span>assert_eq!(maybe_some_len, Some(<span style="color:#ae81ff">13</span>));
</span></span></code></pre></div><p>ok_or()æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() -&gt; Option<span style="color:#f92672">&lt;</span>Result<span style="color:#f92672">&lt;</span>String, <span style="color:#66d9ef">i32</span><span style="color:#f92672">&gt;&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span>              <span style="color:#f92672">^^^^^^^^^^^^^^^^^^^^^^^^^^^</span> <span style="color:#960050;background-color:#1e0010">`</span>main<span style="color:#960050;background-color:#1e0010">`</span> can only <span style="color:#66d9ef">return</span> types that implement <span style="color:#960050;background-color:#1e0010">`</span>Termination<span style="color:#960050;background-color:#1e0010">`</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">|</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">=</span> help: <span style="color:#a6e22e">consider</span> using <span style="color:#960050;background-color:#1e0010">`</span>()<span style="color:#960050;background-color:#1e0010">`</span>, or a <span style="color:#960050;background-color:#1e0010">`</span>Result<span style="color:#960050;background-color:#1e0010">`</span>
</span></span></code></pre></div><p><a href="https://doc.rust-lang.org/std/process/trait.Termination.html" target="_blank" rel="noopener">mainå‡½æ•°çš„return typeå¿…é¡»å®ç°std::process::Terminationç‰¹å¾</a><br>ï¼Œ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Termination <span style="color:#66d9ef">for</span> Infallible
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Termination <span style="color:#66d9ef">for</span> <span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Termination <span style="color:#66d9ef">for</span> ()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> Termination <span style="color:#66d9ef">for</span> ExitCode
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T: <span style="color:#a6e22e">Termination</span>, E: <span style="color:#a6e22e">Debug</span><span style="color:#f92672">&gt;</span> Termination <span style="color:#66d9ef">for</span> Result<span style="color:#f92672">&lt;</span>T, E<span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><h1 id="è¯­è¨€ä¸­çš„sugar">è¯­è¨€ä¸­çš„sugar <a href="#%e8%af%ad%e8%a8%80%e4%b8%ad%e7%9a%84sugar" class="anchor">ğŸ”—</a></h1><h2 id="coercion">coercion <a href="#coercion" class="anchor">ğŸ”—</a></h2><p>å¼±åŒ–ç±»å‹å»åŒ¹é…æ–¹æ³•çš„ç­¾åã€‚ &amp;mut T to &amp;Tã€‚<br></p>
<p><code>.</code>æ“ä½œç¬¦çš„èƒŒåï¼ˆç¼–è¯‘å™¨ï¼‰åšäº†å¾ˆå¤šæ“ä½œ<br>
auto-referencing, auto-dereferencing, and coercion until types match. copyç”±ç¼–è¯‘å™¨æ¥ä¿®æ”¹çš„åœ°æ–¹ä¼šè®©äººäº§ç”Ÿç–‘æƒ‘<br></p>
<p><a href="https://rustc-dev-guide.rust-lang.org/method-lookup.html" target="_blank" rel="noopener">ç¼–è¯‘å™¨çš„type checking</a><br></p>
<p>Method Resolution: Derefs or borrow x until x.f() works. <br></p>
<p>æœ‰ä¸¤ç§coercionï¼š <code>auto_ref</code>, <code>auto_deref</code></p>
<ul>
<li>auto_ref,  T -&gt; &amp;T, mut T -&gt; &amp;mut T (å•çº¯çš„æƒ³è¦å¼•ç”¨T)
<ul>
<li>object.something(), rustc å¯ä»¥æ·»åŠ &amp;objectï¼Œ &amp;mut object, *objectæ¥æ˜¯callerçš„ç±»å‹ä¸somethingçš„ç­¾ååŒ¹é…ã€‚</li>
</ul>
</li>
<li>auto_deref, è‡ªåŠ¨è°ƒç”¨Deref::deref (Defrefæè¿°äº†å¤–éƒ¨ç±»å‹è½¬ä¸ºå†…éƒ¨ç±»å‹ï¼Œä¸€èˆ¬ç”¨äºæ™ºèƒ½æŒ‡é’ˆï¼‰
<ul>
<li>Option<T> æ²¡æœ‰å®ç°Derefã€‚</li>
<li>String<T> å®ç°äº†Derefã€‚</li>
<li>Box<T> å®ç°äº†Derefã€‚  &amp;*x: æ„æ€æ˜¯ &quot;reborrow&quot;
<ul>
<li>a = Box::new(&quot;hallo&quot;.to_owned());</li>
<li>let b = *a</li>
<li>let b = *(Box::defref(&amp;a))</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> a: Box<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> Box::new(<span style="color:#e6db74">&#34;hello&#34;</span>.to_owned());
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> b: <span style="color:#66d9ef">&amp;</span>String <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;*</span>a;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> c: <span style="color:#66d9ef">&amp;</span>String <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>(<span style="color:#f92672">*</span>(std::ops::Deref::deref(<span style="color:#f92672">&amp;</span>a)));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>Box::new(<span style="color:#ae81ff">2</span>);
</span></span><span style="display:flex;"><span>    test(<span style="color:#f92672">&amp;**</span>a); <span style="color:#75715e">// one * to dereference the Box, get &amp;i32
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#75715e">// one * to dereference the &amp;ï¼Œ get i32
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                <span style="color:#75715e">// reborrow with &amp;, get &amp;i32
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">test</span>(a: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">i32</span>) { println!(<span style="color:#e6db74">&#34;{}&#34;</span>, <span style="color:#f92672">*</span>a) }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">#[derive(Debug)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">MyI32</span>(<span style="color:#66d9ef">i32</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span> MyI32 {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">print_string</span>(<span style="color:#f92672">&amp;</span>self) {
</span></span><span style="display:flex;"><span>        println!(<span style="color:#e6db74">&#34;&amp;self={:?}&#34;</span>, self); <span style="color:#75715e">// auto add *
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        println!(<span style="color:#e6db74">&#34;*self={:?}&#34;</span>, <span style="color:#f92672">*</span>self);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[test]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">test_my_i32</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> mi32 <span style="color:#f92672">=</span> MyI32(<span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span>    mi32.print_string();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> box_my_i32 <span style="color:#f92672">=</span> Box::new(mi32);
</span></span><span style="display:flex;"><span>    box_my_i32.print_string(); <span style="color:#75715e">// Box&lt;MyI32&gt; -&gt; &amp;MyI32
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    (<span style="color:#f92672">&amp;</span>box_my_i32).print_string();
</span></span><span style="display:flex;"><span>    (<span style="color:#f92672">*</span>box_my_i32).print_string();
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// å¤šäº†ä¸€ä¸ª&amp; ï¼Œcompileè‡ªåŠ¨å»æ‰æ¥matchç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    (<span style="color:#f92672">&amp;*</span>box_my_i32).print_string();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Option<String> -- Not coercion --&gt;  Option&lt;&amp;str&gt; <br></p>
<h2 id="deref">deref <a href="#deref" class="anchor">ğŸ”—</a></h2><p>è§£å¼•ç”¨ç±»å‹å»åŒ¹é…æ–¹æ³•ã€‚</p>
<h1 id="borrow-and-asref">Borrow and AsRef <a href="#borrow-and-asref" class="anchor">ğŸ”—</a></h1><p>&amp; == ampersand == ref <br></p>
<p>å¾ˆç›¸è¿‘ï¼Œä½†ä¸åŒ<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> AsRef<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span>
</span></span><span style="display:flex;"><span>    T: <span style="color:#f92672">?</span>Sized,
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">as_ref</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">T</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>&amp;</code>å€Ÿç”¨ï¼ˆå¼•ç”¨ï¼‰æ˜¯blanket implementï¼Œæ‰€æœ‰ç±»å‹éƒ½å®ç°äº†<br>
<code>Borrow</code> <br>
<code>AsRef</code>æ˜¯åšç±»å‹è½¬æ¢äº†ã€‚ å®šåˆ¶åŒ– <code>as_ref</code> åçš„ç±»å‹, å¯èƒ½selfä¸åŒçš„å¦å¤–ä¸€ç§ï¼ˆString -&gt; &amp;strï¼‰, å¯èƒ½æ˜¯selfç»“æ„ä¸‹çš„æŸä¸€ä¸ªå­—æ®µçš„å¼•ç”¨ã€‚<br></p>
<ul>
<li>å¯¹å€¼ç±»å‹çš„è½¬æ¢ <code>From&lt;T&gt;</code>, <code>Into&lt;T&gt;</code></li>
<li>å¯¹å¼•ç”¨ç±»å‹çš„è½¬æ¢ <code>AsRef&lt;T&gt;</code>, <code>AsMut&lt;T&gt;</code></li>
</ul>
<h1 id="traitçš„å…³è”ç±»å‹">traitçš„å…³è”ç±»å‹ <a href="#trait%e7%9a%84%e5%85%b3%e8%81%94%e7%b1%bb%e5%9e%8b" class="anchor">ğŸ”—</a></h1><p><strong>ä¸ºä»€ä¹ˆéœ€è¦å…³è”ç±»å‹ï¼Ÿ</strong><br>
ä½¿ç”¨ä¸Šä¸æ–¹ä¾¿çš„åœ°æ–¹ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">container</span>(<span style="color:#66d9ef">i32</span>, <span style="color:#66d9ef">i32</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">trait</span> Contains<span style="color:#f92672">&lt;</span>A, B<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">contains</span>(<span style="color:#f92672">&amp;</span>self, _: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">A</span>, _: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">B</span>) -&gt; <span style="color:#66d9ef">bool</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">first</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">i32</span>; <span style="color:#75715e">// å¹¶ä¸æ˜¾ç¤ºéœ€è¦Aï¼ŒB
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">last</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">i32</span>;  <span style="color:#75715e">// å¹¶ä¸æ˜¾ç¤ºéœ€è¦Aï¼ŒB
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ç”¨åˆ°Containsåštrait boundæ—¶éœ€è¦æºå¸¦Aï¼Œ B ï¼Œä¸æ–¹ä¾¿ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">difference</span><span style="color:#f92672">&lt;</span>A, B, C<span style="color:#f92672">&gt;</span>(container: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">C</span>) -&gt; <span style="color:#66d9ef">i32</span> <span style="color:#a6e22e">where</span>
</span></span><span style="display:flex;"><span>    C: <span style="color:#a6e22e">Contains</span><span style="color:#f92672">&lt;</span>A, B<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    container.last() <span style="color:#f92672">-</span> container.first()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//vs å…³è”ç±»å‹
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">trait</span> Contains {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">A</span>; <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">B</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">contains</span>(<span style="color:#f92672">&amp;</span>self, _: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Self</span>::A, _: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Self</span>::B) -&gt; <span style="color:#66d9ef">bool</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ä½¿ç”¨èµ·æ¥ä¸ç”¨å¸¦æ³›å‹Aï¼ŒBï¼Œæ–¹ä¾¿ä¸€ç‚¹ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">difference</span><span style="color:#f92672">&lt;</span>C: <span style="color:#a6e22e">Contains</span><span style="color:#f92672">&gt;</span>(container: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">C</span>) -&gt; <span style="color:#66d9ef">i32</span> {
</span></span><span style="display:flex;"><span>      container.last() <span style="color:#f92672">-</span> container.first();
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="æ‰€æœ‰æƒè½¬ç§»æ—¶å¯æ”¹æ•°æ®çš„å¯å˜å±æ€§éƒ¨åˆ†ç§»åŠ¨">æ‰€æœ‰æƒè½¬ç§»æ—¶å¯æ”¹æ•°æ®çš„å¯å˜å±æ€§ï¼Œéƒ¨åˆ†ç§»åŠ¨ <a href="#%e6%89%80%e6%9c%89%e6%9d%83%e8%bd%ac%e7%a7%bb%e6%97%b6%e5%8f%af%e6%94%b9%e6%95%b0%e6%8d%ae%e7%9a%84%e5%8f%af%e5%8f%98%e5%b1%9e%e6%80%a7%e9%83%a8%e5%88%86%e7%a7%bb%e5%8a%a8" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> immutable_box <span style="color:#f92672">=</span> Box::new(<span style="color:#ae81ff">5</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> mutable_box <span style="color:#f92672">=</span> immutable_box;
</span></span><span style="display:flex;"><span><span style="color:#f92672">*</span>mutable_box <span style="color:#f92672">=</span> <span style="color:#ae81ff">4</span>;
</span></span></code></pre></div><p>ç»“æ„ä½“ä¸­çš„fieldå¯ä»¥éƒ¨åˆ†ç§»åŠ¨åˆ°å¤–éƒ¨ã€‚</p>
<h1 id="ref">ref <a href="#ref" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> x <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">ref</span> ref_x1 <span style="color:#f92672">=</span> x;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> ref_x2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>x; <span style="color:#75715e">// ref_x1, ref_x2 same
</span></span></span></code></pre></div><h1 id="static">'static <a href="#static" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> a: <span style="color:#66d9ef">&amp;</span><span style="color:#f92672">&#39;</span>static <span style="color:#66d9ef">str</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hello&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Trait bound
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// T  type does not contain any non-static references
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">generic</span><span style="color:#f92672">&lt;</span>T: <span style="color:#f92672">&#39;</span>static <span style="color:#f92672">+</span> <span style="color:#66d9ef">impl</span> Debug<span style="color:#f92672">&gt;</span>(x: <span style="color:#a6e22e">T</span>) {
</span></span><span style="display:flex;"><span>  println!(<span style="color:#e6db74">&#34;{:?}&#34;</span>, x);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>;
</span></span><span style="display:flex;"><span>genric(i); <span style="color:#75715e">//âœ…
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>genric(<span style="color:#f92672">&amp;</span>i) <span style="color:#75715e">//âŒ
</span></span></span></code></pre></div><h1 id="è¿­ä»£å™¨ä¸­çš„ç±»å‹ç–‘é—®">è¿­ä»£å™¨ä¸­çš„ç±»å‹ç–‘é—® <a href="#%e8%bf%ad%e4%bb%a3%e5%99%a8%e4%b8%ad%e7%9a%84%e7%b1%bb%e5%9e%8b%e7%96%91%e9%97%ae" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> vec1 <span style="color:#f92672">=</span> vec![<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> vec2 <span style="color:#f92672">=</span> vec2[<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>];
</span></span><span style="display:flex;"><span><span style="color:#75715e">// å¯¹ vec1 çš„ `iter()` ä¸¾å‡º `&amp;i32`, 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// `find` æ–¹æ³•ä¼šæŠŠè¿­ä»£å™¨å…ƒç´ çš„å¼•ç”¨ä¼ ç»™é—­åŒ…
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// ä¼ ç»™é—­åŒ…çš„ç±»å‹æ˜¯&amp;&amp;i32 ç”¨&amp;&amp;xè§£æ„ï¼Œ x ç±»å‹ä¸ºi32ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>println!(<span style="color:#e6db74">&#34;find 2 in vec1: {:?}&#34;</span>, vec1.iter().find(<span style="color:#f92672">|&amp;&amp;</span>x<span style="color:#f92672">|</span> x <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>));
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>println!(<span style="color:#e6db74">&#34;find 2 in vec2: {:?}&#34;</span>, vec2.iter().find(<span style="color:#f92672">|&amp;</span>x<span style="color:#f92672">|</span> x <span style="color:#f92672">==</span> <span style="color:#ae81ff">2</span>));
</span></span></code></pre></div><h1 id="as-_">as _ <a href="#as-_" class="anchor">ğŸ”—</a></h1><h1 id="intoiterator">IntoIterator <a href="#intoiterator" class="anchor">ğŸ”—</a></h1><h1 id="æ™ºèƒ½æŒ‡é’ˆ">æ™ºèƒ½æŒ‡é’ˆ <a href="#%e6%99%ba%e8%83%bd%e6%8c%87%e9%92%88" class="anchor">ğŸ”—</a></h1><p>åœ¨æŒ‡é’ˆçš„åŸºç¡€ä¸Šï¼Œé™„åŠ å…ƒæ•°æ®+åŠŸèƒ½<br></p>
<p>åœ¨rustä¸­traitå†³å®šäº†ç±»å‹çš„è¡Œä¸ºï¼Œ æ™ºèƒ½æŒ‡é’ˆçš„è¡Œä¸ºæ¶‰åŠåˆ°<code>Deref trait</code> , <code>Drop trait</code>, æ‹¥æœ‰æŒ‡é’ˆè¯­ä¹‰ï¼Œæ‹¥æœ‰å†…å­˜è‡ªåŠ¨ç®¡ç†ã€‚<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> Deref {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Target</span>: <span style="color:#f92672">?</span>size;
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">/// Dereference the value 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span>  <span style="color:#e6db74">/// *X =ã€‹ *(X.deref())
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span>  <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">deref</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Self</span>::Target;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Box</code></p>
<p><code>Vec&lt;T&gt;, String</code></p>
<p><code>Rc, Arc</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">RcBox</span><span style="color:#f92672">&lt;</span>T: <span style="color:#f92672">?</span>Sized<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>  strong: <span style="color:#a6e22e">Cell</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">usize</span><span style="color:#f92672">&gt;</span>,
</span></span><span style="display:flex;"><span>  weak: <span style="color:#a6e22e">Cell</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">usize</span><span style="color:#f92672">&gt;</span>,
</span></span><span style="display:flex;"><span>  value: <span style="color:#a6e22e">T</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">ArcInner</span><span style="color:#f92672">&lt;</span>T: <span style="color:#f92672">?</span>Sized<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>  strong: <span style="color:#a6e22e">atomic</span>::AtmoicUsize,
</span></span><span style="display:flex;"><span>  weak: <span style="color:#a6e22e">atmoic</span>::AtomicUsize,
</span></span><span style="display:flex;"><span>  data: <span style="color:#a6e22e">T</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>Cell, RefCell</code> å†…éƒ¨å¯å˜æ€§<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"></code></pre></div><p><code>Mutex, RwLock</code></p>
<p><code>Rc&lt;RefCell&lt;T&gt;&gt;</code>  ä¸€ä¸ªRefCell<T> å¯ä»¥æœ‰å¤šä¸ªæ‰€æœ‰è€…ã€‚
<code>RefCell&lt;Rc&lt;T&gt;&gt;</code> <br></p>
<p>Cellï¼Œ RefCellåœ¨åŠŸèƒ½ä¸Šæ²¡æœ‰åŒºåˆ«ã€‚<br>
Cell<T> ä½¿ç”¨äº Tå®ç°äº†Copyçš„æƒ…å†µ<br>
RefCell<T> å†…éƒ¨å¯å˜ï¼Œ ä¸€ä¸ªborrow_mutä¿®æ”¹åï¼Œå…¶ä»–å¼•ç”¨å¯ä»¥çœ‹åˆ°ä¿®æ”¹ã€‚ <br></p>
<p>Rc --downgrade() --&gt; Weak <br>
Weak -- Upgrade() --&gt; Option<Rc> <br></p>
<p>Box<T> -&gt; Unqiue<T> -&gt; NonNull<T> --&gt; *const T, *mut T <br></p>
<h1 id="pint-unpin">Pin<T>, Unpin <a href="#pint-unpin" class="anchor">ğŸ”—</a></h1><p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå…¶å®Pinæ˜¯ç”¨ä¸åˆ°çš„ã€‚å› ä¸ºå¤§å¤šæ•°æƒ…å½¢ä¸‹ï¼Œéƒ½å®ç°Unpin Traitsã€‚<br>
åœ¨å¼•å…¥çš„async/awaitç¼–ç¨‹ä¸­, Futrueçš„ç§»åŠ¨, å¦‚æœç»“æ„ä½“åŒ…å«äº†è‡ªå¼•ç”¨ï¼Œ å½“å¯¹è±¡å‘ç”Ÿç§»åŠ¨æ—¶å¼•ç”¨çš„æŒ‡é’ˆä¼šå¤±æ•ˆï¼Œæ‰€ä»¥éœ€è¦Pinä½<br>
Pinå¯¹è±¡çš„æ‰‹æ®µï¼š ç¦æ­¢è·å–<code>&amp;mut T</code>.</p>
<p><code>Pin&lt;P&gt;</code>, åŒ…è£¹çš„pï¼ˆå¿…é¡»æ˜¯å®ç°<code>Deref trait</code>çš„å¯¹è±¡ï¼‰æ˜¯æŒ‡é’ˆæŒ‡å‘åŸå§‹ç±»å‹Tï¼Œ ç†è§£ä¸º <code>Pin&lt;P&lt;T&gt;&gt;</code> <br>
ç»™å®š <code>Pin&lt;P&lt;T&gt;&gt;</code>ç±»å‹çš„æ•°æ®ï¼Œåªè¦ <code>T</code> ä¸æ»¡è¶³ <code>Unpin trait</code>ï¼Œåˆ™ <code>Safe Rust</code> ä¸‹æ— æ³•è·å¾— <code>&amp;mut T</code>å’Œ <code>T</code>ï¼Œä»è€Œè®© <code>T</code> ä¸èƒ½è¢« <code>move</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Example</span> {
</span></span><span style="display:flex;"><span>    data: String,
</span></span><span style="display:flex;"><span>    ptr: <span style="color:#a6e22e">NonNull</span><span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>P: <span style="color:#a6e22e">Deref</span><span style="color:#f92672">&lt;</span>Target: Unpin<span style="color:#f92672">&gt;&gt;</span> Pin<span style="color:#f92672">&lt;</span>P<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">new</span>(pointer: <span style="color:#a6e22e">P</span>) -&gt; <span style="color:#a6e22e">Pin</span><span style="color:#f92672">&lt;</span>P<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span></code></pre></div><h1 id="send-sync">Send, Sync <a href="#send-sync" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> Send <span style="color:#66d9ef">for</span> Arc<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span>
</span></span><span style="display:flex;"><span>    T: Sync <span style="color:#f92672">+</span> Send <span style="color:#f92672">+</span> <span style="color:#f92672">?</span>Sized,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> Sync <span style="color:#66d9ef">for</span> Arc<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">where</span>
</span></span><span style="display:flex;"><span>    T: Sync <span style="color:#f92672">+</span> Send <span style="color:#f92672">+</span> <span style="color:#f92672">?</span>Sized,
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T: <span style="color:#f92672">?</span>Sized <span style="color:#f92672">+</span> Send<span style="color:#f92672">&gt;</span> Send <span style="color:#66d9ef">for</span> RwLock<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T: <span style="color:#f92672">?</span>Sized <span style="color:#f92672">+</span> Send <span style="color:#f92672">+</span> Sync<span style="color:#f92672">&gt;</span> Sync <span style="color:#66d9ef">for</span> RwLock<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T: <span style="color:#f92672">?</span>Sized <span style="color:#f92672">+</span> Send<span style="color:#f92672">&gt;</span> Send <span style="color:#66d9ef">for</span> Mutex<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T: <span style="color:#f92672">?</span>Sized <span style="color:#f92672">+</span> Send<span style="color:#f92672">&gt;</span> Sync <span style="color:#66d9ef">for</span> Mutex<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T: Send<span style="color:#f92672">&gt;</span> Send <span style="color:#66d9ef">for</span> Sender<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">!</span>Sync <span style="color:#66d9ef">for</span> Sender<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// T: Send + Syncï¼Œ æ‰ä¸ºArcå®ç°Sendã€‚æ‰€ä»¥Arc&lt;RefCell&gt; ä¸èƒ½åœ¨çº¿ç¨‹spawnæ—¶ä½¿ç”¨ã€‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> Send <span style="color:#66d9ef">for</span> Arc<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">where</span> T: Sync <span style="color:#f92672">+</span> Send <span style="color:#f92672">+</span> <span style="color:#f92672">?</span>Sized
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">impl</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> Sync <span style="color:#66d9ef">for</span> Arc<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">where</span> T: Sync <span style="color:#f92672">+</span> Send <span style="color:#f92672">+</span> <span style="color:#f92672">?</span>Sized
</span></span></code></pre></div><p>Arc::new(RwLock::new(mpsc::Sender<T>))</p>
<p>Sender<T> no sync -&gt; RwLock no sync -&gt; Arc is not send and not sync.</p>
<p>Sender<T> is &quot;thread safe&quot; in that it can be sent between threads, but it cannot be shared between threads.  <br></p>
<ul>
<li>Send + Sync -&gt; å¤§å¤šæ•°ç±»å‹éƒ½æ˜¯çš„</li>
<li>ï¼Send + Sync -&gt;</li>
<li>ï¼Send + ! Sync -&gt;  Rcï¼Œ Raw pointerï¼Œ Arc<T> where T: Send + sync</li>
<li>Send + !Sync -&gt;  å†…éƒ¨å¯å˜çš„UnsafeCell, mpsc::Sender, Cell, RefCell</li>
</ul>
<h1 id="ç±»å‹å ç”¨äº†å¤šå°‘å†…å­˜">ç±»å‹å ç”¨äº†å¤šå°‘å†…å­˜ <a href="#%e7%b1%bb%e5%9e%8b%e5%8d%a0%e7%94%a8%e4%ba%86%e5%a4%9a%e5%b0%91%e5%86%85%e5%ad%98" class="anchor">ğŸ”—</a></h1><p><a href="https://play.rust-lang.org/?gist=41ac3acde9ea070db48add40d5d12831&amp;version=nightly" target="_blank" rel="noopener">NonNull</a></p>
<p>rustc raii.rs &amp;&amp; valgrind ./raii</p>
<h2 id="dst">DST <a href="#dst" class="anchor">ğŸ”—</a></h2><p>&amp;dyn Trait -&gt; (*mut data, *mut vtable) <br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">trait</span> Oper {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">add</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">i32</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">sub</span>(<span style="color:#f92672">&amp;</span>self) -&gt; <span style="color:#66d9ef">i32</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#75715e">#[repr(C)]</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">FatPointer</span><span style="color:#f92672">&lt;&#39;</span><span style="color:#a6e22e">a</span><span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>  data: <span style="color:#66d9ef">&amp;</span><span style="color:#f92672">&#39;</span><span style="color:#a6e22e">a</span> <span style="color:#a6e22e">mut</span> Data,
</span></span><span style="display:flex;"><span>  vtable: <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">usize</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Data</span> {
</span></span><span style="display:flex;"><span>  a: <span style="color:#66d9ef">i32</span>,
</span></span><span style="display:flex;"><span>  b: <span style="color:#66d9ef">i32</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">add</span>(s: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Data</span>) -&gt; <span style="color:#66d9ef">i32</span> {
</span></span><span style="display:flex;"><span>  s.a <span style="color:#f92672">+</span> s.b
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">sub</span>(s: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Data</span>) -&gt; <span style="color:#66d9ef">i32</span> {
</span></span><span style="display:flex;"><span>  s.a <span style="color:#f92672">-</span> s.b
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> data <span style="color:#f92672">=</span> Data{a: <span style="color:#ae81ff">3</span>, b: <span style="color:#ae81ff">2</span>};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> vtable <span style="color:#f92672">=</span> vec![
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">0</span>, <span style="color:#75715e">// æŒ‡å‘drop
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#ae81ff">5</span>, <span style="color:#75715e">// vtableçš„é•¿åº¦
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#ae81ff">8</span>, <span style="color:#75715e">// å†…å­˜å¯¹é½çš„size
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    add <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">usize</span>,
</span></span><span style="display:flex;"><span>    sub <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">usize</span>,
</span></span><span style="display:flex;"><span>  ];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> fat_pointer <span style="color:#f92672">=</span> FataPointer{data: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> data, vtable: <span style="color:#a6e22e">vtable</span>.as_ptr()};
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> dyn_ref <span style="color:#f92672">=</span> <span style="color:#66d9ef">unsafe</span> { std::mem::transmute::<span style="color:#f92672">&lt;</span>FatPointer, <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">dyn</span> Oper<span style="color:#f92672">&gt;</span>(fat_pointer)};
</span></span><span style="display:flex;"><span>  println!(<span style="color:#e6db74">&#34;add: {}&#34;</span>, dyn_ref.add());
</span></span><span style="display:flex;"><span>  println!(<span style="color:#e6db74">&#34;sub: {}&#34;</span>, dyn_ref.sub());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>&amp;[u8] -&gt; (*mut data, usize length)     <br>
&amp;str -&gt; (*mut data, usize length)      <br></p>
<h1 id="é”™è¯¯å¤„ç†">é”™è¯¯å¤„ç† <a href="#%e9%94%99%e8%af%af%e5%a4%84%e7%90%86" class="anchor">ğŸ”—</a></h1><ul>
<li>æ–°å¢ç±»å‹æ¥æºå¸¦é”™è¯¯ä¿¡æ¯ã€‚</li>
<li>å°±åœ°panicæ‰“å¼€stack unwind</li>
</ul>
<p>Option: map() -&gt; Option<T>.  Combinators: and_then
Some -&gt; Some and None -&gt; None
or()  ok_or</p>
<p>Result</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">multiply</span>(first_number_str: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>, second_number_str: <span style="color:#66d9ef">&amp;</span><span style="color:#66d9ef">str</span>) -&gt; Result<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">i32</span>, ParseIntError<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    first_number_str.parse::<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">i32</span><span style="color:#f92672">&gt;</span>().and_then(<span style="color:#f92672">|</span>first_number<span style="color:#f92672">|</span> {
</span></span><span style="display:flex;"><span>        second_number_str.parse::<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">i32</span><span style="color:#f92672">&gt;</span>().map(<span style="color:#f92672">|</span>second_number<span style="color:#f92672">|</span> first_number <span style="color:#f92672">*</span> second_number)
</span></span><span style="display:flex;"><span>    })
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><ul>
<li>ï¼Ÿ</li>
<li>Result::Ok(x), è¿”å›x</li>
<li>Result::Err(e), return Err(e)</li>
<li>Option::Some(x), è¿”å›x</li>
<li>Option::None, return None</li>
<li>unwrap()
<ul>
<li>Result::Ok(x), è¿”å›x</li>
<li>Result::Err(e), panic</li>
<li>Option::Some(x), è¿”å›x</li>
<li>Option::None, panic</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>do_something_may_fail()<span style="color:#f92672">?</span>;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// equals
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">match</span> do_something_may_fail() {
</span></span><span style="display:flex;"><span>  Ok(v) <span style="color:#f92672">=&gt;</span> v,
</span></span><span style="display:flex;"><span>  Err(e) <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">return</span> Err(e),
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">// catch panic
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> result <span style="color:#f92672">=</span> std::panic::catch_unwind(<span style="color:#f92672">||</span> {
</span></span><span style="display:flex;"><span>  panic!(<span style="color:#e6db74">&#34;oh no&#34;</span>);
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h1 id="lifetime">lifetime <a href="#lifetime" class="anchor">ğŸ”—</a></h1><p>å‡½æ•°è¿”å›å¼•ç”¨æ—¶ï¼Œé™¤éæ˜¯é™æ€å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼•ç”¨ä¸€å®šå’Œå¸¦æœ‰å¼•ç”¨çš„æŸä¸ªè¾“å…¥å‚æ•°æœ‰å…³ã€‚<br>
è¦å»ºç«‹æ­£ç¡®çš„è¾“å…¥å’Œè¿”å›å€¼ä¹‹é—´çš„å…³ç³»ï¼Œè¿™ä¸ªå…³ç³»å’Œå‡½æ•°å†…éƒ¨çš„å®ç°æ— å…³ï¼Œåªå’Œå‡½æ•°çš„ç­¾åæœ‰å…³ã€‚</p>
<h1 id="unsafe">unsafe <a href="#unsafe" class="anchor">ğŸ”—</a></h1><p>æ ‡å‡†åº“ä¸­unsafeã€‚
Slice::get_unchecked() æ‰§è¡Œæœªç»æ£€æŸ¥çš„ç´¢å¼•ï¼Œå…è®¸éšæ„åœ°è¿åå†…å­˜å®‰å…¨<br>
mem::transmuteå°†ä¸€äº›å€¼é‡æ–°è§£é‡Šä¸ºå…·æœ‰ç»™å®šçš„ç±»å‹ï¼Œä»¥ä»»æ„çš„æ–¹å¼ç»•è¿‡ç±»å‹å®‰å…¨<br>
æŒ‡å‘ä¸€ä¸ª Sized ç±»å‹çš„åŸå§‹æŒ‡é’ˆéƒ½æœ‰ä¸€ä¸ªoffsetæ–¹æ³•<br>
FFIï¼ˆForeign Function Interfaceï¼‰å‡½æ•°çš„è°ƒç”¨éƒ½æ˜¯ä¸å®‰å…¨çš„<br></p>
<ul>
<li>å¯¹åŸå§‹æŒ‡é’ˆè¿›è¡Œè§£å¼•ç”¨ã€‚ ä¾‹å¦‚é“¾è¡¨å®ç°ä¸­ä½¿ç”¨<code>node_ptr: NonNull&lt;Node&lt;T&gt;&gt; </code> ï¼Œnode_ptr.as_ptr()è·å¾—Nodeçš„å¯å˜å¼•ç”¨ã€‚</li>
</ul>
<p>NonNull<T> ,
std::ptr::Unique<T></p>
<h1 id="æ³›å‹">æ³›å‹ <a href="#%e6%b3%9b%e5%9e%8b" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">BagOfHolding</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>  item: <span style="color:#a6e22e">T</span>,
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> bag_in_bag <span style="color:#f92672">=</span> BagOfHolding {
</span></span><span style="display:flex;"><span>  item: <span style="color:#a6e22e">BagOfHolding</span>{item: <span style="color:#e6db74">&#34;duang&#34;</span>},
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;{}&#34;</span>, bag_in_bag.item.item);
</span></span></code></pre></div><h1 id="å†™ç®—æ³•éœ€è¦ç†Ÿç»ƒæŒæ¡çš„æ¨¡å—">å†™ç®—æ³•éœ€è¦ç†Ÿç»ƒæŒæ¡çš„æ¨¡å— <a href="#%e5%86%99%e7%ae%97%e6%b3%95%e9%9c%80%e8%a6%81%e7%86%9f%e7%bb%83%e6%8e%8c%e6%8f%a1%e7%9a%84%e6%a8%a1%e5%9d%97" class="anchor">ğŸ”—</a></h1><p>Optionï¼Œ Resultï¼Œ memï¼Œ ptrï¼Œ vecï¼Œ Stringï¼Œ strï¼Œ iterã€‚</p>
<p>Rcï¼Œ Arcï¼Œ Cellï¼Œ RefCellï¼Œ Box</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>  <span style="color:#75715e">//char é•¿åº¦éƒ½ä¸º 4 å­—èŠ‚
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">let</span> chars <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;ä½ å¥½ ğŸ¦€&#34;</span>.chars().collect::<span style="color:#f92672">&lt;</span>Vec<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">char</span><span style="color:#f92672">&gt;&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> <span style="color:#ae81ff">42</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> memory_location <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>a <span style="color:#66d9ef">as</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">i32</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">usize</span>;
</span></span></code></pre></div><p>todo  Cell Vs RefCell UnsafeCell(&amp;T --&gt; &amp;mut T)</p>
<p>Cell ä¸èƒ½getåˆ°inner refï¼Œ æ‰€ä»¥ä¿®æ”¹inneræ˜¯okçš„<br>
impl !sync for Cell <br></p>
<p>Rc vs Arc <br></p>
<p>std::ptr::NonNull<br></p>
<h2 id="optiont-ä¼šç”¨åˆ°çš„api">Option<T> ä¼šç”¨åˆ°çš„API <a href="#optiont-%e4%bc%9a%e7%94%a8%e5%88%b0%e7%9a%84api" class="anchor">ğŸ”—</a></h2><p>as_ref(): Converts <code>&amp;Option&lt;T&gt;</code> to <code>Option&lt;&amp;T&gt;</code>.<code>&lt;br&gt; as_mut(): from</code>&amp;mut Option<T><code>-&gt;</code>Option&lt;&amp;mut T&gt;` <br></p>
<p>Option ä¸ Result å¸¸è§æ–¹æ³•çš„å¯¹æ¯”: <br></p>
<table>
<thead>
<tr>
<th>Option<T></th>
<th>å‡½æ•°çš„åŠŸèƒ½</th>
<th>Result&lt;T, E&gt;</th>
<th>å‡½æ•°çš„åŠŸèƒ½</th>
</tr>
</thead>
<tbody>
<tr>
<td>is_some(&amp;self), is_none()</td>
<td></td>
<td>is_ok(&amp;self), is_err()</td>
<td></td>
</tr>
<tr>
<td>ok_or<E>(self, err: E) -&gt; Result&lt;T, E&gt;()</td>
<td>-&gt;Result&lt;T, E&gt;</td>
<td>ok(self) -&gt; Option<T>, err(self) -&gt; Option<E></td>
<td>Result-&gt;Option</td>
</tr>
<tr>
<td>as_ref(&amp;self) -&gt; Option&lt;&amp;T&gt;</td>
<td>&amp;Option&lt;T -&gt; Option&lt;&amp;T&gt;</td>
<td>as_ref(&amp;self) -&gt;Result&lt;&amp;T, &amp;E&gt;</td>
<td></td>
</tr>
<tr>
<td>as_mut(&amp;mut self) -&gt; Option&lt;&amp;mut T&gt;</td>
<td>&amp;mut Option<T> -&gt; Option&lt;&amp;mut T&gt;</td>
<td>as_mut(&amp;mut self) -&gt; Result&lt;&amp;mut T, &amp;mut E&gt;</td>
<td></td>
</tr>
<tr>
<td>map&lt;U, F&gt;(self, f: F) -&gt; Option<U> where F: FnOnce(T) -&gt; U</td>
<td>consume the orignal</td>
<td>map(self, op: F)</td>
<td>Result&lt;T, E&gt; -&gt; Result&lt;U, E&gt;</td>
</tr>
<tr>
<td>as_deref(&amp;self) -&gt; Option&lt;&amp;<T as Deref>::Target&gt; where T: Deref,</td>
<td>&amp;Option&lt;T -&gt; Option&lt;&amp;T::Target&gt;</td>
<td>as_deref(&amp;self) -&gt; &lt;&amp;<T as deref>::Target, &amp;E&gt;</td>
<td>Result&lt;String, u32&gt; -&gt; Result&lt;&amp;str, &amp;u32&gt;</td>
</tr>
<tr>
<td>as_deref_mut(&amp;mut self) -&gt; Option&lt;&amp;mut <T as Deref>::Target&gt; where T: DerefMut,</td>
<td>&amp;mut Option<T> -&gt; Option&lt;&amp;mut T::Target&gt;</td>
<td>as_deref_mut(&amp;mut self)</td>
<td></td>
</tr>
<tr>
<td>expect(self, msg: &amp;str)</td>
<td>may panic</td>
<td>expect(self, msg: &amp;str) -&gt; T</td>
<td>may panic</td>
</tr>
<tr>
<td>unwrap(self) -&gt; T</td>
<td>my panic</td>
<td>unwrap(self)-&gt;T</td>
<td>may panic</td>
</tr>
<tr>
<td>unwrap_or_default(self)-&gt; T where T: Default,</td>
<td>no panic</td>
<td></td>
<td></td>
</tr>
<tr>
<td>take(&amp;mut self) -&gt; Option<T></td>
<td>leave none, return Option</td>
<td></td>
<td></td>
</tr>
<tr>
<td>replace(&amp;mut self, value: T) -&gt; Option<T></td>
<td>change and return old value</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">enum</span> Option<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>  None,
</span></span><span style="display:flex;"><span>  Some(T),
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">as_ref</span>(<span style="color:#f92672">&amp;</span>self) -&gt; Option<span style="color:#f92672">&lt;&amp;</span>T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> text: Option<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> Some(<span style="color:#e6db74">&#34;Hello, world!&#34;</span>.to_string());
</span></span><span style="display:flex;"><span><span style="color:#75715e">// First, cast `Option&lt;String&gt;` to `Option&lt;&amp;String&gt;` with `as_ref`,
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">// then consume *that* with `map`, leaving `text` on the stack.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">let</span> text_length: Option<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">usize</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> text.as_ref().map(<span style="color:#f92672">|</span>s<span style="color:#f92672">|</span> s.len());
</span></span><span style="display:flex;"><span>println!(<span style="color:#e6db74">&#34;still can print text: {text:?}&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">as_mut</span>(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self) -&gt; Option<span style="color:#f92672">&lt;&amp;</span><span style="color:#66d9ef">mut</span> T<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>expect() <span style="color:#75715e">// panics with a provided custom message
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>unwrap() <span style="color:#75715e">// panics with a generic message
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>unwrap_or(<span style="color:#e6db74">&#34;abc&#34;</span>) <span style="color:#75715e">// returns the provided default value
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>ok_or() <span style="color:#75715e">//Some(v) to Ok(v), and None to Err(err)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>filter() <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>map()    <span style="color:#75715e">//  Option&lt;T&gt; to Option&lt;U&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>take()   <span style="color:#75715e">//
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>replace() <span style="color:#75715e">//
</span></span></span></code></pre></div><p>and_then()</p>
<p>take(): <br></p>
<p>deref_mut() <br></p>
<h2 id="asreft">AsRef<T> <a href="#asreft" class="anchor">ğŸ”—</a></h2><p>String -&gt; &amp;str (&quot;abc&quot;.to_string().as_ref())</p>
<h1 id="stdsyncatmoic-memory-ordering">std::sync::atmoic, memory ordering <a href="#stdsyncatmoic-memory-ordering" class="anchor">ğŸ”—</a></h1><p>compare_exchange , compare_exchange_weak<br></p>
<h1 id="åŒ…æ¨¡å—å¯è§æ€§">åŒ…ï¼Œæ¨¡å—ï¼Œå¯è§æ€§ <a href="#%e5%8c%85%e6%a8%a1%e5%9d%97%e5%8f%af%e8%a7%81%e6%80%a7" class="anchor">ğŸ”—</a></h1><p>æ¨¡å—fooå¯ä»¥æœ‰2ç§è¡¨ç¤ºï¼š <br></p>
<ul>
<li>ä¸€ä¸ªåä¸º foo.rs çš„æ–‡ä»¶</li>
<li>åœ¨åä¸º foo çš„ç›®å½•ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå« mod.rs æ–‡ä»¶</li>
</ul>
<h1 id="stdcmdåŒ…">std::cmdåŒ… <a href="#stdcmd%e5%8c%85" class="anchor">ğŸ”—</a></h1><p>æ•´ä¸ªé€»è¾‘åªåœ¨<code>/library/core/src/cmp.rs</code>ä¸­å®šä¹‰æ¸…æ¥šã€‚<br></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">//std::cmp::Eq
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> Eq: PartialEq<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span> {}
</span></span><span style="display:flex;"><span><span style="color:#75715e">//std::cmp::PartialEq
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> PartialEq<span style="color:#f92672">&lt;</span>Rhs <span style="color:#f92672">=</span> Self<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">where</span> Rhs: <span style="color:#f92672">?</span>Sized,
</span></span><span style="display:flex;"><span>{ 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Required Methods
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">eq</span>(<span style="color:#f92672">&amp;</span>self, other: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Rhs</span>) -&gt; <span style="color:#66d9ef">bool</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//std::cmp::PartialOrd 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> PartialOrd<span style="color:#f92672">&lt;</span>Rhs: <span style="color:#f92672">?</span>Sized <span style="color:#f92672">=</span> Self<span style="color:#f92672">&gt;</span>: PartialEq<span style="color:#f92672">&lt;</span>Rhs<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Required Methods
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">partial_cmp</span>(<span style="color:#f92672">&amp;</span>self, other: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Rhs</span>) -&gt; Option<span style="color:#f92672">&lt;</span>Ordering<span style="color:#f92672">&gt;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">//std::cmp::Ord
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">trait</span> Ord: Eq <span style="color:#f92672">+</span> PartialOrd<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">//Required Methods
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">cmp</span>(<span style="color:#f92672">&amp;</span>self, other: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">Self</span>) -&gt; <span style="color:#a6e22e">Ordering</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">max</span>(self, other: <span style="color:#a6e22e">Self</span>) -&gt; <span style="color:#a6e22e">Self</span> { <span style="color:#f92672">..</span>. }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">min</span>(self, other: <span style="color:#a6e22e">Self</span>) -&gt; <span style="color:#a6e22e">Self</span> { <span style="color:#f92672">..</span>. }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">fn</span> <span style="color:#a6e22e">clamp</span>(self, min: <span style="color:#a6e22e">Self</span>, max: <span style="color:#a6e22e">Self</span>) -&gt; <span style="color:#a6e22e">Self</span> <span style="color:#66d9ef">where</span> Self: PartialOrd<span style="color:#f92672">&lt;</span>Self<span style="color:#f92672">&gt;</span> { <span style="color:#f92672">..</span>. }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">Ordering</span> {
</span></span><span style="display:flex;"><span>    Less <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>    Equal <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>,
</span></span><span style="display:flex;"><span>    Greater <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h1 id="æ³›å‹ç¼–ç¨‹">æ³›å‹ç¼–ç¨‹ <a href="#%e6%b3%9b%e5%9e%8b%e7%bc%96%e7%a8%8b" class="anchor">ğŸ”—</a></h1><p>æ˜¯å¦æœ‰å¿…è¦åœ¨æ­¤åˆ»å°±æŠŠç±»å‹å®šæ­»? <br>
é€šè¿‡æ³›å‹é™æ€ç»‘å®šæ¨è¿Ÿåˆ°ç¼–è¯‘æœŸç¡®å®šç±»å‹ï¼Œtrait objæ¨è¿Ÿåˆ°è¿è¡ŒæœŸç¡®å®šç±»å‹ã€‚<br></p>
<h1 id="è¯­æ³•é—®é¢˜">è¯­æ³•é—®é¢˜ <a href="#%e8%af%ad%e6%b3%95%e9%97%ae%e9%a2%98" class="anchor">ğŸ”—</a></h1><p>ref pattern</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> a <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;A&#39;</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">ref</span> ref_a1 <span style="color:#f92672">=</span> a;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> ref_a2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>a; <span style="color:#75715e">// the same effect
</span></span></span></code></pre></div><h1 id="ç±»å‹çš„åµŒå¥—">ç±»å‹çš„åµŒå¥— <a href="#%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%b5%8c%e5%a5%97" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span>String<span style="color:#960050;background-color:#1e0010">ï¼Œ</span> Vec<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>, Box<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>, Unique<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span>, <span style="color:#f92672">*</span><span style="color:#66d9ef">const</span> T
</span></span></code></pre></div><p><code>dyn (Fn() + Send + 'static)</code>æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ<br></p>
<p>Fn() ä¸å¸¦å‚æ•°å’Œè¿”å›å€¼çš„é—­åŒ…ï¼Œå¯ä»¥è¢«Sendåˆ°å…¶ä»–çº¿ç¨‹ä¸­ï¼Œå…·æœ‰æ•è·å˜é‡çš„æ‰€æœ‰æƒã€‚
â€™staticæ˜¯æŒ‡æ²¡æœ‰å¯¹ä¸Šä¸‹æ–‡ä¸­çš„éé™æ€å˜é‡è¿›è¡Œå¼•ç”¨ã€‚</p>
<h1 id="å¯¹è±¡å®‰å…¨-trait-object">å¯¹è±¡å®‰å…¨ï¼Œ trait object <a href="#%e5%af%b9%e8%b1%a1%e5%ae%89%e5%85%a8-trait-object" class="anchor">ğŸ”—</a></h1><p>trait objectç±»å‹æ“¦é™¤ï¼Œ (data, vatable(funcname -&gt; func pointer)) <br></p>
<p>traitä¸­çš„æ–¹æ³•ä»…ä»…ä¾èµ–äºtraitä¸­çš„å®šä¹‰ã€‚</p>
<p>ï¼ˆsize, shape of argument, ï¼‰ã€‚
return valueï¼š ä¸èƒ½æ˜¯Selfï¼Œtrait objectç±»å‹æ“¦é™¤ï¼Œæ— æ³•è¿”å›ä¸traitæ— å…³çš„å…·ä½“ç±»å‹ã€‚
shape of argument ä¸èƒ½å¸¦æ³›å‹ã€‚</p>
<h1 id="any-trait"><code>Any</code> trait <a href="#any-trait" class="anchor">ğŸ”—</a></h1><p>Deref, Drop, Copy, Any trait</p>
<p>Send &amp; Sync</p>
<p>?Size</p>
<h1 id="fn-fnmut-fnonce-åŒºåˆ«">Fn FnMut FnOnce åŒºåˆ« <a href="#fn-fnmut-fnonce-%e5%8c%ba%e5%88%ab" class="anchor">ğŸ”—</a></h1><p><strong>é—­åŒ…å»å®ç°å“ªç§<code>Fn, FnMut, FnOnce</code>traitä¸moveæ— å…³ï¼Œä¸å¦‚ä½•æ•è·å˜é‡æ— å…³ã€‚</strong><br>
<strong>Fn FnMut FnOnceä¸é—­åŒ…å¦‚ä½•ä½¿ç”¨æ•è·åˆ°çš„å€¼æœ‰å…³ã€‚</strong><br></p>
<p>é—­åŒ…å°±æ˜¯æ•è·å¤–éƒ¨å˜é‡çš„ç»“æ„ä½“ï¼ŒåŠ ä¸€æ®µä»£ç <br></p>
<p>closure æ˜¯ç»“æ„ä½“ï¼ˆæ•è·çš„å˜é‡ï¼‰çš„è¯­æ³•ç³–ï¼Œé—­åŒ…é€»è¾‘éƒ¨åˆ†åœ¨ä»£ç æ®µä¸­ã€‚<br>
é—­åŒ…çš„è°ƒç”¨ï¼š Fn::call(ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯é—­åŒ…ç»“æ„ä½“...) Fnï¼šcall_</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#75715e">// ç§»èµ°åŒ¿åç»“æ„ä½“ä¸­å˜é‡çš„closureå®ç° FnOnce
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>FnOnce::call_once(self, args: <span style="color:#a6e22e">Args</span>) -&gt; <span style="color:#a6e22e">Self</span>::Output;
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ä¸ä¼šç§»èµ°åŒ¿åç»“æ„ä½“ä¸­å˜é‡ä½†ä¿®æ”¹çš„closureå®ç° FnMut
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>FnMut::call_mut(<span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> self, args: <span style="color:#a6e22e">Args</span>) -&gt; <span style="color:#a6e22e">Self</span>::Output;
</span></span><span style="display:flex;"><span><span style="color:#75715e">//ä¸ä¼šä¿®æ”¹åŒ¿åç»“æ„ä½“ä¸­å˜é‡çš„closureå®ç° Fn
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>Fn: <span style="color:#a6e22e">call</span>(<span style="color:#f92672">&amp;</span>self, args: <span style="color:#a6e22e">Args</span> -&gt; <span style="color:#a6e22e">Self</span>::Output);
</span></span></code></pre></div><h1 id="æ‰€æœ‰æƒmoveè¯­ä¹‰å€Ÿç”¨ç”Ÿå‘½å‘¨æœŸçš„æ¨è¿›å…³ç³»">æ‰€æœ‰æƒï¼Œmoveè¯­ä¹‰ï¼Œå€Ÿç”¨ï¼Œç”Ÿå‘½å‘¨æœŸçš„æ¨è¿›å…³ç³» <a href="#%e6%89%80%e6%9c%89%e6%9d%83move%e8%af%ad%e4%b9%89%e5%80%9f%e7%94%a8%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f%e7%9a%84%e6%8e%a8%e8%bf%9b%e5%85%b3%e7%b3%bb" class="anchor">ğŸ”—</a></h1><p>ä¸ºäº†é€‚åº”å†…å­˜çš„ownership&amp;moveè¯­ä¹‰ï¼Œå¼•å…¥borrow &amp; referenceã€‚<br>
å¸¦æ¥æ–°é—®é¢˜æ˜¯æ‰€æœ‰æƒå’Œä½¿ç”¨æƒåˆ†éš”äº†ï¼Œè®©å¼•ç”¨å’ŒåŸå§‹å€¼çš„å†…å­˜ç©ºé—´ç‹¬ç«‹äº†ã€‚<br>
ä½†æ˜¯ä¸¤è€…å…·æœ‰é€»è¾‘å…³ç³»ä¸Šçš„çº¦æŸï¼š å¼•ç”¨åªèƒ½åœ¨åŸå§‹å€¼å­˜åœ¨çš„å‰æä¸‹æ‰æœ‰æ„ä¹‰ã€‚<br>
å¼•å…¥ç”Ÿå‘½å‘¨æœŸlifetimeåˆ°è¯­æ³•ä¸­ã€‚<br></p>
<p>ä¾‹å¦‚ï¼š ä¸€ä¸ªfnè¿”å›äº†å¼•ç”¨ï¼Œå¦‚æœæ˜¯å¼•ç”¨fnçš„localå˜é‡åˆ™âŒï¼Œå¦‚æœæ˜¯å¼•ç”¨fnçš„å‚æ•°ï¼Œé‚£ä¹ˆcompileréœ€è¦çŸ¥é“ä¼ å…¥çš„å‚æ•°çš„å­˜æ´»æ—¶é—´æ˜¯å¦æ”¯æ’‘è¿™ä¸ªå¼•ç”¨çš„æœ‰æ•ˆæ€§(æ–°å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸåªèƒ½æ˜¯è¢«å¼•ç”¨å€¼çš„ç”Ÿå‘½å‘¨æœŸçš„åŒºé—´å­é›†)ã€‚</p>
<p>Copyï¼šå¤åˆ¶è¯­ä¹‰émoveè¯­ä¹‰ã€‚Cloneç”¨ä»&amp;Tä¸­åˆ›å»ºå‰¯æœ¬Tã€‚<br>
copyæ˜¯æµ…æ‹·è´ï¼Œæ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨è°ƒç”¨ã€‚ cloneæ˜¯æ·±æ‹·è´ï¼Œç¨‹åºå‘˜æ‰‹åŠ¨è°ƒç”¨ã€‚<br></p>
<h1 id="traitsçš„å†…å­˜è¡¨ç¤º">traitsçš„å†…å­˜è¡¨ç¤º <a href="#traits%e7%9a%84%e5%86%85%e5%ad%98%e8%a1%a8%e7%a4%ba" class="anchor">ğŸ”—</a></h1><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#66d9ef">mut</span> buf: Vec<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">u8</span><span style="color:#f92672">&gt;</span> <span style="color:#f92672">=</span> vec![];
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> writer: <span style="color:#66d9ef">&amp;</span><span style="color:#a6e22e">mut</span> std::io::Write <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span><span style="color:#66d9ef">mut</span> buf;
</span></span></code></pre></div><pre tabindex="0"><code>      trait object( data    vptr) 
                    .          . 
                   .            .
                  .              .
                .                 . 
buf(buffer, capacity, lenght)      vtable impl Write for Vec&lt;u8&gt;
                                            ææ„å‡½æ•°ï¼Œsize, align
                                            write() -&gt;
                                            flush() -&gt;
</code></pre><p>c++æ˜¯å°†vptrå’Œå¯¹è±¡ä¿å­˜åœ¨ä¸€èµ·ã€‚ç»™åŸºç¡€ç±»å‹intï¼Œstringæ‰©å±•æ–¹æ³•å°±åšä¸åˆ°äº†ã€‚</p>
<h1 id="attribute-å±æ€§">attribute å±æ€§ <a href="#attribute-%e5%b1%9e%e6%80%a7" class="anchor">ğŸ”—</a></h1><p><code>#[allow(non_camlel_case_types)]</code>
<code>#[cfg(windows)]</code>
<code>#[derive(Debug)]</code></p>
<h1 id="rust-ç”Ÿå‘½å®-è¿‡ç¨‹å®-rustä¸­çš„æ’æ¡©">rust ç”Ÿå‘½å®ï¼Œ è¿‡ç¨‹å®ï¼Œ rustä¸­çš„æ’æ¡© <a href="#rust-%e7%94%9f%e5%91%bd%e5%ae%8f-%e8%bf%87%e7%a8%8b%e5%ae%8f-rust%e4%b8%ad%e7%9a%84%e6%8f%92%e6%a1%a9" class="anchor">ğŸ”—</a></h1><p>why ä¸ºä»€ä¹ˆéœ€è¦å®ï¼Ÿ</p>
<p>å®æ˜¯æ‰©å±•è¯­è¨€çš„ä¸€ç§æ–¹å¼ï¼Œå…ƒç¼–ç¨‹ã€‚</p>
<p>å£°æ˜å®ï¼š å¯¹ä»£ç æ¨¡ç‰ˆåšç®€å•æ›¿æ¢ã€‚ <code>macro_rules!</code>
è¿‡ç¨‹å®ï¼š å¯ä»¥æ·±åº¦å®šåˆ¶å’Œç”Ÿäº§ä»£ç ã€‚
å‡½æ•°å®ï¼š
å±æ€§å®ï¼š <code>#[tokio::main]</code>
æ´¾ç”Ÿå®ï¼š <code>#[derive(Debug)]</code></p>
<p>åˆ©ç”¨è¿‡ç¨‹å®ä¿®æ”¹astæ¥å®ç°fnè¿›å…¥å’Œå‡ºæ¥æ—¶æ‰“å°æ—¥å¿—ã€‚</p>
<h1 id="å­ç±»å‹-ç±»å‹äº§ç”Ÿå™¨-åå˜é€†å˜ä¸å˜">å­ç±»å‹ï¼Œ ç±»å‹äº§ç”Ÿå™¨ï¼Œ åå˜ï¼Œé€†å˜ï¼Œä¸å˜ <a href="#%e5%ad%90%e7%b1%bb%e5%9e%8b-%e7%b1%bb%e5%9e%8b%e4%ba%a7%e7%94%9f%e5%99%a8-%e5%8d%8f%e5%8f%98%e9%80%86%e5%8f%98%e4%b8%8d%e5%8f%98" class="anchor">ğŸ”—</a></h1><pre tabindex="0"><code>T: U , a: U, b: T.
</code></pre><h1 id="t-mut-t">&amp;T &amp;mut T <a href="#t-mut-t" class="anchor">ğŸ”—</a></h1><p>&amp;T: å…±äº«å¼•ç”¨ï¼Œ &amp;mut T ç‹¬å å¼•ç”¨<br></p>
<h1 id="rust-å†…å­˜æ¨¡å‹">rust å†…å­˜æ¨¡å‹ <a href="#rust-%e5%86%85%e5%ad%98%e6%a8%a1%e5%9e%8b" class="anchor">ğŸ”—</a></h1><ul>
<li>acquire ç”¨äºloadï¼Œ è¯»</li>
<li>release ç”¨äºstoreï¼Œå†™</li>
<li>seq     ç›¸å½“äºmemory barrier</li>
</ul>

    </div>

    
        <div class="tags">
            
                <a href="http://brettkk.github.io/tags/rust">rust</a>
            
        </div>
    
    
    

</section>


    </main>
    
    <footer id="footer">
    

    <script src="https://utteranc.es/client.js"
repo="brettKK/brettkk.github.io"
issue-term="title"
theme="github-light"
crossorigin="anonymous"
async>
</script>  

    <div class="copyright">
    
       Â© Copyright 
       2023 
       <span class="split">
        <svg fill="#bbbbbb" width="15" height="15" version="1.1" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15px" height="15px" viewBox="0 0 15 15">
  <path d="M13.91,6.75c-1.17,2.25-4.3,5.31-6.07,6.94c-0.1903,0.1718-0.4797,0.1718-0.67,0C5.39,12.06,2.26,9,1.09,6.75&#xA;&#x9;C-1.48,1.8,5-1.5,7.5,3.45C10-1.5,16.48,1.8,13.91,6.75z"/>
</svg>
       </span>
       
    
    </div>

    
      <div class="powerby">
        Powered by <a href='http://www.gohugo.io/'>Hugo</a> Theme By <a href='https://github.com/nodejh/hugo-theme-cactus-plus'>nodejh</a>
      </div>
    
</footer>




  </body>
</html>
